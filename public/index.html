<!-- =========================
  (ìˆ˜ì •ë³¸) index.html ì „ì²´
  - 3ì¼ê¶Œ íŒ¨ìŠ¤ ì¶”ê°€(7ì¼ê¶Œ ìœ„)
  - MICE â†’ Business ì¤‘ì‹¬ ë¬¸êµ¬ë¡œ ë³€ê²½
  - ë°˜ë³µ ë¬¸êµ¬ ì™„í™”
  - ì§€ë„/íŒ¨ìŠ¤ ìƒì„¸ì—ì„œ íƒì‹œ ê´€ë ¨ ë¬¸êµ¬/ì•„ì´ì½˜ ì œê±°
  - ì–¸ì–´ ì „í™˜ ì‹¤ì œë¡œ í™”ë©´ ë¬¸êµ¬ê¹Œì§€ ë°˜ì˜(i18n)
  - â€œë¡œê·¸ì¸í•´ì£¼ì„¸ìš”/ë¡œê·¸ì¸í•˜ì„¸ìš”â€ íë¦„ â†’ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ ì¦‰ì‹œ ì´ë™
========================= -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>BÂ·PASS Living</title>

  <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

  <script src="https://unpkg.com/feather-icons"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Toss Payment Widget -->
  <script src="https://js.tosspayments.com/v1/payment-widget"></script>

  <style>
    :root{
      --bg:#F8F9FE;
      --primary:#2563EB;
      --primary2:#4F46E5;
      --accent:#CCF802;
      --text:#111827;
      --sub:#6B7280;
      --card:rgba(255,255,255,0.78);
      --card2:rgba(255,255,255,0.92);
      --border:rgba(255,255,255,0.65);
      --shadow:0 10px 40px -10px rgba(37,99,235,0.15);
      --shadow2:0 20px 50px -12px rgba(37,99,235,0.22);
      --safeB: env(safe-area-inset-bottom);
      --radius:28px;
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Pretendard",sans-serif;-webkit-tap-highlight-color:transparent;}
    body{background:var(--bg);color:var(--text);overflow:hidden;}

    /* ìƒì„¸ ë²„íŠ¼ ê°€ë¡œ ê³ ì • */
    .pill{
      white-space: nowrap;
      flex-direction: row;
    }

    /* í¬í•¨ ì„œë¹„ìŠ¤ ë°˜ì‘í˜• ì •ë¦¬ */
    @media (max-width: 900px){
      .benefits{ grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 520px){
      .benefits{ grid-template-columns: repeat(2, 1fr); }
    }

    /* background */
    .aurora{
      position:fixed;inset:0;z-index:-3;
      background:
        radial-gradient(at 0% 0%, rgba(96,165,250,0.22) 0, transparent 55%),
        radial-gradient(at 100% 20%, rgba(204,248,2,0.16) 0, transparent 55%),
        radial-gradient(at 70% 100%, rgba(79,70,229,0.14) 0, transparent 60%);
      animation:breathe 6s ease-in-out infinite alternate;
    }
    @keyframes breathe{from{opacity:.82;transform:scale(1)}to{opacity:1;transform:scale(1.05)}}

    /* phone frame */
    .app{max-width:500px;height:100dvh;margin:0 auto;display:flex;flex-direction:column;position:relative;}

    /* header bg bar */
    .header-bg{
      position:fixed;top:0;left:0;right:0;height:96px;
      z-index:40;pointer-events:none;
      background:linear-gradient(180deg, rgba(37,99,235,.14) 0%, rgba(248,249,254,0) 100%);
    }

    /* header fixed */
    header{
      position:fixed;top:0;left:0;right:0;z-index:50;
      padding:18px 24px;
      display:flex;align-items:center;justify-content:space-between;
      background:transparent;
    }
    .logo{
      font-size:26px;font-weight:950;letter-spacing:-0.6px;
      background:linear-gradient(90deg,var(--primary),var(--primary2));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      filter:drop-shadow(0 2px 4px rgba(37,99,235,.22));
      display:flex;align-items:center;gap:10px;
    }
    .guest-badge{
      font-size:11px;font-weight:900;color:#111;
      background:rgba(255,255,255,.7);
      padding:5px 10px;border-radius:999px;
      border:1px solid rgba(0,0,0,.06);
    }
    .lang-btn{
      background:rgba(255,255,255,.88);
      border:1px solid rgba(255,255,255,.7);
      padding:8px 14px;border-radius:18px;font-size:13px;font-weight:900;
      box-shadow:0 4px 12px rgba(0,0,0,.06);
      display:flex;gap:6px;align-items:center;cursor:pointer;
      backdrop-filter: blur(8px);
    }

    /* views */
    .view{flex:1;overflow-y:auto;padding:84px 24px calc(120px + var(--safeB));display:none;scroll-behavior:smooth;}
    .view.active{display:block;animation:fade .35s cubic-bezier(.2,.8,.2,1);}
    @keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    /* cards */
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(18px);
      margin-bottom:16px;
    }
    .card:active{transform:scale(.985)}
    .card-title{font-size:18px;font-weight:950;letter-spacing:-.4px;margin-bottom:10px;}
    .muted{color:var(--sub);font-weight:700;}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px;}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      background:rgba(17,24,39,.06);
      border:1px solid rgba(17,24,39,.06);
      padding:9px 12px;border-radius:16px;
      font-weight:900;font-size:13px;color:var(--text);
      cursor:pointer;
    }
    .pill.primary{
      background:var(--primary);
      color:#fff;border-color:rgba(255,255,255,.12);
      box-shadow:0 10px 22px rgba(37,99,235,.22);
    }
    .pill.primary:active{transform:scale(.98)}
    .pill.ghost{
      background:rgba(255,255,255,.88);
      border:1px solid rgba(255,255,255,.7);
      backdrop-filter: blur(10px);
    }

    /* wallet */
    .wallet{
      background:linear-gradient(135deg,#2563EB 0%, #1D4ED8 100%);
      color:#fff; border:none; box-shadow:var(--shadow2);
      position:relative; overflow:hidden;
    }
    .wallet::before{
      content:"";position:absolute;inset:-60%;
      background: radial-gradient(circle, rgba(255,255,255,.22) 0%, transparent 58%);
      animation:shine 4s linear infinite;
    }
    @keyframes shine{to{transform:rotate(360deg)}}
    .wallet-inner{position:relative;z-index:2}
    .balance-label{font-size:13px;font-weight:800;opacity:.92;margin-bottom:6px;}
    .balance{font-size:30px;font-weight:950;letter-spacing:-.8px;margin-bottom:16px;}
    .wallet-actions{display:flex;gap:10px;flex-wrap:wrap}

    /* quick menu */
    .menu-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:8px 0 18px;}
    .menu-item{display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;}
    .icon-box{
      width:56px;height:56px;border-radius:22px;background:#fff;
      border:1px solid rgba(255,255,255,.8);
      box-shadow:var(--shadow);
      display:flex;align-items:center;justify-content:center;color:var(--primary);
      transition:.2s;
    }
    .menu-item:active .icon-box{transform:scale(.92) translateY(2px)}
    .menu-label{font-size:13px;font-weight:900;color:var(--sub)}

    /* how-to 3 steps */
    .steps{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px;}
    .step{
      background:rgba(255,255,255,.86);
      border:1px solid rgba(255,255,255,.72);
      border-radius:18px;padding:12px 12px;
      box-shadow:0 10px 22px rgba(0,0,0,.04);
    }
    .step-num{font-size:11px;font-weight:950;color:var(--primary);margin-bottom:6px;}
    .step-t{font-weight:950;font-size:13px;letter-spacing:-.2px;margin-bottom:4px;}
    .step-d{font-size:12px;color:var(--sub);font-weight:800;line-height:1.2;}

    /* benefit icons */
    .benefits{
      display:grid;grid-template-columns:repeat(4,1fr);
      gap:10px;margin-top:12px;
    }
    .benefit{
      background:rgba(255,255,255,.86);
      border:1px solid rgba(255,255,255,.72);
      border-radius:18px;padding:12px;
      display:flex;flex-direction:column;gap:8px;align-items:flex-start;
    }
    .benefit .b-ic{width:34px;height:34px;border-radius:12px;background:rgba(37,99,235,.1);color:var(--primary);display:flex;align-items:center;justify-content:center;}
    .benefit .b-t{font-size:12px;font-weight:950;letter-spacing:-.2px;}
    .benefit .b-d{font-size:11px;color:var(--sub);font-weight:800;line-height:1.2;}

    /* pass card */
    .tag{
      display:inline-block;background:var(--text);color:var(--accent);
      font-size:11px;font-weight:950;padding:5px 10px;border-radius:10px;margin-bottom:8px;
    }
    .pass-card{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;}
    .pass-right{min-width:150px;display:flex;flex-direction:column;align-items:flex-end;gap:10px;}
    .price-old{font-size:12px;font-weight:950;color:var(--sub);text-decoration:line-through;}
    .price-new{font-size:22px;font-weight:950;color:var(--primary);letter-spacing:-.4px;}
    .buy-btn{
      width:132px;text-align:center;
      padding:12px 18px;border-radius:16px;
      background:var(--primary);color:#fff;border:none;
      font-size:15px;font-weight:950;
      box-shadow:0 14px 24px rgba(37,99,235,.26);
      cursor:pointer;
    }
    .buy-btn:active{transform:scale(.98)}

    /* map view */
    #view-map{padding:0;position:relative;height:100%;}
    #map{width:100%;height:100%;z-index:1;}

    /* âœ… ë‚´ ì£¼ë³€ ë²„íŠ¼ ì˜ë¦¼ í•´ê²° + ê²€ìƒ‰ë°” ê²¹ì¹¨ ë°©ì§€ */
    .map-top{
      position:absolute;
      left:12px;
      right:12px;
      top:58px;
      z-index:1200;

      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:10px;

      pointer-events:none;

      padding:10px 10px;
      border-radius:20px;

      background:rgba(248,249,254,.92);
      border:1px solid rgba(255,255,255,.85);
      box-shadow:0 14px 30px rgba(0,0,0,.12);
      backdrop-filter:blur(12px);

      overflow:visible;
    }
    .map-top > *{pointer-events:auto;}

    .map-search-btn{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.7);
      border-radius:16px;
      padding:10px 12px;
      font-weight:950;
      display:flex;align-items:center;gap:8px;
      box-shadow:0 10px 24px rgba(0,0,0,.12);
      cursor:pointer;
      backdrop-filter: blur(10px);
      flex:0 0 auto;
      white-space:nowrap;
    }

    .map-search-bar{
      flex:1 1 220px;
      min-width:0;
      display:none;align-items:center;gap:10px;position: relative;
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.7);
      border-radius:18px;
      padding:10px 12px;
      box-shadow:0 10px 24px rgba(0,0,0,.12);
      backdrop-filter: blur(10px);
    }
    .map-search-bar.open{display:flex;}
    .map-search-input{
      flex:1;border:none;outline:none;background:transparent;min-width: 0;
      font-weight:950;font-size:14px;color:var(--text);
    }
    .map-search-go{
      border:none;border-radius:14px;padding:10px 12px;
      background:var(--text);color:#fff;font-weight:950;cursor:pointer;
      white-space:nowrap;
    }
    .map-search-close{
      border:none;border-radius:14px;padding:10px 12px;
      background:rgba(0,0,0,.06);font-weight:950;cursor:pointer;
      white-space:nowrap;
    }

    .map-tools{
      display:flex;
      gap:10px;
      flex:0 0 auto;
      margin-left:auto;
    }

      .price-badge{
    display:inline-flex;
    align-items:center;
    gap:6px;
    font-size:11px;
    font-weight:950;
    padding:5px 10px;
    border-radius:999px;
    margin-right:8px;
    background:rgba(37,99,235,.12);
    color:var(--primary);
    border:1px solid rgba(37,99,235,.18);
    vertical-align:middle;
  }


    .near-btn{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.7);
      border-radius:16px;
      padding:10px 12px;
      font-weight:950;
      display:flex;align-items:center;gap:8px;
      box-shadow:0 10px 24px rgba(0,0,0,.12);
      cursor:pointer;
      backdrop-filter: blur(10px);
      white-space:nowrap;
      flex:0 0 auto;
    }

    @media (max-width: 380px){
      .near-btn{ padding:10px 10px; gap:0; font-size:0; }
      .near-btn i{ width:16px; height:16px; }
    }

    .map-filters{
      position:absolute;left:12px;right:12px;top:132px;z-index:1200;
      display:flex;gap:8px;overflow-x:auto;padding-bottom:6px;
      pointer-events:auto;

      padding-top:10px;
      border-top:1px solid rgba(17,24,39,.10);
    }
    .map-filters::-webkit-scrollbar{display:none;}
    .chip{
      background:rgba(255,255,255,.9);
      border:1px solid rgba(255,255,255,.75);
      padding:10px 14px;border-radius:999px;
      font-size:13px;font-weight:950;color:var(--sub);
      box-shadow:0 10px 18px rgba(0,0,0,.06);
      white-space:nowrap;cursor:pointer;transition:.15s;
    }
    .chip.active{background:var(--primary);color:#fff;transform:scale(1.03);}

    .map-search-open .map-filters{
      top:176px !important;
    }

    /* bottom sheet */
    .sheet-overlay{
      position:fixed;inset:0;z-index:16000;
      background:rgba(0,0,0,.38);
      display:none;align-items:flex-end;justify-content:center;
      backdrop-filter: blur(6px);
    }
    .sheet{
      width:100%;max-width:500px;
      background:rgba(255,255,255,.95);
      border-radius:30px 30px 0 0;
      border:1px solid rgba(255,255,255,.7);
      padding:18px 18px calc(22px + var(--safeB));
      animation:up .28s cubic-bezier(.16,1,.3,1);
    }
    @keyframes up{from{transform:translateY(100%)}to{transform:translateY(0)}}
    .grab{width:46px;height:5px;border-radius:999px;background:rgba(17,24,39,.12);margin:0 auto 12px;}
    .place-head{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:10px;}
    .place-name{font-size:18px;font-weight:950;letter-spacing:-.3px;}
    .place-meta{font-size:12px;color:var(--sub);font-weight:900;line-height:1.2;}
    .benefit-badge{
      display:inline-flex;gap:6px;align-items:center;
      background:rgba(37,99,235,.1);color:var(--primary);
      padding:7px 10px;border-radius:12px;font-weight:950;font-size:12px;
      border:1px solid rgba(37,99,235,.15);
      margin-top:8px;
    }
    .sheet-actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap;}
    .sheet-actions .pill{flex:1;justify-content:center;}

    /* MY page */
    .tabs{display:flex;gap:10px;margin:8px 0 14px;}
    .tab{
      flex:1;text-align:center;
      padding:10px 12px;border-radius:16px;
      background:rgba(255,255,255,.86);
      border:1px solid rgba(255,255,255,.75);
      font-weight:950;color:var(--sub);
      cursor:pointer;
    }
    .tab.active{background:var(--primary);color:#fff;border-color:rgba(255,255,255,.15);}

    .pass-big{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.75);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:0 16px 28px rgba(0,0,0,.06);
    }
    .pass-status{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 10px;border-radius:999px;font-weight:950;font-size:12px;
      border:1px solid rgba(0,0,0,.06);
      background:rgba(17,24,39,.06);color:var(--text);
      margin-bottom:12px;
    }
    .dot{width:8px;height:8px;border-radius:50%;}
    .dot.active{background:#10B981;}
    .dot.inactive{background:#FF3B30;}
    .pass-metrics{display:flex;gap:10px;margin-top:12px;}
    .metric{flex:1;background:rgba(17,24,39,.04);border:1px solid rgba(17,24,39,.06);border-radius:18px;padding:12px;}
    .metric .k{font-size:11px;font-weight:950;color:var(--sub);margin-bottom:6px;}
    .metric .v{font-size:14px;font-weight:950;letter-spacing:-.2px;}

    .list-group{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.75);
      border-radius:22px;overflow:hidden;
      box-shadow:0 14px 26px rgba(0,0,0,.06);
    }
    .list-row{
      padding:16px 18px;display:flex;align-items:center;justify-content:space-between;
      border-bottom:1px solid rgba(17,24,39,.06);
      cursor:pointer;font-weight:950;
    }
    .list-row:last-child{border-bottom:none;}
    .list-row:active{background:rgba(17,24,39,.03);}

    /* nav dock */
    .nav-container{position:fixed;left:0;right:0;bottom:30px;z-index:9999;display:flex;justify-content:center;pointer-events:none;}
    .nav-dock{
      pointer-events:auto;
      background:rgba(255,255,255,.9);
      border:1px solid rgba(255,255,255,.7);
      backdrop-filter: blur(18px);
      padding:12px 28px;border-radius:999px;
      box-shadow:0 16px 40px rgba(0,0,0,.14);
      display:flex;gap:28px;align-items:center;
    }
    .nav-item{color:#C0C0C0;cursor:pointer;transition:.2s;position:relative;}
    .nav-item.active{color:var(--primary);transform:translateY(-2px);}
    .nav-item.active::after{
      content:"";position:absolute;left:50%;transform:translateX(-50%);
      bottom:-8px;width:4px;height:4px;border-radius:50%;background:var(--primary);
    }
    .qr-btn{
      width:52px;height:52px;border-radius:50%;
      background:var(--primary);color:#fff;
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 10px 28px rgba(37,99,235,.38);
      margin-top:-20px;
      border:4px solid var(--bg);
      cursor:pointer;
    }
    .qr-btn:active{transform:scale(.95)}

    /* overlays */
    .overlay{
      position:fixed;inset:0;z-index:20000;
      background:rgba(0,0,0,.45);
      display:none;align-items:flex-end;justify-content:center;
      backdrop-filter: blur(6px);
    }
    .modal{
      width:100%;max-width:500px;
      background:#fff;border-radius:32px 32px 0 0;
      padding:22px 18px calc(22px + var(--safeB));
      animation:up .28s cubic-bezier(.16,1,.3,1);

      /* âœ… ëª¨ë‹¬ ìŠ¤í¬ë¡¤ */
      max-height: calc(100dvh - 40px);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    .modal h2{font-size:22px;font-weight:950;letter-spacing:-.4px;margin-bottom:10px;}
    .modal p{color:var(--sub);font-weight:800;line-height:1.35;}

    .btn-main{
      width:100%;
      padding:16px;border-radius:18px;border:none;
      background:var(--text);color:#fff;
      font-size:16px;font-weight:950;cursor:pointer;
      margin-top:12px;
      box-shadow:0 8px 18px rgba(0,0,0,.12);
    }
    .btn-sub{
      width:100%;
      padding:14px;border-radius:18px;border:1px solid rgba(17,24,39,.08);
      background:#F2F2F7;color:var(--text);
      font-size:15px;font-weight:950;cursor:pointer;
      margin-top:10px;
    }

    /* onboarding */
    .onb{
      position:fixed;inset:0;z-index:25000;
      display:none;align-items:center;justify-content:center;
      background:rgba(248,249,254,.96);
    }
    .onb-card{
      width:100%;max-width:500px;height:100%;
      padding:26px 22px calc(26px + var(--safeB));
      display:flex;flex-direction:column;
    }
    .onb-top{display:flex;justify-content:space-between;align-items:center;margin-top:8px;}
    .skip{font-weight:950;color:var(--sub);cursor:pointer;}
    .onb-slide{flex:1;display:none;flex-direction:column;justify-content:center;}
    .onb-slide.active{display:flex;}
    .onb-h{
      font-size:26px;font-weight:980;letter-spacing:-.8px;margin-bottom:12px;
      background:linear-gradient(90deg,var(--primary),var(--primary2));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    }
    .onb-desc{color:var(--sub);font-weight:850;line-height:1.5;font-size:15px;}
    .dots{display:flex;gap:8px;justify-content:center;margin:18px 0;}
    .dot2{width:8px;height:8px;border-radius:50%;background:rgba(17,24,39,.18);}
    .dot2.active{background:var(--primary);}
    .onb-actions{display:flex;gap:10px;}
    .onb-actions .pill{flex:1;justify-content:center;}

    /* Leaflet controls */
    .leaflet-control-container{z-index:1200;}
    .leaflet-control{pointer-events:auto;}
    .leaflet-top.leaflet-left .leaflet-control-zoom{display:none!important;}

    /* âœ… QR íƒ­: 'ë°œê¸‰ì„œ(íšŒì›ì¦)' UI */
    .cert-wrap{
      position:relative;
      margin-top:8px;
      border-radius:28px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.7);
      box-shadow:0 18px 40px rgba(0,0,0,.10);
      background:linear-gradient(135deg, rgba(37,99,235,.96) 0%, rgba(79,70,229,.96) 55%, rgba(29,78,216,.96) 100%);
    }
    .cert-wrap::before{
      content:"";
      position:absolute;inset:-60%;
      background:
        radial-gradient(circle at 30% 30%, rgba(204,248,2,.28) 0%, transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(255,255,255,.18) 0%, transparent 58%);
      transform:rotate(12deg);
      animation:certShine 5.5s linear infinite;
      pointer-events:none;
    }
    @keyframes certShine{to{transform:rotate(372deg)}}
    .cert{
      position:relative;z-index:2;
      padding:18px 18px 16px;
      color:#fff;
    }
    .cert-top{
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
      margin-bottom:12px;
    }
    .cert-brand{display:flex;flex-direction:column;gap:6px;}
    .cert-brand .b1{
      font-weight:980;letter-spacing:-.6px;font-size:20px;
      display:flex;align-items:center;gap:10px;
    }
    .cert-chip{
      display:inline-flex;align-items:center;gap:8px;
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.22);
      padding:7px 10px;border-radius:999px;
      font-weight:950;font-size:12px;
      width:max-content;
    }
    .cert-chip .mini-dot{
      width:8px;height:8px;border-radius:50%;
      background:#FF3B30;
      box-shadow:0 0 0 4px rgba(255,59,48,.18);
    }
    .cert-chip.active .mini-dot{
      background:#10B981;
      box-shadow:0 0 0 4px rgba(16,185,129,.18);
    }
    .cert-qr{
      width:84px;height:84px;
      border-radius:18px;
      background:rgba(255,255,255,.95);
      padding:8px;
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 10px 26px rgba(0,0,0,.16);
      flex:0 0 auto;
    }
    .cert-qr img{width:100%;height:100%;border-radius:12px;}
    .cert-mid{display:flex;flex-direction:column;gap:10px;}
    .cert-name{
      font-size:22px;font-weight:980;letter-spacing:-.6px;
      line-height:1.15;
    }
    .cert-sub{
      font-size:13px;font-weight:850;opacity:.92;
      line-height:1.4;
    }
    .cert-grid{
      margin-top:10px;
      display:grid;grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .cert-field{
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      border-radius:18px;
      padding:10px 12px;
    }
    .cert-field .k{
      font-size:11px;font-weight:950;opacity:.92;margin-bottom:6px;
    }
    .cert-field .v{
      font-size:13px;font-weight:980;letter-spacing:-.2px;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .cert-bar{
      margin-top:14px;
      height:40px;
      border-radius:14px;
      background:
        repeating-linear-gradient(90deg, rgba(0,0,0,.75) 0, rgba(0,0,0,.75) 2px, rgba(255,255,255,.0) 2px, rgba(255,255,255,.0) 4px);
      opacity:.85;
    }
    .cert-foot{
      margin-top:12px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      flex-wrap:wrap;
    }
    .cert-foot .mini{
      font-size:12px;font-weight:900;opacity:.92;
    }
    .cert-foot .pill{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.7);
      color:var(--text);
    }

    /* âœ… ì¶”ì²œ ëª¨ë‹¬ ë¦¬ìŠ¤íŠ¸ UI */
    .rec-list{display:flex;flex-direction:column;gap:10px;margin-top:12px;}
    .rec-item{
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.75);
      border-radius:22px;
      padding:14px 14px;
      box-shadow:0 14px 26px rgba(0,0,0,.06);
      display:flex;flex-direction:column;gap:8px;
    }
    .rec-title{font-size:15px;font-weight:980;letter-spacing:-.3px;}
    .rec-meta{font-size:12px;color:var(--sub);font-weight:900;line-height:1.35;}
    .rec-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:2px;}
  </style>
</head>

<body>
  <div class="aurora"></div>
  <div class="header-bg"></div>

  <div class="app">
    <header>
      <div class="logo">
        <span>BÂ·PASS</span>
        <span id="guestBadge" class="guest-badge" style="display:none;">GUEST</span>
      </div>
      <div class="lang-btn" onclick="openLang()">
        <i data-feather="globe" style="width:14px;"></i>
        <span id="langText">KR</span>
      </div>
    </header>

    <!-- =========================
         HOME
    ========================== -->
    <div id="view-home" class="view active">

      <div class="card">
        <div class="row" style="align-items:flex-start;">
          <div>
            <div class="card-title" data-i18n="hero_title">Business ì²´ë¥˜ë¥¼ â€œíŒ¨ìŠ¤ í•˜ë‚˜ë¡œâ€</div>
            <div class="muted" style="line-height:1.35;" data-i18n="hero_desc">
              êµí†µ Â· ì›Œí¬ìŠ¤í˜ì´ìŠ¤ Â· í—¬ìŠ¤ Â· ì¹´í˜ í• ì¸ Â· ê¸´ê¸‰ì§€ì›ê¹Œì§€<br>
              <b style="color:var(--text);">ì—…ë¬´Â·ì´ë™Â·íœ´ì‹ì„ í•œ ë²ˆì— ì—°ê²°í•˜ëŠ” ì²´ë¥˜ íŒ¨ìŠ¤</b>
            </div>
          </div>
          <div class="pill ghost" onclick="openPassDetail('week7'); event.stopPropagation();">
            <i data-feather="info" style="width:16px;"></i> <span data-i18n="btn_detail">ìƒì„¸</span>
          </div>
        </div>

        <div class="steps">
          <div class="step">
            <div class="step-num">STEP 1</div>
            <div class="step-t" data-i18n="step1_t">ë¡œê·¸ì¸</div>
            <div class="step-d" data-i18n="step1_d">ì¹´ì¹´ì˜¤ë¡œ 3ì´ˆ ì‹œì‘</div>
          </div>
          <div class="step">
            <div class="step-num">STEP 2</div>
            <div class="step-t" data-i18n="step2_t">êµ¬ë§¤</div>
            <div class="step-d" data-i18n="step2_d">íŒ¨ìŠ¤ ê²°ì œ í›„ í™œì„±í™”</div>
          </div>
          <div class="step">
            <div class="step-num">STEP 3</div>
            <div class="step-t" data-i18n="step3_t">ì´ìš©</div>
            <div class="step-d" data-i18n="step3_d">QR ì œì‹œ í›„ í˜œíƒ ì ìš©</div>
          </div>
        </div>
      </div>

      <div class="card wallet" onclick="handleWalletClick()">
        <div class="wallet-inner">
          <div class="balance-label" data-i18n="wallet_label">ë‚´ íŒ¨ìŠ¤ ìƒíƒœ</div>
          <div id="balance" class="balance">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ ì´ë™</div>

          <div class="wallet-actions" id="walletActions" style="display:none;">
            <div class="pill ghost" onclick="openMyPass(); event.stopPropagation();">
              <i data-feather="credit-card" style="width:14px;"></i> <span data-i18n="wallet_my">ë‚´ íŒ¨ìŠ¤</span>
            </div>
            <div class="pill ghost" onclick="switchTab('map'); event.stopPropagation();">
              <i data-feather="map" style="width:14px;"></i> <span data-i18n="wallet_map">ì œíœ´ì²˜ ì°¾ê¸°</span>
            </div>
            <div class="pill ghost" onclick="openSupport(); event.stopPropagation();">
              <i data-feather="help-circle" style="width:14px;"></i> <span data-i18n="wallet_help">ê³ ê°ì„¼í„°</span>
            </div>
          </div>
        </div>
      </div>

      <div class="menu-grid">
        <div class="menu-item" onclick="filterMapAndGo('transport')">
          <div class="icon-box"><i data-feather="navigation"></i></div>
          <span class="menu-label" data-i18n="menu_transport">êµí†µ</span>
        </div>
        <div class="menu-item" onclick="filterMapAndGo('office')">
          <div class="icon-box"><i data-feather="briefcase"></i></div>
          <span class="menu-label" data-i18n="menu_office">ì›Œí¬ìŠ¤í˜ì´ìŠ¤</span>
        </div>
        <div class="menu-item" onclick="filterMapAndGo('gym')">
          <div class="icon-box"><i data-feather="activity"></i></div>
          <span class="menu-label" data-i18n="menu_gym">í—¬ìŠ¤</span>
        </div>
        <div class="menu-item" onclick="filterMapAndGo('food')">
          <div class="icon-box"><i data-feather="coffee"></i></div>
          <span class="menu-label" data-i18n="menu_cafe">ì¹´í˜</span>
        </div>
      </div>

      <div class="card">
        <div class="card-title" data-i18n="included_title">í¬í•¨ ì„œë¹„ìŠ¤</div>
        <div class="muted" data-i18n="included_desc">ì²´ë¥˜ ì¤‘ í•„ìš”í•œ í•µì‹¬ ì„œë¹„ìŠ¤ë¥¼ í•œ ë²ˆì—</div>

        <div class="benefits">
          <div class="benefit">
            <div class="b-ic"><i data-feather="coffee" style="width:18px;"></i></div>
            <div class="b-t" data-i18n="b_cafe_t">ì¹´í˜</div>
            <div class="b-d" data-i18n="b_cafe_d">íŒ¨ìŠ¤ í• ì¸</div>
          </div>
          <div class="benefit">
            <div class="b-ic"><i data-feather="activity" style="width:18px;"></i></div>
            <div class="b-t" data-i18n="b_gym_t">í—¬ìŠ¤</div>
            <div class="b-d" data-i18n="b_gym_d">ì œíœ´ ì‹œì„¤</div>
          </div>
          <div class="benefit">
            <div class="b-ic"><i data-feather="briefcase" style="width:18px;"></i></div>
            <div class="b-t" data-i18n="b_office_t">ì›Œí¬ìŠ¤í˜ì´ìŠ¤</div>
            <div class="b-d" data-i18n="b_office_d">ë¼ìš´ì§€/ì˜¤í”¼ìŠ¤</div>
          </div>
          <div class="benefit">
            <div class="b-ic"><i data-feather="phone-call" style="width:18px;"></i></div>
            <div class="b-t" data-i18n="b_support_t">ê¸´ê¸‰ì§€ì›</div>
            <div class="b-d" data-i18n="b_support_d">ë²ˆì—­/ë¶„ì‹¤/ì•ˆë‚´</div>
          </div>
          <div class="benefit">
            <div class="b-ic"><i data-feather="file-text" style="width:18px;"></i></div>
            <div class="b-t" data-i18n="b_receipt_t">ì´ìš©ë‚´ì—­</div>
            <div class="b-d" data-i18n="b_receipt_d">íšŒì‚¬ ì œì¶œìš©</div>
          </div>
          <div class="benefit">
            <div class="b-ic"><i data-feather="gift" style="width:18px;"></i></div>
            <div class="b-t" data-i18n="b_voucher_t">ì¿ í°/ë°”ìš°ì²˜</div>
            <div class="b-d" data-i18n="b_voucher_d">ë²ˆí˜¸/ì‚¬ìš©ì—¬ë¶€</div>
          </div>
        </div>
      </div>

      <!-- =========================
         âœ… 3ì¼ê¶Œ íŒ¨ìŠ¤ (7ì¼ê¶Œ ìœ„ì— ì¶”ê°€)
         - í˜œíƒ/ê°€ê²©: ê¸°ì¡´ ìŠ¤í™ ìœ ì§€(7ì¼ 99,000 / ì •ê°€ 129,000)
         - 3ì¼ê¶Œì€ ë™ì¼í•œ "í¬í•¨ ì„œë¹„ìŠ¤" ê¸°ë°˜ìœ¼ë¡œ ì§§ì€ ì²´ë¥˜ìš©
    ========================== -->
      <div class="card pass-card" onclick="openPassDetail('day3')">
        <div>
          <span class="tag">SHORT STAY</span>
          <div style="font-size:17px;font-weight:980;letter-spacing:-.3px;margin-bottom:4px;" data-i18n="p3_title">Living Day (3ì¼)</div>
          <div class="muted" data-i18n="p3_sub">ì§§ì€ ì¶œì¥/ë¯¸íŒ… ì¼ì •ì— ìµœì í™”ëœ ì²´ë¥˜ íŒ¨ìŠ¤</div>
          <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
            <div class="pill ghost" onclick="openSupport(); event.stopPropagation();">
              <i data-feather="shield" style="width:14px;"></i> <span data-i18n="btn_pay_safe">ê²°ì œì•ˆì‹¬</span>
            </div>
            <div class="pill ghost" onclick="openLegal('refund'); event.stopPropagation();">
              <i data-feather="rotate-ccw" style="width:14px;"></i> <span data-i18n="btn_refund">í™˜ë¶ˆê·œì •</span>
            </div>
          </div>
        </div>

        <div class="pass-right">
          <div style="text-align:right;line-height:1.1;">
            <div class="price-old" id="p3_old">ì •ê°€ 79,000ì›</div>
            <div class="price-new" id="p3_new">49,000ì›</div>
          </div>
          <button class="buy-btn" onclick="openPassDetail('day3'); event.stopPropagation();" data-i18n="btn_buy">êµ¬ë§¤í•˜ê¸°</button>
        </div>
      </div>

      <!-- 7ì¼ê¶Œ (ê¸°ì¡´) -->
      <div class="card pass-card" onclick="openPassDetail('week7')">
        <div>
          <span class="tag">EARLY BIRD</span>
          <div style="font-size:17px;font-weight:980;letter-spacing:-.3px;margin-bottom:4px;" data-i18n="p7_title">Living Week (7ì¼)</div>
          <div class="muted" data-i18n="p7_sub">ë¹„ì¦ˆë‹ˆìŠ¤ ì²´ë¥˜ì— í•„ìš”í•œ í˜œíƒì„ í•œ ë²ˆì— ë¬¶ì€ ì˜¬ì¸ì› íŒ¨ìŠ¤</div>
          <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
            <div class="pill ghost" onclick="openSupport(); event.stopPropagation();">
              <i data-feather="shield" style="width:14px;"></i> <span data-i18n="btn_pay_safe">ê²°ì œì•ˆì‹¬</span>
            </div>
            <div class="pill ghost" onclick="openLegal('refund'); event.stopPropagation();">
              <i data-feather="rotate-ccw" style="width:14px;"></i> <span data-i18n="btn_refund">í™˜ë¶ˆê·œì •</span>
            </div>
          </div>
        </div>

        <div class="pass-right">
          <div style="text-align:right;line-height:1.1;">
            <div class="price-old" id="p7_old">129,000ì›</div>
            <div class="price-new" id="p7_new">99,000ì›</div>
          </div>
          <button class="buy-btn" onclick="openPassDetail('week7'); event.stopPropagation();" data-i18n="btn_buy">êµ¬ë§¤í•˜ê¸°</button>
        </div>
      </div>

      <div class="card" style="padding:18px;">
        <div class="row" style="flex-wrap:wrap;">
          <div class="pill ghost" onclick="openLegal('terms')"><i data-feather="file" style="width:14px;"></i> <span data-i18n="legal_terms">ì´ìš©ì•½ê´€</span></div>
          <div class="pill ghost" onclick="openLegal('privacy')"><i data-feather="lock" style="width:14px;"></i> <span data-i18n="legal_privacy">ê°œì¸ì •ë³´</span></div>
          <div class="pill ghost" onclick="openLegal('refund')"><i data-feather="refresh-ccw" style="width:14px;"></i> <span data-i18n="legal_refund">í™˜ë¶ˆ/ì·¨ì†Œ</span></div>
          <div class="pill ghost" onclick="openSupport()"><i data-feather="message-circle" style="width:14px;"></i> <span data-i18n="legal_contact">ë¬¸ì˜</span></div>
        </div>
        <div class="muted" style="margin-top:12px;font-size:12px;" data-i18n="proto_note">
          * ë³¸ í™”ë©´ì€ ì‹œì—°/í”„ë¡œí† íƒ€ì… ëª©ì ì˜ UIì´ë©°, ì‹¤ì œ ì œíœ´/ìš´ì˜ ì •ë³´ëŠ” ì¶”í›„ ì ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>

    <!-- =========================
         MAP
    ========================== -->
    <div id="view-map" class="view">
      <div id="map"></div>

      <div class="map-top">
        <div class="map-search-btn" onclick="toggleMapSearch(true)">
          <i data-feather="search" style="width:16px;"></i> <span data-i18n="map_search">ê²€ìƒ‰</span>
        </div>

        <div id="mapSearchBar" class="map-search-bar">
          <input id="mapSearchInput" class="map-search-input" placeholder="ì œíœ´ì²˜/ì¥ì†Œ ê²€ìƒ‰" data-i18n-placeholder="map_placeholder"/>
          <button class="map-search-go" onclick="runMapSearch()" data-i18n="map_search">ê²€ìƒ‰</button>
          <button class="map-search-close" onclick="toggleMapSearch(false)" data-i18n="map_close">ë‹«ê¸°</button>
        </div>

        <div class="map-tools">
          <div class="near-btn" onclick="goNearMe()">
            <i data-feather="crosshair" style="width:16px;"></i> <span data-i18n="map_near">ë‚´ ì£¼ë³€</span>
          </div>
        </div>
      </div>

      <div class="map-filters" id="mapFilters"></div>
    </div>

    <!-- =========================
         MY
    ========================== -->
    <div id="view-my" class="view">
      <div class="card" style="text-align:center;">
        <img id="profileImg" src=""
             style="width:84px;height:84px;border-radius:50%;background:#e0e0e0;box-shadow:0 4px 15px rgba(0,0,0,.1);margin-bottom:10px;">
        <div id="profileName" style="font-size:20px;font-weight:980;letter-spacing:-.4px;">Guest</div>
        <div id="myPassText" class="muted" style="margin-top:8px;" data-i18n="my_guest">
          ë¡œê·¸ì¸í•˜ë©´ ë‚´ íŒ¨ìŠ¤/QRì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.
        </div>

        <button class="btn-main" style="background:#FEE500;color:#191919;margin-top:14px;" onclick="startKakaoLogin()">
          <span data-i18n="kakao_start">ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°</span>
        </button>
      </div>

      <div class="tabs">
        <div class="tab active" id="tab-pass" onclick="switchMyTab('pass')" data-i18n="my_tab_pass">ë‚´ íŒ¨ìŠ¤</div>
        <div class="tab" id="tab-voucher" onclick="switchMyTab('voucher')" data-i18n="my_tab_voucher">ë°”ìš°ì²˜</div>
        <div class="tab" id="tab-history" onclick="switchMyTab('history')" data-i18n="my_tab_history">ì´ìš©ë‚´ì—­</div>
      </div>

      <div id="my-pass" class="pass-big">
        <div id="passStatus" class="pass-status">
          <span class="dot inactive"></span>
          <span>INACTIVE</span>
        </div>
        <div style="font-size:18px;font-weight:980;letter-spacing:-.3px;" id="myPlanTitle">Living Week (7ì¼)</div>
        <div class="muted" style="margin-top:6px;" data-i18n="my_pass_desc">QR ì œì‹œ í›„ ì œíœ´ì²˜ì—ì„œ í˜œíƒì´ ì ìš©ë¼ìš”.</div>

        <div class="pass-metrics">
          <div class="metric">
            <div class="k" data-i18n="my_remain_k">ë‚¨ì€ ì‹œê°„</div>
            <div class="v" id="remainText">-</div>
          </div>
          <div class="metric">
            <div class="k" data-i18n="my_partner_k">ì‚¬ìš© ê°€ëŠ¥ ì œíœ´ì²˜</div>
            <div class="v" id="partnerCount">-</div>
          </div>
        </div>

        <div style="display:flex;gap:10px;margin-top:14px;">
          <div class="pill primary" style="flex:1;justify-content:center;" onclick="openQR()">
            <i data-feather="maximize" style="width:16px;"></i> <span data-i18n="my_qr">QR ë³´ê¸°</span>
          </div>
          <div class="pill ghost" style="flex:1;justify-content:center;" onclick="switchTab('map')">
            <i data-feather="map" style="width:16px;"></i> <span data-i18n="my_find">ì œíœ´ì²˜ ì°¾ê¸°</span>
          </div>
        </div>
      </div>

      <div id="my-voucher" style="display:none;">
        <div class="card">
          <div class="card-title" data-i18n="voucher_title">ë‚´ ì¿ í°/ë°”ìš°ì²˜</div>
          <div class="muted" data-i18n="voucher_desc">ë°”ìš°ì²˜ ë²ˆí˜¸ Â· ì‚¬ìš© ì—¬ë¶€ Â· í˜œíƒì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</div>
        </div>
        <div class="list-group" id="voucherList"></div>
      </div>

      <div id="my-history" style="display:none;">
        <div class="card">
          <div class="card-title" data-i18n="history_title">ì´ìš© ë‚´ì—­ / ì˜ìˆ˜ì¦</div>
          <div class="muted" data-i18n="history_desc">íšŒì‚¬ ì œì¶œìš© ì •ì‚°ì„ ê³ ë ¤í•œ â€œì„œë¹„ìŠ¤ê¸‰â€ êµ¬ì„±</div>
          <div style="margin-top:12px;">
            <div class="pill ghost" onclick="alert('PDF ë‹¤ìš´ë¡œë“œëŠ” í”„ë¡œí† íƒ€ì… ë‹¨ê³„ì—ì„œ ë²„íŠ¼ë§Œ ì œê³µ');">
              <i data-feather="download" style="width:14px;"></i> <span data-i18n="history_pdf">PDF ë‹¤ìš´ë¡œë“œ</span>
            </div>
          </div>
        </div>
        <div class="list-group" id="historyList"></div>
      </div>

      <div class="list-group" style="margin-top:16px;">
        <div class="list-row" onclick="openSupport()"><span data-i18n="support_title">ê³ ê°ì„¼í„°/ë¬¸ì˜</span><i data-feather="chevron-right" style="color:#c7c7c7;"></i></div>
        <div class="list-row" onclick="openLegal('terms')"><span data-i18n="legal_terms">ì´ìš©ì•½ê´€</span><i data-feather="chevron-right" style="color:#c7c7c7;"></i></div>
        <div class="list-row" onclick="openLegal('privacy')"><span data-i18n="legal_privacy">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</span><i data-feather="chevron-right" style="color:#c7c7c7;"></i></div>
        <div class="list-row" onclick="openLegal('refund')"><span data-i18n="legal_refund">í™˜ë¶ˆ/ì·¨ì†Œ ì •ì±…</span><i data-feather="chevron-right" style="color:#c7c7c7;"></i></div>
        <div class="list-row" style="color:#FF3B30;" onclick="handleLogout()"><span data-i18n="logout">ë¡œê·¸ì•„ì›ƒ</span><i data-feather="log-out"></i></div>
      </div>
    </div>

    <!-- =========================
         SUPPORT
    ========================== -->
    <div id="view-support" class="view">
      <div class="card">
        <div class="card-title" data-i18n="support_title">ê³ ê°ì„¼í„° / ë¬¸ì˜</div>
        <div class="muted" data-i18n="support_desc">
          ìš´ì˜ ì „ ì‹œì—°ìš© í™”ë©´ì…ë‹ˆë‹¤. ì‹¤ì œ ì„œë¹„ìŠ¤ ìš´ì˜ ì‹œ ë¬¸ì˜ ì±„ë„ê³¼ ì •ì±…ì„ í•¨ê»˜ ì œê³µí•©ë‹ˆë‹¤.
        </div>
        <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap;">
          <div class="pill ghost" onclick="alert('ì´ë©”ì¼: support@bpass.example (ì‹œì—°ìš©)')">
            <i data-feather="mail" style="width:14px;"></i> <span data-i18n="support_email">ì´ë©”ì¼</span>
          </div>
          <div class="pill ghost" onclick="alert('ì¹´ì¹´ì˜¤ì±„ë„: @bpassliving (ì‹œì—°ìš©)')">
            <i data-feather="message-circle" style="width:14px;"></i> <span data-i18n="support_kakao">ì¹´ì¹´ì˜¤ì±„ë„</span>
          </div>
          <div class="pill ghost" onclick="openLegal('refund')">
            <i data-feather="rotate-ccw" style="width:14px;"></i> <span data-i18n="legal_refund">í™˜ë¶ˆê·œì •</span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title" data-i18n="faq_title">FAQ</div>
        <div class="muted" data-i18n="faq_sub">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</div>

        <div style="margin-top:12px;display:flex;flex-direction:column;gap:10px;">
          <div class="card" style="margin:0;padding:16px;" onclick="toggleFaq(this)">
            <div class="row">
              <div style="font-weight:950;" data-i18n="faq_q1">íŒ¨ìŠ¤ êµ¬ë§¤ í›„ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‚˜ìš”?</div>
              <i data-feather="chevron-down"></i>
            </div>
            <div class="muted" style="margin-top:10px;display:none;" data-i18n="faq_a1">
              ê²°ì œ ì™„ë£Œ í›„ íŒ¨ìŠ¤ê°€ ACTIVEë¡œ ì „í™˜ë˜ë©´ ì¦‰ì‹œ í™œì„±í™”ë©ë‹ˆë‹¤.
            </div>
          </div>

          <div class="card" style="margin:0;padding:16px;" onclick="toggleFaq(this)">
            <div class="row">
              <div style="font-weight:950;" data-i18n="faq_q2">ì œíœ´ì²˜ì—ì„œ ì–´ë–¤ í˜œíƒì„ ë°›ë‚˜ìš”?</div>
              <i data-feather="chevron-down"></i>
            </div>
            <div class="muted" style="margin-top:10px;display:none;" data-i18n="faq_a2">
              ì¥ì†Œ ìƒì„¸ í™”ë©´ì— â€œí˜œíƒ ë¬¸êµ¬â€ë¡œ ëª…í™•íˆ í‘œì‹œë©ë‹ˆë‹¤.
            </div>
          </div>

          <div class="card" style="margin:0;padding:16px;" onclick="toggleFaq(this)">
            <div class="row">
              <div style="font-weight:950;" data-i18n="faq_q3">ì˜ìˆ˜ì¦/ì •ì‚° ìë£Œê°€ í•„ìš”í•´ìš”.</div>
              <i data-feather="chevron-down"></i>
            </div>
            <div class="muted" style="margin-top:10px;display:none;" data-i18n="faq_a3">
              MY > ì´ìš©ë‚´ì—­ì—ì„œ ì‚¬ìš©ì²˜/ì‹œê°„/í˜œíƒ ì ìš© ë‚´ì—­ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì‹œì—°ìš©)
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title" data-i18n="pay_safe_title">ê²°ì œì•ˆì‹¬ ì•ˆë‚´</div>
        <div class="muted" style="line-height:1.5;" data-i18n="pay_safe_desc">
          ê²°ì œ ìœ„ì ¯ ê¸°ë°˜(í”„ë¡œí† íƒ€ì…)ìœ¼ë¡œ â€œê²°ì œ ì‹ ë¢° ìš”ì†Œâ€ë¥¼ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.<br>
          ì‹¤ì œ ìš´ì˜ ì‹œì—ëŠ” ì•½ê´€/í™˜ë¶ˆ/ë¬¸ì˜ ì±„ë„ì„ í•¨ê»˜ ì œê³µí•´ ì‹ ë¢°ë„ë¥¼ ê°•í™”í•©ë‹ˆë‹¤.
        </div>
      </div>
    </div>

    <!-- =========================
         NAV
    ========================== -->
    <div class="nav-container">
      <div class="nav-dock">
        <div class="nav-item active" onclick="switchTab('home')"><i data-feather="home"></i></div>
        <div class="qr-btn" onclick="openQR()"><i data-feather="maximize" style="width:24px;height:24px;"></i></div>
        <div class="nav-item" onclick="switchTab('map')"><i data-feather="map"></i></div>
        <div class="nav-item" onclick="openRecommendModal()"><i data-feather="star"></i></div>
        <div class="nav-item" onclick="switchTab('my')"><i data-feather="user"></i></div>
        <div class="nav-item" onclick="switchTab('support')"><i data-feather="help-circle"></i></div>
      </div>
    </div>

    <!-- =========================
         ONBOARDING
    ========================== -->
    <div id="onboarding" class="onb">
      <div class="onb-card">
        <div class="onb-top">
          <div class="pill ghost" onclick="switchOnb(-1)"><i data-feather="chevron-left" style="width:14px;"></i> <span data-i18n="prev">ì´ì „</span></div>
          <div class="skip" onclick="closeOnboarding()" data-i18n="skip">ê±´ë„ˆë›°ê¸°</div>
        </div>

        <div class="onb-slide active">
          <div class="onb-h">BÂ·PASS Living</div>
          <div class="onb-desc" data-i18n="onb1">
            Business ì²´ë¥˜ ì¤‘ í•„ìš”í•œ ì„œë¹„ìŠ¤ë¥¼ <b>íŒ¨ìŠ¤ í•˜ë‚˜</b>ë¡œ ì—°ê²°í•´ìš”.<br>
            êµí†µ Â· ì›Œí¬ìŠ¤í˜ì´ìŠ¤ Â· í—¬ìŠ¤ Â· ì¹´í˜ í• ì¸ Â· ê¸´ê¸‰ì§€ì›ì„ í•œ ë²ˆì—.
          </div>
        </div>

        <div class="onb-slide">
          <div class="onb-h" data-i18n="onb2_title">ì•±ì²˜ëŸ¼ ê°„ë‹¨í•˜ê²Œ</div>
          <div class="onb-desc" data-i18n="onb2">
            â‘  ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ â†’ â‘¡ íŒ¨ìŠ¤ êµ¬ë§¤ â†’ â‘¢ QRë¡œ ì œíœ´ì²˜ ì´ìš©.<br>
            ì§€ë„ì—ì„œ ì œíœ´ì²˜ë¥¼ ì°¾ê³ , ìƒì„¸ í™”ë©´ì—ì„œ í˜œíƒì„ í™•ì¸í•˜ì„¸ìš”.
          </div>
        </div>

        <div class="onb-slide">
          <div class="onb-h" data-i18n="onb3_title">ì‹ ë¢° ìš”ì†Œê¹Œì§€</div>
          <div class="onb-desc" data-i18n="onb3">
            ì´ìš©ì•½ê´€/ê°œì¸ì •ë³´/í™˜ë¶ˆì •ì±…/ë¬¸ì˜ ì±„ë„ì„ ì œê³µí•´ìš”.<br>
          </div>
        </div>

        <div class="dots">
          <div class="dot2 active"></div>
          <div class="dot2"></div>
          <div class="dot2"></div>
        </div>

        <div class="onb-actions">
          <div class="pill ghost" onclick="switchOnb(1)"><i data-feather="chevron-right" style="width:14px;"></i> <span data-i18n="next">ë‹¤ìŒ</span></div>
          <div class="pill primary" onclick="finishOnboarding()"><i data-feather="check" style="width:14px;"></i> <span data-i18n="start">ì‹œì‘í•˜ê¸°</span></div>
        </div>
      </div>
    </div>

    <!-- =========================
         LOGIN MODAL (ìœ ì§€: í˜¹ì‹œ ëŒ€ë¹„)
         - í•˜ì§€ë§Œ "ë¡œê·¸ì¸í•˜ì„¸ìš”" íë¦„ì€ ì´ì œ ì¹´ì¹´ì˜¤ë¡œ ì¦‰ì‹œ ì´ë™í•˜ë„ë¡ ë³€ê²½
    ========================== -->
    <div id="loginModal" class="overlay">
      <div class="modal">
        <div class="grab"></div>
        <h2 data-i18n="login_title">ë¡œê·¸ì¸</h2>
        <p data-i18n="login_desc">ì†Œì…œ ê³„ì •ìœ¼ë¡œ 3ì´ˆ ë§Œì— ì‹œì‘í•˜ì„¸ìš”. (ê²ŒìŠ¤íŠ¸ ëª¨ë“œë¡œë„ ë‘˜ëŸ¬ë³¼ ìˆ˜ ìˆì–´ìš”)</p>
        <button class="btn-main" style="background:#FEE500;color:#191919;" onclick="startKakaoLogin()" data-i18n="kakao_login">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸</button>
        <button class="btn-sub" onclick="closeModal('loginModal')" data-i18n="close">ë‹«ê¸°</button>
      </div>
    </div>

    <!-- =========================
         LANG MODAL
    ========================== -->
    <div id="langModal" class="overlay">
      <div class="modal">
        <div class="grab"></div>
        <h2 data-i18n="lang_title">ì–¸ì–´ ì„ íƒ</h2>
        <p data-i18n="lang_desc">ì–´ë–¤ ì–¸ì–´ë¡œ ë³¼ê¹Œìš”?</p>

        <div style="margin-top:14px;display:flex;flex-direction:column;gap:10px;">
          <div class="pill ghost" onclick="selectLang('kr')">ğŸ‡°ğŸ‡· í•œêµ­ì–´</div>
          <div class="pill ghost" onclick="selectLang('en')">ğŸ‡ºğŸ‡¸ English</div>
          <div class="pill ghost" onclick="selectLang('cn')">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</div>
          <div class="pill ghost" onclick="selectLang('jp')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</div>
        </div>

        <button class="btn-sub" onclick="closeModal('langModal')" data-i18n="close">ë‹«ê¸°</button>
      </div>
    </div>

    <!-- =========================
         PASS DETAIL MODAL
         - 3ì¼/7ì¼ íƒ­ìœ¼ë¡œ ì „í™˜
         - íƒì‹œ ì¹´ë“œ ì œê±°(ìš”ì²­ ë°˜ì˜)
    ========================== -->
    <div id="passDetailModal" class="overlay">
      <div class="modal" style="position:relative;">
        <div class="grab"></div>

        <div class="row" style="align-items:flex-start;">
          <div>
            <div class="tag" id="pdTag">EARLY BIRD</div>
            <h2 style="margin:0;" id="pdTitle">Living Week (7ì¼)</h2>
            <p style="margin-top:8px;" id="pdDesc">
              ë¹„ì¦ˆë‹ˆìŠ¤ ì¼ì •ì˜ â€œì²´ë¥˜ ë²ˆê±°ë¡œì›€â€ì„ ì¤„ì´ëŠ” ì˜¬ì¸ì› íŒ¨ìŠ¤.
            </p>
          </div>
          <div class="pill ghost" onclick="closeModal('passDetailModal')">
            <i data-feather="x" style="width:14px;"></i> <span data-i18n="close">ë‹«ê¸°</span>
          </div>
        </div>

        <div class="tabs" style="margin-top:14px;">
          <div class="tab" id="pd-tab-3" onclick="setPassPlan('day3', true)">3ì¼</div>
          <div class="tab" id="pd-tab-7" onclick="setPassPlan('week7', true)">7ì¼</div>
        </div>

        <div class="card" style="margin-top:10px;">
          <div class="card-title" data-i18n="included_title">í¬í•¨ ì„œë¹„ìŠ¤</div>
          <div class="muted" style="line-height:1.55;" data-i18n="pd_included_line">
            êµí†µ Â· ì›Œí¬ìŠ¤í˜ì´ìŠ¤ Â· í—¬ìŠ¤ Â· ì¹´í˜/ì‹ìŒ í• ì¸ Â· ê¸´ê¸‰ì§€ì› Â· ì •ì‚°ìš© ì´ìš©ë‚´ì—­ Â· ì¿ í°/ë°”ìš°ì²˜
          </div>
        </div>

        <div class="card">
          <div class="card-title" data-i18n="pd_move_title">ì´ë™/êµí†µ</div>
          <div class="muted" style="line-height:1.55;" data-i18n="pd_move_desc">
            í˜„ì§€ ì´ë™ì— ë„ì›€ì´ ë˜ëŠ” ì œíœ´ì²˜/ì•ˆë‚´ë¥¼ ì§€ë„ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.<br>
            (ì˜ˆ: êµí†µ í¸ì˜, ì¶©ì „/ì•ˆë‚´, ì´ë™ ë™ì„  ìµœì í™” â€“ ì‹œì—°ìš©)
          </div>
          <div style="margin-top:12px;">
            <div class="pill ghost" onclick="switchTab('map'); filterMapAndGo('transport'); closeModal('passDetailModal'); event.stopPropagation();">
              <i data-feather="map-pin" style="width:14px;"></i> <span data-i18n="pd_view_transport">êµí†µ ì œíœ´ì²˜ ë³´ê¸°</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title" data-i18n="pd_stay_title">ìˆ™ì†Œ(ì¶”ì²œí˜•)</div>
          <div class="muted" style="line-height:1.55;" data-i18n="pd_stay_desc">
            íŒ¨ìŠ¤ ê°€ê²©ì— ìˆ™ì†Œë¥¼ í¬í•¨í•˜ì§€ ì•Šê³ , <b style="color:var(--text);">ì£¼ìš” ê±°ì  ì¸ê·¼ ì¶”ì²œ ìˆ™ì†Œ</b>ë¥¼ ì•ˆë‚´í•´ìš”.<br>
            (ì˜ˆì•½/ê²°ì œëŠ” ìˆ™ì†Œë³„ ì±„ë„ì—ì„œ ì§„í–‰)
          </div>
          <div style="margin-top:12px;">
            <div class="pill ghost" onclick="openRecommendModal(); event.stopPropagation();">
              <i data-feather="star" style="width:14px;"></i> <span data-i18n="pd_view_stay">ìˆ™ì†Œ ì¶”ì²œ ë³´ê¸°</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title" data-i18n="pd_area_title">ì´ìš© ê°€ëŠ¥ ì§€ì—­/ì œíœ´ì²˜</div>
          <div class="muted" data-i18n="pd_area_desc">ì§€ë„ì—ì„œ ì¹´í…Œê³ ë¦¬ í•„í„°ë¡œ ì œíœ´ì²˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</div>
          <div style="margin-top:12px;">
            <div class="pill ghost" onclick="switchTab('map'); closeModal('passDetailModal');">
              <i data-feather="map-pin" style="width:14px;"></i> <span data-i18n="pd_view_map">ì œíœ´ì²˜ ì§€ë„ ë³´ê¸°</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title" data-i18n="pd_refund_title">ìœ ì˜ì‚¬í•­/í™˜ë¶ˆ ìš”ì•½</div>
          <div class="muted" style="line-height:1.55;" data-i18n="pd_refund_desc">
            ê²°ì œ í›„ ì‚¬ìš© ì „/í›„ ìƒíƒœì— ë”°ë¼ í™˜ë¶ˆ ê·œì •ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì‹œì—°ìš©).<br>
            ìì„¸í•œ ë‚´ìš©ì€ â€œí™˜ë¶ˆ/ì·¨ì†Œ ì •ì±…â€ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”.
          </div>
          <div style="margin-top:12px;">
            <div class="pill ghost" onclick="openLegal('refund')">
              <i data-feather="rotate-ccw" style="width:14px;"></i> <span data-i18n="legal_refund">í™˜ë¶ˆ/ì·¨ì†Œ ì •ì±… ë³´ê¸°</span>
            </div>
          </div>
        </div>

        <div style="position:sticky;bottom:0;background:linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.96) 35%, rgba(255,255,255,1) 100%);padding-top:10px;">
          <div class="row" style="align-items:flex-end;">
            <div>
              <div class="price-old" id="pdOld">ì •ê°€ 129,000ì›</div>
              <div class="price-new" id="pdNew">ì–¼ë¦¬ë²„ë“œ 99,000ì›</div>
            </div>
            <button class="buy-btn" style="width:170px;" onclick="openPayment()" data-i18n="btn_pay">êµ¬ë§¤/ê²°ì œ</button>
          </div>
        </div>
      </div>
    </div>

    <!-- =========================
         PAYMENT MODAL
    ========================== -->
    <div id="paymentSheet" class="overlay">
      <div class="modal">
        <div class="grab"></div>
        <h2 id="payName">Living Week (7ì¼)</h2>
        <p id="payPrice"><b style="color:var(--primary);">ì–¼ë¦¬ë²„ë“œ 99,000ì›</b> (ì •ê°€ 129,000ì›)</p>
        <div class="muted" style="margin-top:8px;" data-i18n="pay_desc">ì•„ë˜ ê²°ì œìˆ˜ë‹¨ ì„ íƒ í›„ ê²°ì œí•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>

        <div id="payment-method" style="margin-top:14px;"></div>

        <button class="btn-main" id="btnPayNow" onclick="requestPay()" data-i18n="pay_now">ê²°ì œí•˜ê¸°</button>
        <button class="btn-sub" onclick="closeModal('paymentSheet')" data-i18n="close">ë‹«ê¸°</button>
      </div>
    </div>

    <!-- =========================
         QR MODAL
    ========================== -->
    <div id="qrModal" class="overlay">
      <div class="modal" style="text-align:center;">
        <div class="grab"></div>

        <div class="cert-wrap" style="text-align:left;">
          <div class="cert">
            <div class="cert-top">
              <div class="cert-brand">
                <div class="b1">
                  <span style="display:inline-flex;align-items:center;gap:8px;">
                    <span style="width:10px;height:10px;border-radius:50%;background:rgba(204,248,2,.95);box-shadow:0 0 0 6px rgba(204,248,2,.16);"></span>
                    BÂ·PASS Living
                  </span>
                </div>

                <div id="certChip" class="cert-chip">
                  <span class="mini-dot"></span>
                  <span id="certStatusText">INACTIVE</span>
                </div>
              </div>

              <div class="cert-qr">
                <img id="qrImg"
                     src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=BPASS"
                     alt="B-PASS QR" />
              </div>
            </div>

            <div class="cert-mid">
              <div class="cert-name" id="certName">Guest</div>
              <div class="cert-sub" id="certSub" data-i18n="qr_sub">
                ë¹„íŒ¨ìŠ¤ íšŒì›ì¦(ì‹œì—°ìš©) Â· ì œíœ´ì²˜ì—ì„œ QRë¡œ ì¸ì¦í•˜ì„¸ìš”.
              </div>

              <div class="cert-grid">
                <div class="cert-field">
                  <div class="k" data-i18n="qr_id">íšŒì› ID</div>
                  <div class="v" id="certMemberId">-</div>
                </div>
                <div class="cert-field">
                  <div class="k" data-i18n="qr_plan">íŒ¨ìŠ¤</div>
                  <div class="v" id="certPlan">Living Week (7ì¼)</div>
                </div>
                <div class="cert-field">
                  <div class="k" data-i18n="qr_issued">ë°œê¸‰ì¼</div>
                  <div class="v" id="certIssuedAt">-</div>
                </div>
                <div class="cert-field">
                  <div class="k" data-i18n="qr_expire">ë§Œë£Œ</div>
                  <div class="v" id="certExpireAt">-</div>
                </div>
              </div>

              <div class="cert-bar"></div>

              <div class="cert-foot">
                <div class="mini" id="qrRemain" data-i18n="qr_need_login">ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥</div>
                <div class="pill" onclick="switchTab('my'); closeModal('qrModal');">
                  <i data-feather="user" style="width:14px;"></i> <span data-i18n="go_my">MYë¡œ ì´ë™</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <button class="btn-sub" onclick="closeModal('qrModal')" data-i18n="close">ë‹«ê¸°</button>
      </div>
    </div>

    <!-- =========================
         PLACE BOTTOM SHEET
    ========================== -->
    <div id="placeSheet" class="sheet-overlay" onclick="closePlaceSheet(event)">
      <div class="sheet" onclick="event.stopPropagation()">
        <div class="grab"></div>
        <div class="place-head">
          <div>
            <div class="place-name" id="psName">ì¥ì†Œëª…</div>
            <div class="place-meta" id="psMeta">ì¹´í…Œê³ ë¦¬ Â· ìš´ì˜ì‹œê°„ Â· ê±°ë¦¬</div>
            <div class="benefit-badge" id="psBenefit">
              <i data-feather="percent" style="width:14px;"></i> íŒ¨ìŠ¤ ì†Œì§€ì í˜œíƒ
            </div>
          </div>
          <div class="pill ghost" onclick="hidePlaceSheet()">
            <i data-feather="x" style="width:14px;"></i>
          </div>
        </div>

        <div class="muted" id="psDesc" style="line-height:1.55;">
          ìƒì„¸ ì„¤ëª… ì˜ì—­
        </div>

        <div class="sheet-actions" id="sheetActions">
          <div class="pill primary" onclick="openQR()"><i data-feather="maximize" style="width:16px;"></i> QR ì œì‹œ</div>
          <div class="pill ghost" onclick="openDirections()"><i data-feather="navigation" style="width:16px;"></i> ê¸¸ì°¾ê¸°</div>
          <div class="pill ghost" onclick="alert('í˜œíƒ/ì´ìš©ì¡°ê±´ì€ ì‹œì—°ìš© ë¬¸êµ¬ì…ë‹ˆë‹¤.')"><i data-feather="info" style="width:16px;"></i> ì´ìš©ì¡°ê±´</div>
        </div>
      </div>
    </div>

    <!-- =========================
         LEGAL MODAL
    ========================== -->
    <div id="legalModal" class="overlay">
      <div class="modal">
        <div class="grab"></div>
        <div class="row">
          <h2 id="legalTitle" style="margin:0;">ì•½ê´€</h2>
          <div class="pill ghost" onclick="closeModal('legalModal')"><i data-feather="x" style="width:14px;"></i> <span data-i18n="close">ë‹«ê¸°</span></div>
        </div>
        <div id="legalBody" class="muted" style="margin-top:12px;line-height:1.6;white-space:pre-line;"></div>
      </div>
    </div>

    <!-- =========================
         ì¶”ì²œ ëª¨ë‹¬ (â­)
    ========================== -->
    <div id="recommendModal" class="overlay">
      <div class="modal">
        <div class="grab"></div>

        <div class="row" style="align-items:flex-start;">
          <div>
            <h2 id="recModalTitle" style="margin:0;">ì¶”ì²œ</h2>
            <p id="recModalDesc" style="margin-top:8px;">ì¹´í…Œê³ ë¦¬ë³„ ì¶”ì²œ í•­ëª©ì„ ì„ íƒí•´ í™•ì¸í•˜ì„¸ìš”. (ì‹œì—°ìš©)</p>
          </div>
          <div class="pill ghost" onclick="closeModal('recommendModal')">
            <i data-feather="x" style="width:14px;"></i> <span data-i18n="close">ë‹«ê¸°</span>
          </div>
        </div>

        <div class="tabs" style="margin-top:14px;">
          <div class="tab active" id="rm-stay" onclick="setRecommendCat('stay', true)" data-i18n="rec_stay">ìˆ™ì†Œ</div>
          <div class="tab" id="rm-cafe" onclick="setRecommendCat('food', true)" data-i18n="rec_cafe">ì¹´í˜</div>
          <div class="tab" id="rm-restaurant" onclick="setRecommendCat('restaurant', true)" data-i18n="rec_rest">ìŒì‹ì </div>
          <div class="tab" id="rm-office" onclick="setRecommendCat('office', true)" data-i18n="rec_office">ê³µìœ  ì˜¤í”¼ìŠ¤</div>
        </div>

        <div class="rec-list" id="recModalList"></div>

        <button class="btn-sub" onclick="closeModal('recommendModal')" data-i18n="close">ë‹«ê¸°</button>
      </div>
    </div>

  </div>

  <script>
    feather.replace();

    let map = null;
    let markers = [];
    let myMarker = null;
    let lastOpenedPartner = null;
    let currentFilter = "all";
    let currentPartnerIdForDirections = null;

    const state = {
      loggedIn:false,
      user:null,
      pass:null,
      tossClientKey:null,
      plan:null,
      paymentWidget:null,
      pendingOrder:null,
      myTab:"pass",
      recommendCat: "stay",

      // âœ… ì„ íƒëœ ìƒí’ˆ(3ì¼/7ì¼)
      selectedPlanId: "week7",

      // âœ… ì–¸ì–´
      lang: localStorage.getItem("bpass_lang") || "kr"
    };

    // âœ… ìš”ê¸ˆ/ìŠ¤í™ (7ì¼: ê¸°ì¡´ ìŠ¤í™ ìœ ì§€)
    // - 3ì¼ê¶Œ ê°€ê²©ì€ SHORT STAY ìŠ¤í™ìœ¼ë¡œ í‘œê¸°(í•„ìš”í•˜ë©´ ì—¬ê¸°ë§Œ ë°”ê¾¸ë©´ ì „ì²´ ë°˜ì˜ë¨)
    const PLANS = {
      day3:  { id:"day3",  tag:"SHORT STAY", title:"Living Day (3ì¼)", sub:"ì§§ì€ ì¶œì¥/ë¯¸íŒ… ì¼ì •ì— ìµœì í™”ëœ ì²´ë¥˜ íŒ¨ìŠ¤", old:"79,000ì›",  now:"49,000ì›",
              payLine:`<b style="color:var(--primary);">ì–¼ë¦¬ë²„ë“œ 49,000ì›</b> (ì •ê°€ 79,000ì›)` },
      week7: { id:"week7", tag:"EARLY BIRD", title:"Living Week (7ì¼)", sub:"ë¹„ì¦ˆë‹ˆìŠ¤ ì²´ë¥˜ì— í•„ìš”í•œ í˜œíƒì„ í•œ ë²ˆì— ë¬¶ì€ ì˜¬ì¸ì› íŒ¨ìŠ¤", old:"129,000ì›", now:"99,000ì›",
              payLine:`<b style="color:var(--primary);">ì–¼ë¦¬ë²„ë“œ 99,000ì›</b> (ì •ê°€ 129,000ì›)` }
    };

    const CATS = [
      { id:"all", label:"ì „ì²´" },
      { id:"office", label:"ì›Œí¬ìŠ¤í˜ì´ìŠ¤" },
      { id:"food", label:"ì¹´í˜" },
      { id:"restaurant", label:"ìŒì‹ì " },
      { id:"gym", label:"í—¬ìŠ¤" },
      { id:"transport", label:"êµí†µ" },
      { id:"stay", label:"ìˆ™ì†Œ(ì¶”ì²œ)" },
      { id:"pharmacy", label:"ì•½êµ­" },
      { id:"hospital", label:"ë³‘ì›" },
      { id:"exchange", label:"í™˜ì „" },
    ];

    // âœ… íƒì‹œ ê´€ë ¨ ë°ì´í„° ì œê±° + êµí†µì€ 'ì´ë™ ì§€ì›/ì•ˆë‚´' ì¤‘ì‹¬ìœ¼ë¡œ êµ¬ì„±
    const partners = [
      { id:"p1", name:"WeWork Partner Space", cat:"office", coords:[35.1631,129.1635], hours:"10:00-18:00",
        benefit:"ë°ì´íŒ¨ìŠ¤ 10% í• ì¸", desc:"ì—…ë¬´ ì§‘ì¤‘ì´ í•„ìš”í•œ ë‚ ì„ ìœ„í•œ ì½”ì›Œí‚¹ ì œíœ´(ì‹œì—°ìš©). ì¢Œì„/íšŒì˜ì‹¤ í˜œíƒì„ ì œê³µí•©ë‹ˆë‹¤." },
      { id:"p2", name:"Coffee Partner", cat:"food", coords:[35.1595,129.0604], hours:"08:00-22:00",
        benefit:"10% í• ì¸", desc:"ë¯¸íŒ…/ì—…ë¬´ ì „í›„ë¡œ ë“¤ë¥´ê¸° ì¢‹ì€ ì¹´í˜ ì œíœ´(ì‹œì—°ìš©). ë©”ë‰´ 10% í˜œíƒì„ ì œê³µí•©ë‹ˆë‹¤." },
      { id:"p3", name:"Fitness Partner", cat:"gym", coords:[35.1060,129.0320], hours:"06:00-24:00",
        benefit:"ì…ì¥ 1íšŒ í˜œíƒ", desc:"ì²´ë¥˜ ì¤‘ ë¦¬í”„ë ˆì‹œë¥¼ ìœ„í•œ í”¼íŠ¸ë‹ˆìŠ¤ ì œíœ´ ì˜ˆì‹œ(ì‹œì—°ìš©)." },
      { id:"p4", name:"Exchange Partner", cat:"exchange", coords:[35.1602,129.0612], hours:"10:00-18:00",
        benefit:"í™˜ìœ¨ ìš°ëŒ€ ì•ˆë‚´", desc:"ê²°ì œ/í™˜ì „ í¸ì˜ë¥¼ ìœ„í•œ ì•ˆë‚´ ì œíœ´(ì‹œì—°ìš©)." },
      { id:"p5", name:"Pharmacy Partner", cat:"pharmacy", coords:[35.1584,129.0630], hours:"09:00-21:00",
        benefit:"ê¸°ë³¸ ìƒë‹´ ì•ˆë‚´", desc:"ê¸´ê¸‰ ì§€ì› UX(ì•½êµ­/ì˜ë£Œ/ë¶„ì‹¤ ë“±) ì—°ê²°ì„ ìœ„í•œ ì œíœ´ì²˜ ì˜ˆì‹œ(ì‹œì—°ìš©)." },
      { id:"p6", name:"Clinic Partner", cat:"hospital", coords:[35.1611,129.0588], hours:"10:00-17:00",
        benefit:"ê¸´ê¸‰ ì—°ê²° ì•ˆë‚´", desc:"ì˜ë£Œ/ê¸´ê¸‰ ì§€ì› ë™ì„  UXë¥¼ ìœ„í•œ ì˜ˆì‹œ ì œíœ´ì²˜(ì‹œì—°ìš©)." },

      { id:"t1", name:"Transit Support Point", cat:"transport", coords:[35.1559,129.0586], hours:"09:00-20:00",
        benefit:"ë…¸ì„ /ì¶©ì „ ì•ˆë‚´(ì‹œì—°)", desc:"í˜„ì§€ ì´ë™ì„ ë” ë¹ ë¥´ê²Œ: ë…¸ì„  ì•ˆë‚´/ì¶©ì „ ë“± êµí†µ í¸ì˜ ì•ˆë‚´ ì œíœ´ ì˜ˆì‹œ(ì‹œì—°ìš©)." },

      { id:"stay1", name:"BEXCO Nearby Hotel A (ì¶”ì²œ)", cat:"stay", coords:[35.1688,129.1362], hours:"ì²´í¬ì¸/ì•„ì›ƒ: ìˆ™ì†Œë³„ ìƒì´",
        benefit:"ì¶”ì²œ(í• ì¸/ì œê³µ X)", desc:"íŒ¨ìŠ¤ì— ìˆ™ì†Œ ë¹„ìš©ì€ í¬í•¨ë˜ì§€ ì•Šìœ¼ë©°, ì£¼ìš” ê±°ì  ì¸ê·¼ ìˆ™ì†Œë¥¼ ì¶”ì²œ í˜•íƒœë¡œ ì•ˆë‚´í•©ë‹ˆë‹¤(ì‹œì—°ìš©)." },
      { id:"stay2", name:"Busan Port Nearby Hotel B (ì¶”ì²œ)", cat:"stay", coords:[35.1004,129.0406], hours:"ì²´í¬ì¸/ì•„ì›ƒ: ìˆ™ì†Œë³„ ìƒì´",
        benefit:"ì¶”ì²œ(í• ì¸/ì œê³µ X)", desc:"ë¶€ì‚°í•­ ì¸ê·¼ ìˆ™ì†Œ ì¶”ì²œ(ì‹œì—°ìš©). ì˜ˆì•½/ê²°ì œëŠ” ìˆ™ì†Œ ì±„ë„ì—ì„œ ì§„í–‰ë©ë‹ˆë‹¤." },
      { id:"stay3", name:"Haeundae Stay C (ì¶”ì²œ)", cat:"stay", coords:[35.1636,129.1639], hours:"ì²´í¬ì¸/ì•„ì›ƒ: ìˆ™ì†Œë³„ ìƒì´",
        benefit:"ì¶”ì²œ(í• ì¸/ì œê³µ X)", desc:"í•´ìš´ëŒ€ ê¶Œì—­ ìˆ™ì†Œ ì¶”ì²œ(ì‹œì—°ìš©). ì´ë™/ì—…ë¬´ ë™ì„ ì— ì í•©." },
      { id:"stay4", name:"Seomyeon Stay D (ì¶”ì²œ)", cat:"stay", coords:[35.1577,129.0592], hours:"ì²´í¬ì¸/ì•„ì›ƒ: ìˆ™ì†Œë³„ ìƒì´",
        benefit:"ì¶”ì²œ(í• ì¸/ì œê³µ X)", desc:"ì„œë©´ ê¶Œì—­ ìˆ™ì†Œ ì¶”ì²œ(ì‹œì—°ìš©). êµí†µ ì ‘ê·¼ì„± ì¤‘ì‹¬." },

      { id:"cafe1", name:"Gwangalli Coffee Spot", cat:"food", coords:[35.1531,129.1188], hours:"09:00-23:00",
        benefit:"íŒ¨ìŠ¤ 10% í• ì¸(ì‹œì—°)", desc:"ê´‘ì•ˆë¦¬ ì¸ê·¼ ì¹´í˜ ì¶”ì²œ(ì‹œì—°ìš©). ê°€ë³ê²Œ ë¯¸íŒ…í•˜ê¸° ì¢‹ì€ ìŠ¤íŒŸ." },
      { id:"cafe2", name:"Centum Coffee Lounge", cat:"food", coords:[35.1695,129.1305], hours:"08:30-21:30",
        benefit:"íŒ¨ìŠ¤ 10% í• ì¸(ì‹œì—°)", desc:"ì„¼í…€ ê¶Œì—­ ì¹´í˜(ì‹œì—°ìš©). í–‰ì‚¬ ì „í›„ ë™ì„ ì— í¸ë¦¬." },
      { id:"cafe3", name:"Nampo Coffee Bar", cat:"food", coords:[35.0975,129.0347], hours:"10:00-22:00",
        benefit:"íŒ¨ìŠ¤ 10% í• ì¸(ì‹œì—°)", desc:"ë‚¨í¬ë™ ì¸ê·¼ ì¹´í˜(ì‹œì—°ìš©). ì´ë™ ì¤‘ ì ê¹ ì—…ë¬´ ë³´ê¸° ì¢‹ìŒ." },

      { id:"rest1", name:"Busan Local Dining (Seomyeon)", cat:"restaurant", coords:[35.1579,129.0583], hours:"11:00-22:00",
        benefit:"íŒ¨ìŠ¤ ë©”ë‰´ 5% í˜œíƒ(ì‹œì—°)", desc:"ì„œë©´ ê¶Œì—­ ì‹ì‚¬ ì¶”ì²œ(ì‹œì—°ìš©). ë¯¸íŒ…/íšŒì‹ ë™ì„ ì— ì í•©." },
      { id:"rest2", name:"Haeundae Seafood Table", cat:"restaurant", coords:[35.1639,129.1630], hours:"12:00-22:00",
        benefit:"íŒ¨ìŠ¤ ìŒë£Œ ì œê³µ(ì‹œì—°)", desc:"í•´ìš´ëŒ€ ê¶Œì—­ ì‹ì‚¬(ì‹œì—°ìš©). ì¼ì • í›„ ë¦¬í”„ë ˆì‹œ ì½”ìŠ¤." },
      { id:"rest3", name:"Nampo Street Food Pick", cat:"restaurant", coords:[35.0978,129.0340], hours:"12:00-21:00",
        benefit:"íŒ¨ìŠ¤ ì†Œì§€ì ì„œë¹„ìŠ¤(ì‹œì—°)", desc:"ë‚¨í¬/ìê°ˆì¹˜ ê¶Œì—­ ê°„í¸ì‹ ì¶”ì²œ(ì‹œì—°ìš©)." },
      { id:"rest4", name:"Gwangan Night Dining", cat:"restaurant", coords:[35.1536,129.1182], hours:"17:00-01:00",
        benefit:"íŒ¨ìŠ¤ ì†Œì§€ì 5% í˜œíƒ(ì‹œì—°)", desc:"ê´‘ì•ˆë¦¬ ì•¼ê°„ ì‹ì‚¬/ëª¨ì„(ì‹œì—°ìš©)." },

      { id:"off2", name:"Busan Co-Office (Centum)", cat:"office", coords:[35.1701,129.1309], hours:"09:00-19:00",
        benefit:"ë°ì´íŒ¨ìŠ¤ 10% í˜œíƒ(ì‹œì—°)", desc:"ì„¼í…€ ê¶Œì—­ ê³µìœ ì˜¤í”¼ìŠ¤(ì‹œì—°ìš©). íšŒì˜ì‹¤/ë¼ìš´ì§€." },
      { id:"off3", name:"Seomyeon Work Hub", cat:"office", coords:[35.1571,129.0599], hours:"09:00-20:00",
        benefit:"ë°ì´íŒ¨ìŠ¤ 10% í˜œíƒ(ì‹œì—°)", desc:"ì„œë©´ ê¶Œì—­ ê³µìœ ì˜¤í”¼ìŠ¤(ì‹œì—°ìš©). ì´ë™ ì¤‘ì‹¬." },
      { id:"off4", name:"Busan Station Work Lounge", cat:"office", coords:[35.1151,129.0412], hours:"09:00-18:00",
        benefit:"ë¼ìš´ì§€ ì´ìš© í˜œíƒ(ì‹œì—°)", desc:"ë¶€ì‚°ì—­ ê¶Œì—­ ë¼ìš´ì§€(ì‹œì—°ìš©). ì´ë™ ì§ì „ ì—…ë¬´." },
    ];

    function closeModal(id){ document.getElementById(id).style.display="none"; }
    function openModal(id){ document.getElementById(id).style.display="flex"; feather.replace(); }

    function fmtRemain(endIso){
      if(!endIso) return "-";
      const end = new Date(endIso).getTime();
      const now = Date.now();
      let diff = Math.max(0,end-now);
      const d = Math.floor(diff/(1000*60*60*24)); diff -= d*(1000*60*60*24);
      const h = Math.floor(diff/(1000*60*60)); diff -= h*(1000*60*60);
      const m = Math.floor(diff/(1000*60));
      return `${d}ì¼ ${h}ì‹œê°„ ${m}ë¶„`;
    }

    function fmtDate(iso){
      if(!iso) return "-";
      const dt = new Date(iso);
      if(isNaN(dt.getTime())) return "-";
      const y = dt.getFullYear();
      const mo = String(dt.getMonth()+1).padStart(2,"0");
      const da = String(dt.getDate()).padStart(2,"0");
      return `${y}.${mo}.${da}`;
    }

    async function api(path,opt={}){
      const res = await fetch(path,{
        ...opt,
        headers:{ "Content-Type":"application/json", ...(opt.headers||{}) }
      });
      let data=null;
      try{ data = await res.json(); }catch{}
      if(!res.ok) throw (data||{error:"HTTP_ERROR"});
      return data;
    }

    /* Onboarding */
    let onbIndex = 0;
    function showOnboarding(){
      document.getElementById("onboarding").style.display="flex";
      onbIndex = 0;
      renderOnb();
    }
    function closeOnboarding(){ document.getElementById("onboarding").style.display="none"; }
    function renderOnb(){
      const slides = document.querySelectorAll(".onb-slide");
      const dots = document.querySelectorAll(".dot2");
      slides.forEach((s,i)=>s.classList.toggle("active", i===onbIndex));
      dots.forEach((d,i)=>d.classList.toggle("active", i===onbIndex));
      feather.replace();
    }
    function switchOnb(dir){
      if(dir === -1) onbIndex = Math.max(0, onbIndex-1);
      else onbIndex = Math.min(2, onbIndex+1);
      renderOnb();
    }
    function finishOnboarding(){
      localStorage.setItem("bpass_onboarding_done","1");
      closeOnboarding();
    }

    /* âœ… Login/Me */
    // [ìš”ì²­ ë°˜ì˜] "ë¡œê·¸ì¸í•˜ì„¸ìš”" â†’ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ ì¦‰ì‹œ ì´ë™
    function checkLogin(){ startKakaoLogin(); }
    function startKakaoLogin(){ window.location.href="/auth/kakao/start"; }

    function handleWalletClick(){
      if(!state.loggedIn){
        startKakaoLogin();
        return;
      }
      // ë¡œê·¸ì¸ ìƒíƒœë©´ MYë¡œ
      switchTab("my");
    }

    async function loadMe(){
      try{
        const me = await api("/api/me");
        state.loggedIn = true;
        state.user = me.user;
        state.pass = me.pass;
        state.tossClientKey = me.tossClientKey;
        state.plan = me.plan;
      }catch(e){
        state.loggedIn = false;
        state.user = null;
        state.pass = null;
        state.tossClientKey = null;
        state.plan = null;
      }
      renderAuthUI();
      renderMy();
      renderQR();
      renderRecommendModal();
    }

    function renderAuthUI(){
      const badge = document.getElementById("guestBadge");
      badge.style.display = state.loggedIn ? "none" : "inline-flex";

      const bal = document.getElementById("balance");
      const wa = document.getElementById("walletActions");
      if(!state.loggedIn){
        bal.innerText = (state.lang==="kr") ? "ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ìœ¼ë¡œ ì´ë™" : "Go to Kakao login";
        wa.style.display = "none";
        return;
      }
      if(state.pass && state.pass.status==="ACTIVE"){
        bal.innerText = `ACTIVE Â· ${fmtRemain(state.pass.end_at)}`;
      } else {
        bal.innerText = (state.lang==="kr") ? "íŒ¨ìŠ¤ ì—†ìŒ Â· êµ¬ë§¤ í›„ QR ì‚¬ìš©" : "No pass Â· Buy to use QR";
      }
      wa.style.display = "flex";
    }

    async function handleLogout(){
      if(!confirm(state.lang==="kr" ? "ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?" : "Sign out?")) return;
      try{ await api("/api/logout",{method:"POST"}); }catch{}
      await loadMe();
      alert(state.lang==="kr" ? "ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤." : "Signed out.");
      switchTab("home");
    }

    /* âœ… PASS ì„ íƒ/ìƒì„¸ */
    function setPassPlan(planId, refresh){
      state.selectedPlanId = planId;
      const p = PLANS[planId] || PLANS.week7;

      // íƒ­ UI
      document.getElementById("pd-tab-3").classList.toggle("active", planId==="day3");
      document.getElementById("pd-tab-7").classList.toggle("active", planId==="week7");

      // í—¤ë”/ì„¤ëª…
      document.getElementById("pdTag").innerText = p.tag;
      document.getElementById("pdTitle").innerText = p.title;
      document.getElementById("pdDesc").innerText =
        (planId==="day3")
          ? (state.lang==="kr" ? "ì§§ì€ ì¼ì •ì— ë”± ë§ëŠ”, ê°€ë³ê³  ë¹ ë¥¸ ì²´ë¥˜ íŒ¨ìŠ¤." : "A compact pass for short business trips.")
          : (state.lang==="kr" ? "ë¹„ì¦ˆë‹ˆìŠ¤ ì¼ì •ì˜ â€œì²´ë¥˜ ë²ˆê±°ë¡œì›€â€ì„ ì¤„ì´ëŠ” ì˜¬ì¸ì› íŒ¨ìŠ¤." : "An all-in-one pass to reduce friction during your stay.");

      document.getElementById("pdOld").innerText = `ì •ê°€ ${p.old}`;
      document.getElementById("pdNew").innerText = `ì–¼ë¦¬ë²„ë“œ ${p.now}`;

      // ê²°ì œì°½ í‘œì‹œë„ ê°™ì´ ê°±ì‹ (ì—´ë ¤ìˆëŠ” ê²½ìš° ëŒ€ë¹„)
      if(refresh) feather.replace();
    }

    function openPassDetail(planId){
      setPassPlan(planId || "week7", true);
      openModal("passDetailModal");
    }

    /* Payment */
    async function openPayment(){
      if(!state.loggedIn){ checkLogin(); return; }
      if(!state.tossClientKey){
        alert("í† ìŠ¤ ê²°ì œ í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤(.envì˜ TOSS_CLIENT_KEY í™•ì¸).");
        return;
      }

      const planId = state.selectedPlanId || "week7";
      const p = PLANS[planId] || PLANS.week7;

      try{
        // ì„œë²„ê°€ planIdë¥¼ ë°›ì„ ìˆ˜ ìˆê²Œ bodyë¡œ ì „ë‹¬(ì„œë²„ê°€ ë¬´ì‹œí•´ë„ UIëŠ” ë™ì‘)
        const order = await api("/api/orders/create",{
          method:"POST",
          body: JSON.stringify({ planId })
        });
        state.pendingOrder = order;

        document.getElementById("payName").innerText = p.title;
        document.getElementById("payPrice").innerHTML = p.payLine;

        openModal("paymentSheet");
        const customerKey = "customer_" + state.user.id;
        state.paymentWidget = PaymentWidget(state.tossClientKey, customerKey);

        document.getElementById("payment-method").innerHTML = "";
        // ì„œë²„ì—ì„œ ë‚´ë ¤ì¤€ amount ìš°ì„  ì‚¬ìš©(ë¶ˆì¼ì¹˜ ë°©ì§€)
        const amount = Number(order.amount || 0) || (planId==="week7" ? 99000 : 59000);
        state.paymentWidget.renderPaymentMethods("#payment-method",{value:amount});
      }catch(e){
        alert(state.lang==="kr" ? "ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨" : "Order create failed");
      }
    }

    async function requestPay(){
      if(!state.paymentWidget || !state.pendingOrder){
        alert(state.lang==="kr" ? "ê²°ì œ ì¤€ë¹„ê°€ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." : "Payment is not ready. Try again.");
        return;
      }
      try{
        await state.paymentWidget.requestPayment({
          orderId: state.pendingOrder.orderId,
          orderName: state.pendingOrder.orderName,
          successUrl: state.pendingOrder.successUrl,
          failUrl: state.pendingOrder.failUrl
        });
      }catch(e){
        alert(state.lang==="kr" ? "ê²°ì œê°€ ì·¨ì†Œë˜ì—ˆê±°ë‚˜ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤." : "Payment canceled or failed.");
      }
    }

    /* QR */
    function openQR(){
      renderQR();
      openModal("qrModal");
    }

    function renderQR(){
      const img = document.getElementById("qrImg");
      const remain = document.getElementById("qrRemain");

      const certName = document.getElementById("certName");
      const certMemberId = document.getElementById("certMemberId");
      const certPlan = document.getElementById("certPlan");
      const certIssuedAt = document.getElementById("certIssuedAt");
      const certExpireAt = document.getElementById("certExpireAt");
      const certChip = document.getElementById("certChip");
      const certStatusText = document.getElementById("certStatusText");

      const issued = fmtDate(new Date().toISOString());

      // ì„ íƒëœ í”Œëœ í‘œê¸°(ê²ŒìŠ¤íŠ¸ì—ë„ ë°˜ì˜)
      const sel = PLANS[state.selectedPlanId] || PLANS.week7;
      certPlan.innerText = sel.title;

      if(!state.loggedIn){
        img.src = "https://api.qrserver.com/v1/create-qr-code/?size=170x170&data=LOGIN_REQUIRED";
        remain.innerText = (state.lang==="kr" ? "ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥" : "Login required");

        certName.innerText = "Guest";
        certMemberId.innerText = "-";
        certIssuedAt.innerText = issued;
        certExpireAt.innerText = "-";
        certChip.classList.remove("active");
        certStatusText.innerText = "INACTIVE";
        return;
      }

      certName.innerText = state.user?.name || "User";
      certMemberId.innerText = `BP-${String(state.user?.id || "").padStart(6,"0")}`;
      certIssuedAt.innerText = issued;

      if(!state.pass || state.pass.status!=="ACTIVE"){
        img.src = "https://api.qrserver.com/v1/create-qr-code/?size=170x170&data=NO_PASS";
        remain.innerText = (state.lang==="kr" ? "íŒ¨ìŠ¤ êµ¬ë§¤ í›„ QR ì‚¬ìš©" : "Buy a pass to use QR");

        certExpireAt.innerText = "-";
        certChip.classList.remove("active");
        certStatusText.innerText = "INACTIVE";
        return;
      }

      const qrText = `BPASS:${state.user.id}:${state.pass.plan_id}:${state.pass.end_at}`;
      img.src = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(qrText)}`;
      remain.innerText = (state.lang==="kr" ? `ë‚¨ì€ ì‹œê°„ ${fmtRemain(state.pass.end_at)}` : `Remaining ${fmtRemain(state.pass.end_at)}`);

      certExpireAt.innerText = fmtDate(state.pass.end_at);
      certChip.classList.add("active");
      certStatusText.innerText = "ACTIVE";
    }

    /* Tabs */
    function switchTab(tab){
      document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));
      document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));

      // nav-item ìˆœì„œ: home(0), map(1), star(2), my(3), support(4)
      if(tab==="home"){
        document.getElementById("view-home").classList.add("active");
        document.querySelectorAll(".nav-item")[0].classList.add("active");
      } else if(tab==="map"){
        document.getElementById("view-map").classList.add("active");
        document.querySelectorAll(".nav-item")[1].classList.add("active");
        initMap();
      } else if(tab==="my"){
        document.getElementById("view-my").classList.add("active");
        document.querySelectorAll(".nav-item")[3].classList.add("active");
        setTimeout(()=>renderMy(),0);
      } else if(tab==="support"){
        document.getElementById("view-support").classList.add("active");
        document.querySelectorAll(".nav-item")[4].classList.add("active");
      }

      feather.replace();
    }

    function openMyPass(){
      switchTab("my");
      switchMyTab("pass");
    }
    function openSupport(){ switchTab("support"); }

    function switchMyTab(t){
      state.myTab = t;
      document.getElementById("tab-pass").classList.toggle("active", t==="pass");
      document.getElementById("tab-voucher").classList.toggle("active", t==="voucher");
      document.getElementById("tab-history").classList.toggle("active", t==="history");

      document.getElementById("my-pass").style.display = (t==="pass") ? "block" : "none";
      document.getElementById("my-voucher").style.display = (t==="voucher") ? "block" : "none";
      document.getElementById("my-history").style.display = (t==="history") ? "block" : "none";
      feather.replace();
    }

    /* MY render */
    function renderMy(){
      const nameEl = document.getElementById("profileName");
      const imgEl = document.getElementById("profileImg");
      const textEl = document.getElementById("myPassText");

      // MYì— í‘œì‹œí•  í”Œëœ íƒ€ì´í‹€ë„ ì„ íƒê°’ì„ ë°˜ì˜(ì‹œì—°ìš©)
      const sel = PLANS[state.selectedPlanId] || PLANS.week7;
      document.getElementById("myPlanTitle").innerText = sel.title;

      if(!state.loggedIn){
        nameEl.innerText = "Guest";
        imgEl.src = "";
        textEl.innerText = (state.lang==="kr") ? "ë¡œê·¸ì¸í•˜ë©´ ë‚´ íŒ¨ìŠ¤/QRì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”." : "Login to view your pass/QR.";
        document.getElementById("passStatus").innerHTML = `<span class="dot inactive"></span><span>INACTIVE</span>`;
        document.getElementById("remainText").innerText = "-";
        document.getElementById("partnerCount").innerText = partners.length + (state.lang==="kr" ? "ê³³(ì‹œì—°)" : " partners (demo)");
        renderVoucherDemo(false);
        renderHistoryDemo(false);
        return;
      }

      nameEl.innerText = state.user?.name || "User";
      imgEl.src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(state.user?.name || "BPASS")}`;

      if(state.pass && state.pass.status==="ACTIVE"){
        textEl.innerText = (state.lang==="kr")
          ? `íŒ¨ìŠ¤ ACTIVE Â· ë‚¨ì€ ì‹œê°„ ${fmtRemain(state.pass.end_at)}`
          : `PASS ACTIVE Â· Remaining ${fmtRemain(state.pass.end_at)}`;
        document.getElementById("passStatus").innerHTML = `<span class="dot active"></span><span>ACTIVE</span>`;
        document.getElementById("remainText").innerText = fmtRemain(state.pass.end_at);
      } else {
        textEl.innerText = (state.lang==="kr") ? "íŒ¨ìŠ¤ ì—†ìŒ Â· êµ¬ë§¤ í›„ QR ì‚¬ìš©" : "No pass Â· Buy to use QR";
        document.getElementById("passStatus").innerHTML = `<span class="dot inactive"></span><span>INACTIVE</span>`;
        document.getElementById("remainText").innerText = "-";
      }
      document.getElementById("partnerCount").innerText = partners.length + (state.lang==="kr" ? "ê³³(ì‹œì—°)" : " partners (demo)");

      renderVoucherDemo(true);
      renderHistoryDemo(true);
    }

    function renderVoucherDemo(logged){
      const list = document.getElementById("voucherList");
      list.innerHTML = "";

      // âœ… íƒì‹œ ë°”ìš°ì²˜ ì œê±°
      const items = logged ? [
        { title:(state.lang==="kr"?"ì¹´í˜ 10% í• ì¸":"Cafe 10% off"), code:"VCH-COFFEE-1031", used:false, type:"normal" },
        { title:(state.lang==="kr"?"ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë°ì´íŒ¨ìŠ¤ í˜œíƒ":"Workspace day-pass benefit"), code:"VCH-OFFICE-2011", used:false, type:"normal" }
      ] : [
        { title:(state.lang==="kr"?"(ë¡œê·¸ì¸ í›„ í™•ì¸)":"(Login to view)"), code:"-", used:false, type:"normal" }
      ];

      items.forEach(x=>{
        const row = document.createElement("div");
        row.className="list-row";
                row.innerHTML = `
          <div style="display:flex;flex-direction:column;gap:4px;">
            <div style="font-weight:980;letter-spacing:-.2px;">${x.title}</div>
            <div class="muted" style="font-size:12px;">${state.lang==="kr" ? "ì½”ë“œ" : "Code"} Â· <b style="color:var(--text)">${x.code}</b></div>
          </div>
          <div style="font-size:12px;font-weight:980;color:${x.used ? '#6B7280' : '#10B981'};">
            ${x.used ? (state.lang==="kr" ? "ì‚¬ìš©ì™„ë£Œ" : "Used") : (state.lang==="kr" ? "ì‚¬ìš©ê°€ëŠ¥" : "Available")}
          </div>
        `;
        row.onclick = ()=>{
          alert(state.lang==="kr"
            ? `ë°”ìš°ì²˜: ${x.title}\nì½”ë“œ: ${x.code}\nìƒíƒœ: ${x.used ? "ì‚¬ìš©ì™„ë£Œ" : "ì‚¬ìš©ê°€ëŠ¥"}\n\n(ì‹œì—°ìš©)`
            : `Voucher: ${x.title}\nCode: ${x.code}\nStatus: ${x.used ? "Used" : "Available"}\n\n(Demo)`
          );
        };
        list.appendChild(row);
      });
    }

    function renderHistoryDemo(logged){
      const list = document.getElementById("historyList");
      list.innerHTML = "";

      const items = logged ? [
        { at:"2026-01-12 09:24", place:(state.lang==="kr"?"Centum Coffee Lounge":"Centum Coffee Lounge"), benefit:(state.lang==="kr"?"10% í• ì¸ ì ìš©":"10% discount applied"), amount:"-5,000ì›(ì‹œì—°)" },
        { at:"2026-01-12 14:10", place:(state.lang==="kr"?"Busan Co-Office (Centum)":"Busan Co-Office (Centum)"), benefit:(state.lang==="kr"?"ë°ì´íŒ¨ìŠ¤ í˜œíƒ":"Day-pass benefit"), amount:"-10,000ì›(ì‹œì—°)" }
      ] : [
        { at:"-", place:(state.lang==="kr"?"(ë¡œê·¸ì¸ í›„ í™•ì¸)":"(Login to view)"), benefit:"-", amount:"-" }
      ];

      items.forEach(x=>{
        const row = document.createElement("div");
        row.className="list-row";
        row.innerHTML = `
          <div style="display:flex;flex-direction:column;gap:6px;">
            <div style="font-weight:980;letter-spacing:-.2px;">${x.place}</div>
            <div class="muted" style="font-size:12px;line-height:1.25;">
              ${x.at} Â· ${x.benefit}
            </div>
          </div>
          <div style="font-size:12px;font-weight:980;color:var(--sub);">${x.amount}</div>
        `;
        row.onclick = ()=>alert(state.lang==="kr"
          ? `ì´ìš©ì²˜: ${x.place}\nì‹œê°„: ${x.at}\ní˜œíƒ: ${x.benefit}\nê¸ˆì•¡: ${x.amount}\n\n(ì‹œì—°ìš©)`
          : `Place: ${x.place}\nTime: ${x.at}\nBenefit: ${x.benefit}\nAmount: ${x.amount}\n\n(Demo)`
        );
        list.appendChild(row);
      });
    }

    /* FAQ toggle */
    function toggleFaq(card){
      const ans = card.querySelector(".muted");
      const icon = card.querySelector("svg, i");
      const open = ans.style.display === "block";
      ans.style.display = open ? "none" : "block";
      feather.replace();
    }

    /* ===== MAP ===== */
    function initMap(){
      if(map) { setTimeout(()=>map.invalidateSize(), 0); return; }

      map = L.map("map", { zoomControl:false }).setView([35.1595,129.0604], 12);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{
        attribution:"&copy; OpenStreetMap"
      }).addTo(map);

      renderMapFilters();
      renderMarkers();
      setTimeout(()=>map.invalidateSize(), 50);
    }

    function getCatLabel(id){
      const found = CATS.find(x=>x.id===id);
      if(!found) return id;
      // i18n ì ìš©: labelì€ i18nì—ì„œ ë”°ë¡œ ê´€ë¦¬í•  ìˆ˜ë„ ìˆì§€ë§Œ, ì§€ê¸ˆì€ KR label ê·¸ëŒ€ë¡œ + ì˜ë¬¸ì€ ê°„ë‹¨ ë³€í™˜
      if(state.lang==="kr") return found.label;
      const enMap = {
        "ì „ì²´":"All",
        "ì›Œí¬ìŠ¤í˜ì´ìŠ¤":"Workspace",
        "ì¹´í˜":"Cafe",
        "ìŒì‹ì ":"Restaurant",
        "í—¬ìŠ¤":"Gym",
        "êµí†µ":"Transport",
        "ìˆ™ì†Œ(ì¶”ì²œ)":"Stay",
        "ì•½êµ­":"Pharmacy",
        "ë³‘ì›":"Hospital",
        "í™˜ì „":"Exchange"
      };
      return enMap[found.label] || found.label;
    }

    function renderMapFilters(){
      const wrap = document.getElementById("mapFilters");
      wrap.innerHTML = "";
      CATS.forEach(c=>{
        const btn = document.createElement("div");
        btn.className = "chip" + (currentFilter===c.id ? " active" : "");
        btn.innerText = getCatLabel(c.id);
        btn.onclick = ()=> {
          currentFilter = c.id;
          wrap.querySelectorAll(".chip").forEach(x=>x.classList.remove("active"));
          btn.classList.add("active");
          renderMarkers();
        };
        wrap.appendChild(btn);
      });
    }

    function clearMarkers(){
      markers.forEach(m=>map.removeLayer(m));
      markers = [];
    }

    function renderMarkers(){
      if(!map) return;
      clearMarkers();

      const visible = partners.filter(p=> currentFilter==="all" ? true : p.cat===currentFilter);

      visible.forEach(p=>{
        const m = L.marker(p.coords).addTo(map);
        m.on("click", ()=> openPlaceSheet(p));
        markers.push(m);
      });
    }

    function filterMapAndGo(cat){
      currentFilter = cat || "all";
      switchTab("map");
      setTimeout(()=>{
        renderMapFilters();
        renderMarkers();
      }, 0);
    }

    /* Map search UI */
    function toggleMapSearch(open){
      const bar = document.getElementById("mapSearchBar");
      const viewMap = document.getElementById("view-map");
      if(open){
        bar.classList.add("open");
        viewMap.classList.add("map-search-open");
        setTimeout(()=>document.getElementById("mapSearchInput").focus(), 0);
      }else{
        bar.classList.remove("open");
        viewMap.classList.remove("map-search-open");
        document.getElementById("mapSearchInput").value = "";
      }
    }

    function runMapSearch(){
      const q = (document.getElementById("mapSearchInput").value||"").trim().toLowerCase();
      if(!q){
        alert(state.lang==="kr" ? "ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”." : "Enter a keyword.");
        return;
      }
      const hit = partners.find(p=> p.name.toLowerCase().includes(q));
      if(!hit){
        alert(state.lang==="kr" ? "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤." : "No results.");
        return;
      }
      currentFilter = "all";
      renderMapFilters();
      renderMarkers();
      map.setView(hit.coords, 15);
      openPlaceSheet(hit);
    }

    /* Near me */
    function goNearMe(){
      if(!navigator.geolocation){
        alert(state.lang==="kr" ? "í˜„ì¬ ë¸Œë¼ìš°ì €ì—ì„œ ìœ„ì¹˜ë¥¼ ì§€ì›í•˜ì§€ ì•Šì•„ìš”." : "Geolocation not supported.");
        return;
      }
      navigator.geolocation.getCurrentPosition((pos)=>{
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;

        if(!map) initMap();

        if(myMarker) map.removeLayer(myMarker);
        myMarker = L.circleMarker([lat,lng],{
          radius:8,
          weight:2,
          opacity:1,
          fillOpacity:.35
        }).addTo(map);

        map.setView([lat,lng], 15);

      }, ()=>{
        alert(state.lang==="kr" ? "ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”." : "Please allow location access.");
      }, { enableHighAccuracy:true, timeout:8000 });
    }

    /* ===== Place bottom sheet ===== */
    function openPlaceSheet(p){
      lastOpenedPartner = p;
      currentPartnerIdForDirections = p.id;

      document.getElementById("psName").innerText = p.name;
      document.getElementById("psMeta").innerText =
        `${getCatLabel(p.cat)} Â· ${p.hours || "-"} Â· ${state.lang==="kr" ? "ê±°ë¦¬ ê³„ì‚°(ì‹œì—°)" : "Distance (demo)"}`;

      const b = document.getElementById("psBenefit");
      b.innerHTML = `<i data-feather="percent" style="width:14px;"></i> ${p.benefit || (state.lang==="kr"?"í˜œíƒ":"Benefit")}`;

      document.getElementById("psDesc").innerText = p.desc || "";

      // ì‹œíŠ¸ ë²„íŠ¼ ë¬¸êµ¬ i18n
      const sheetActions = document.getElementById("sheetActions");
      sheetActions.innerHTML = `
        <div class="pill primary" onclick="openQR()"><i data-feather="maximize" style="width:16px;"></i> ${state.lang==="kr"?"QR ì œì‹œ":"Show QR"}</div>
        <div class="pill ghost" onclick="openDirections()"><i data-feather="navigation" style="width:16px;"></i> ${state.lang==="kr"?"ê¸¸ì°¾ê¸°":"Directions"}</div>
        <div class="pill ghost" onclick="alert('${state.lang==="kr"?"í˜œíƒ/ì´ìš©ì¡°ê±´ì€ ì‹œì—°ìš© ë¬¸êµ¬ì…ë‹ˆë‹¤.":"Benefit/conditions are demo text."}')"><i data-feather="info" style="width:16px;"></i> ${state.lang==="kr"?"ì´ìš©ì¡°ê±´":"Conditions"}</div>
      `;

      document.getElementById("placeSheet").style.display="flex";
      feather.replace();
    }

    function hidePlaceSheet(){
      document.getElementById("placeSheet").style.display="none";
      currentPartnerIdForDirections = null;
    }

    function closePlaceSheet(e){
      if(e.target.id === "placeSheet") hidePlaceSheet();
    }

    function openDirections(){
      if(!currentPartnerIdForDirections){
        alert(state.lang==="kr" ? "ì¥ì†Œë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”." : "Select a place first.");
        return;
      }
      const p = partners.find(x=>x.id===currentPartnerIdForDirections);
      if(!p){ alert("Not found"); return; }

      // êµ¬ê¸€ë§µ ê¸¸ì°¾ê¸°(ì›¹)
      const [lat,lng] = p.coords;
      const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
      window.open(url, "_blank");
    }

    /* ===== Legal ===== */
    function openLegal(type){
      const t = {
        terms:  state.lang==="kr" ? "ì´ìš©ì•½ê´€" : "Terms of Service",
        privacy:state.lang==="kr" ? "ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨" : "Privacy Policy",
        refund: state.lang==="kr" ? "í™˜ë¶ˆ/ì·¨ì†Œ ì •ì±…" : "Refund/Cancellation Policy"
      }[type] || (state.lang==="kr" ? "ì•½ê´€" : "Legal");

      document.getElementById("legalTitle").innerText = t;

      const bodyKR = {
        terms:
`[ì´ìš©ì•½ê´€(ì‹œì—°ìš©)]
- ë³¸ í™”ë©´ì€ í”„ë¡œí† íƒ€ì… ì‹œì—° ëª©ì ì…ë‹ˆë‹¤.
- íŒ¨ìŠ¤ êµ¬ë§¤/ì‚¬ìš©, ì œíœ´ì²˜ í˜œíƒì€ ì‹¤ì œ ìš´ì˜ ì‹œ ê³„ì•½/ì •ì±…ì— ë”°ë¼ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì„œë¹„ìŠ¤ëŠ” ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ê¸°ë°˜ìœ¼ë¡œ ì´ìš©ì ì‹ë³„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.`,
        privacy:
`[ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨(ì‹œì—°ìš©)]
- ìˆ˜ì§‘ í•­ëª©: ì¹´ì¹´ì˜¤ í”„ë¡œí•„ ì •ë³´(ì´ë¦„/ì‹ë³„ì), ê²°ì œ ê´€ë ¨ ì‹ë³„ì •ë³´(ì£¼ë¬¸ID)
- ì´ìš© ëª©ì : ë¡œê·¸ì¸/êµ¬ë§¤/íŒ¨ìŠ¤ í™œì„±í™”, ì´ìš©ë‚´ì—­ ì œê³µ
- ë³´ê´€: ì‹œì—° í™˜ê²½ì—ì„œëŠ” ìµœì†Œ ë³´ê´€ì„ ì „ì œë¡œ í•©ë‹ˆë‹¤.`,
        refund:
`[í™˜ë¶ˆ/ì·¨ì†Œ ì •ì±…(ì‹œì—°ìš©)]
- ê²°ì œ í›„ â€˜ë¯¸ì‚¬ìš©â€™ ìƒíƒœì—ì„œëŠ” ì·¨ì†Œ/í™˜ë¶ˆì´ ê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- â€˜ì‚¬ìš© ì‹œì‘(ACTIVE)â€™ ì´í›„ì—ëŠ” ì”ì—¬ ê¸°ê°„/ì‚¬ìš© ë‚´ì—­ì— ë”°ë¼ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ìƒì„¸ ê·œì •ì€ ì‹¤ì œ ìš´ì˜ ì •ì±…ì—ì„œ ê³ ì§€ë©ë‹ˆë‹¤.`
      };

      const bodyEN = {
        terms:
`[Terms (Demo)]
- This is a prototype UI for demo purposes.
- Pass benefits/partners may change based on real operations.
- Login uses Kakao authentication.`,
        privacy:
`[Privacy (Demo)]
- Collected: Kakao profile (name/id), order identifier
- Purpose: login, purchase, activation, usage history
- Retention: minimal in demo environment.`,
        refund:
`[Refund/Cancellation (Demo)]
- Refund may be available before usage.
- After activation, refund may be limited depending on usage/remaining time.
- Final policy will be announced in real operations.`
      };

      const body = (state.lang==="kr" ? bodyKR : bodyEN)[type] || "";
      document.getElementById("legalBody").innerText = body;

      openModal("legalModal");
    }

    /* ===== Recommend modal (â­) ===== */
    function openRecommendModal(){
      renderRecommendModal();
      openModal("recommendModal");
    }

    function setRecommendCat(cat, rerender){
      state.recommendCat = cat;
      document.getElementById("rm-stay").classList.toggle("active", cat==="stay");
      document.getElementById("rm-cafe").classList.toggle("active", cat==="food");
      document.getElementById("rm-restaurant").classList.toggle("active", cat==="restaurant");
      document.getElementById("rm-office").classList.toggle("active", cat==="office");

      if(rerender) renderRecommendModal();
      feather.replace();
    }

    function renderRecommendModal(){
      const titleEl = document.getElementById("recModalTitle");
      const descEl  = document.getElementById("recModalDesc");
      const listEl  = document.getElementById("recModalList");

      if(!titleEl || !listEl) return;

      const cat = state.recommendCat || "stay";

      const titleMap = {
        stay: state.lang==="kr" ? "ìˆ™ì†Œ ì¶”ì²œ" : "Stay Recommendations",
        food: state.lang==="kr" ? "ì¹´í˜ ì¶”ì²œ" : "Cafe Recommendations",
        restaurant: state.lang==="kr" ? "ìŒì‹ì  ì¶”ì²œ" : "Restaurant Recommendations",
        office: state.lang==="kr" ? "ê³µìœ  ì˜¤í”¼ìŠ¤ ì¶”ì²œ" : "Workspace Recommendations"
      };

      titleEl.innerText = titleMap[cat] || (state.lang==="kr" ? "ì¶”ì²œ" : "Recommendations");
      descEl.innerText = state.lang==="kr"
        ? "ì¹´í…Œê³ ë¦¬ë³„ ì¶”ì²œ í•­ëª©ì„ ì„ íƒí•´ í™•ì¸í•˜ì„¸ìš”. (ì‹œì—°ìš©)"
        : "Pick a category to view recommended items. (Demo)";

      const items = partners.filter(p=>p.cat===cat).slice(0,6);

      listEl.innerHTML = "";
      items.forEach(p=>{
        const div = document.createElement("div");
        div.className = "rec-item";
        div.innerHTML = `
          <div class="rec-title">${p.name}</div>
          <div class="rec-meta">${getCatLabel(p.cat)} Â· ${p.hours || "-"}<br>${p.benefit || ""}</div>
          <div class="rec-actions">
            <div class="pill ghost" onclick="switchTab('map'); setTimeout(()=>{ map && map.setView([${p.coords[0]},${p.coords[1]}],15); openPlaceSheet(partners.find(x=>x.id==='${p.id}')); }, 250); closeModal('recommendModal');">
              <i data-feather="map-pin" style="width:14px;"></i> ${state.lang==="kr"?"ì§€ë„ì—ì„œ ë³´ê¸°":"View on map"}
            </div>
            <div class="pill ghost" onclick="alert('${state.lang==="kr"?"ì¶”ì²œì€ ì‹œì—°ìš© ì •ë³´ì…ë‹ˆë‹¤.":"Recommendations are demo info."}')">
              <i data-feather="info" style="width:14px;"></i> ${state.lang==="kr"?"ì•ˆë‚´":"Info"}
            </div>
          </div>
        `;
        listEl.appendChild(div);
      });

      feather.replace();
    }

    // =========================
// i18n (KR/EN/CN/JP) + fallback(kr)
// =========================
const I18N = {
  kr: {
    hero_title: "Business ì²´ë¥˜ë¥¼ â€œíŒ¨ìŠ¤ í•˜ë‚˜ë¡œâ€",
    hero_desc: "êµí†µ Â· ì›Œí¬ìŠ¤í˜ì´ìŠ¤ Â· í—¬ìŠ¤ Â· ì¹´í˜ í• ì¸ Â· ê¸´ê¸‰ì§€ì›ê¹Œì§€<br><b style='color:var(--text);'>ì—…ë¬´Â·ì´ë™Â·íœ´ì‹ì„ í•œ ë²ˆì— ì—°ê²°í•˜ëŠ” ì²´ë¥˜ íŒ¨ìŠ¤</b>",
    btn_detail: "ìƒì„¸",
    step1_t: "ë¡œê·¸ì¸",
    step1_d: "ì¹´ì¹´ì˜¤ë¡œ 3ì´ˆ ì‹œì‘",
    step2_t: "êµ¬ë§¤",
    step2_d: "íŒ¨ìŠ¤ ê²°ì œ í›„ í™œì„±í™”",
    step3_t: "ì´ìš©",
    step3_d: "QR ì œì‹œ í›„ í˜œíƒ ì ìš©",
    wallet_label: "ë‚´ íŒ¨ìŠ¤ ìƒíƒœ",
    wallet_my: "ë‚´ íŒ¨ìŠ¤",
    wallet_map: "ì œíœ´ì²˜ ì°¾ê¸°",
    wallet_help: "ê³ ê°ì„¼í„°",
    menu_transport: "êµí†µ",
    menu_office: "ì›Œí¬ìŠ¤í˜ì´ìŠ¤",
    menu_gym: "í—¬ìŠ¤",
    menu_cafe: "ì¹´í˜",
    included_title: "í¬í•¨ ì„œë¹„ìŠ¤",
    included_desc: "ì²´ë¥˜ ì¤‘ í•„ìš”í•œ í•µì‹¬ ì„œë¹„ìŠ¤ë¥¼ í•œ ë²ˆì—",
    btn_pay_safe: "ê²°ì œì•ˆì‹¬",
    btn_refund: "í™˜ë¶ˆê·œì •",
    btn_buy: "êµ¬ë§¤í•˜ê¸°",
    btn_pay: "êµ¬ë§¤/ê²°ì œ",
    map_search: "ê²€ìƒ‰",
    map_close: "ë‹«ê¸°",
    map_near: "ë‚´ ì£¼ë³€",
    map_placeholder: "ì œíœ´ì²˜/ì¥ì†Œ ê²€ìƒ‰",
    my_guest: "ë¡œê·¸ì¸í•˜ë©´ ë‚´ íŒ¨ìŠ¤/QRì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.",
    kakao_start: "ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°",
    my_tab_pass: "ë‚´ íŒ¨ìŠ¤",
    my_tab_voucher: "ë°”ìš°ì²˜",
    my_tab_history: "ì´ìš©ë‚´ì—­",
    my_pass_desc: "QR ì œì‹œ í›„ ì œíœ´ì²˜ì—ì„œ í˜œíƒì´ ì ìš©ë¼ìš”.",
    my_remain_k: "ë‚¨ì€ ì‹œê°„",
    my_partner_k: "ì‚¬ìš© ê°€ëŠ¥ ì œíœ´ì²˜",
    my_qr: "QR ë³´ê¸°",
    my_find: "ì œíœ´ì²˜ ì°¾ê¸°",
    support_title: "ê³ ê°ì„¼í„°/ë¬¸ì˜",
    support_desc: "ìš´ì˜ ì „ ì‹œì—°ìš© í™”ë©´ì…ë‹ˆë‹¤. ì‹¤ì œ ì„œë¹„ìŠ¤ ìš´ì˜ ì‹œ ë¬¸ì˜ ì±„ë„ê³¼ ì •ì±…ì„ í•¨ê»˜ ì œê³µí•©ë‹ˆë‹¤.",
    faq_title: "FAQ",
    faq_sub: "ìì£¼ ë¬»ëŠ” ì§ˆë¬¸",
    pay_desc: "ì•„ë˜ ê²°ì œìˆ˜ë‹¨ ì„ íƒ í›„ ê²°ì œí•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.",
    pay_now: "ê²°ì œí•˜ê¸°",
    close: "ë‹«ê¸°",
    lang_title: "ì–¸ì–´ ì„ íƒ",
    lang_desc: "ì–´ë–¤ ì–¸ì–´ë¡œ ë³¼ê¹Œìš”?",
    earlybird: "ì–¼ë¦¬ë²„ë“œ"
  },

  en: {
    hero_title: "Business stay â€” one pass",
    hero_desc: "Transit Â· Workspace Â· Gym Â· Cafe discounts Â· Emergency support<br><b style='color:var(--text);'>One pass connecting work, movement, and rest</b>",
    btn_detail: "Details",
    step1_t: "Login",
    step1_d: "Start with Kakao in 3 sec",
    step2_t: "Purchase",
    step2_d: "Activate after payment",
    step3_t: "Use",
    step3_d: "Show QR for benefits",
    wallet_label: "My pass status",
    wallet_my: "My pass",
    wallet_map: "Find partners",
    wallet_help: "Support",
    menu_transport: "Transit",
    menu_office: "Workspace",
    menu_gym: "Gym",
    menu_cafe: "Cafe",
    included_title: "Included",
    included_desc: "Essential services in one pass",
    btn_pay_safe: "Payment safety",
    btn_refund: "Refund policy",
    btn_buy: "Buy",
    btn_pay: "Pay",
    map_search: "Search",
    map_close: "Close",
    map_near: "Near me",
    map_placeholder: "Search partners/places",
    my_guest: "Login to view your pass/QR.",
    kakao_start: "Start with Kakao",
    my_tab_pass: "Pass",
    my_tab_voucher: "Vouchers",
    my_tab_history: "History",
    my_pass_desc: "Show QR at partner locations to apply benefits.",
    my_remain_k: "Remaining",
    my_partner_k: "Partners",
    my_qr: "Show QR",
    my_find: "Find partners",
    support_title: "Support / Contact",
    support_desc: "Demo screen before launch. Real channels/policies will be provided.",
    faq_title: "FAQ",
    faq_sub: "Frequently asked",
    pay_desc: "Select a method and press Pay.",
    pay_now: "Pay now",
    close: "Close",
    lang_title: "Language",
    lang_desc: "Choose a language",
    earlybird: "EARLY BIRD"
  },

  cn: {
    hero_title: "å•†åŠ¡åœç•™ï¼Œä¸€å¼ é€šè¡Œè¯æå®š",
    hero_desc: "äº¤é€š Â· åŠå…¬ç©ºé—´ Â· å¥èº« Â· å’–å•¡æŠ˜æ‰£ Â· ç´§æ€¥æ”¯æ´<br><b style='color:var(--text);'>å·¥ä½œã€å‡ºè¡Œã€ä¼‘æ¯ä¸€ä½“åŒ–</b>",
    btn_detail: "è¯¦æƒ…",
    step1_t: "ç™»å½•",
    step1_d: "Kakao 3ç§’å¼€å§‹",
    step2_t: "è´­ä¹°",
    step2_d: "æ”¯ä»˜åæ¿€æ´»",
    step3_t: "ä½¿ç”¨",
    step3_d: "å‡ºç¤ºäºŒç»´ç äº«å—æƒç›Š",
    wallet_label: "é€šè¡Œè¯çŠ¶æ€",
    wallet_my: "æˆ‘çš„é€šè¡Œè¯",
    wallet_map: "æŸ¥æ‰¾åˆä½œç‚¹",
    wallet_help: "å®¢æœ",
    menu_transport: "äº¤é€š",
    menu_office: "åŠå…¬ç©ºé—´",
    menu_gym: "å¥èº«",
    menu_cafe: "å’–å•¡",
    included_title: "åŒ…å«æœåŠ¡",
    included_desc: "åœç•™æ‰€éœ€æœåŠ¡ä¸€ç«™å¼",
    btn_pay_safe: "æ”¯ä»˜ä¿éšœ",
    btn_refund: "é€€æ¬¾è§„åˆ™",
    btn_buy: "è´­ä¹°",
    btn_pay: "è´­ä¹°/æ”¯ä»˜",
    map_search: "æœç´¢",
    map_close: "å…³é—­",
    map_near: "é™„è¿‘",
    map_placeholder: "æœç´¢åˆä½œç‚¹/åœ°ç‚¹",
    my_guest: "ç™»å½•åå¯æŸ¥çœ‹é€šè¡Œè¯/äºŒç»´ç ã€‚",
    kakao_start: "ä½¿ç”¨ Kakao å¼€å§‹",
    my_tab_pass: "é€šè¡Œè¯",
    my_tab_voucher: "åˆ¸/å‡­è¯",
    my_tab_history: "ä½¿ç”¨è®°å½•",
    my_pass_desc: "åœ¨åˆä½œç‚¹å‡ºç¤ºäºŒç»´ç å³å¯äº«å—æƒç›Šã€‚",
    my_remain_k: "å‰©ä½™æ—¶é—´",
    my_partner_k: "å¯ç”¨åˆä½œç‚¹",
    my_qr: "æŸ¥çœ‹äºŒç»´ç ",
    my_find: "æŸ¥æ‰¾åˆä½œç‚¹",
    support_title: "å®¢æœ/å’¨è¯¢",
    support_desc: "æ¼”ç¤ºé¡µé¢ï¼Œæ­£å¼è¿è¥åå°†æä¾›çœŸå®æ¸ é“ä¸æ”¿ç­–ã€‚",
    faq_title: "å¸¸è§é—®é¢˜",
    faq_sub: "FAQ",
    pay_desc: "é€‰æ‹©æ”¯ä»˜æ–¹å¼åç‚¹å‡»æ”¯ä»˜ã€‚",
    pay_now: "ç«‹å³æ”¯ä»˜",
    close: "å…³é—­",
    lang_title: "é€‰æ‹©è¯­è¨€",
    lang_desc: "è¯·é€‰æ‹©æ˜¾ç¤ºè¯­è¨€",
    earlybird: "æ—©é¸Ÿ"
  },

  jp: {
    hero_title: "ãƒ“ã‚¸ãƒã‚¹æ»åœ¨ã‚’â€œãƒ‘ã‚¹1æšã§â€",
    hero_desc: "äº¤é€š Â· ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ Â· ã‚¸ãƒ  Â· ã‚«ãƒ•ã‚§å‰²å¼• Â· ç·Šæ€¥ã‚µãƒãƒ¼ãƒˆ<br><b style='color:var(--text);'>ä»•äº‹ãƒ»ç§»å‹•ãƒ»ä¼‘æ¯ã‚’ä¸€æ‹¬ã§ã¤ãªãæ»åœ¨ãƒ‘ã‚¹</b>",
    btn_detail: "è©³ç´°",
    step1_t: "ãƒ­ã‚°ã‚¤ãƒ³",
    step1_d: "Kakaoã§3ç§’ã‚¹ã‚¿ãƒ¼ãƒˆ",
    step2_t: "è³¼å…¥",
    step2_d: "æ±ºæ¸ˆå¾Œã«æœ‰åŠ¹åŒ–",
    step3_t: "åˆ©ç”¨",
    step3_d: "QRæç¤ºã§ç‰¹å…¸é©ç”¨",
    wallet_label: "ãƒ‘ã‚¹çŠ¶æ…‹",
    wallet_my: "ãƒã‚¤ãƒ‘ã‚¹",
    wallet_map: "ææºå…ˆæ¤œç´¢",
    wallet_help: "ã‚µãƒãƒ¼ãƒˆ",
    menu_transport: "äº¤é€š",
    menu_office: "ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹",
    menu_gym: "ã‚¸ãƒ ",
    menu_cafe: "ã‚«ãƒ•ã‚§",
    included_title: "å«ã¾ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹",
    included_desc: "æ»åœ¨ã«å¿…è¦ãªè¦ç´ ã‚’ã²ã¨ã¤ã«",
    btn_pay_safe: "æ±ºæ¸ˆå®‰å¿ƒ",
    btn_refund: "è¿”é‡‘è¦å®š",
    btn_buy: "è³¼å…¥",
    btn_pay: "è³¼å…¥/æ±ºæ¸ˆ",
    map_search: "æ¤œç´¢",
    map_close: "é–‰ã˜ã‚‹",
    map_near: "è¿‘ã",
    map_placeholder: "ææºå…ˆ/å ´æ‰€ã‚’æ¤œç´¢",
    my_guest: "ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ãƒ‘ã‚¹/QRã‚’ç¢ºèªã§ãã¾ã™ã€‚",
    kakao_start: "Kakaoã§å§‹ã‚ã‚‹",
    my_tab_pass: "ãƒ‘ã‚¹",
    my_tab_voucher: "ãƒã‚¦ãƒãƒ£ãƒ¼",
    my_tab_history: "åˆ©ç”¨å±¥æ­´",
    my_pass_desc: "ææºå…ˆã§QRã‚’æç¤ºã™ã‚‹ã¨ç‰¹å…¸ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚",
    my_remain_k: "æ®‹ã‚Šæ™‚é–“",
    my_partner_k: "åˆ©ç”¨å¯èƒ½ææºå…ˆ",
    my_qr: "QRã‚’è¦‹ã‚‹",
    my_find: "ææºå…ˆã‚’æ¢ã™",
    support_title: "ã‚µãƒãƒ¼ãƒˆ/ãŠå•ã„åˆã‚ã›",
    support_desc: "ãƒ‡ãƒ¢ç”»é¢ã§ã™ã€‚æ­£å¼é‹ç”¨æ™‚ã«å®Ÿéš›ã®çª“å£/è¦ç´„ã‚’æä¾›ã—ã¾ã™ã€‚",
    faq_title: "FAQ",
    faq_sub: "ã‚ˆãã‚ã‚‹è³ªå•",
    pay_desc: "æ”¯æ‰•ã„æ–¹æ³•ã‚’é¸æŠã—ã¦æ±ºæ¸ˆã—ã¦ãã ã•ã„ã€‚",
    pay_now: "æ±ºæ¸ˆã™ã‚‹",
    close: "é–‰ã˜ã‚‹",
    lang_title: "è¨€èªé¸æŠ",
    lang_desc: "è¡¨ç¤ºè¨€èªã‚’é¸ã‚“ã§ãã ã•ã„",
    earlybird: "æ—©å‰²"
  }
};

function t(key){
  const langPack = I18N[state.lang] || I18N.kr;
  return (langPack[key] ?? I18N.kr[key] ?? key);
}

function applyI18n(){
  // text
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    const key = el.getAttribute("data-i18n");
    el.innerHTML = t(key);
  });

  // placeholder
  document.querySelectorAll("[data-i18n-placeholder]").forEach(el=>{
    const key = el.getAttribute("data-i18n-placeholder");
    el.setAttribute("placeholder", t(key));
  });

  // top lang label
  const langText = document.getElementById("langText");
  if(langText){
    const map = { kr:"KR", en:"EN", cn:"CN", jp:"JP" };
    langText.textContent = map[state.lang] || "KR";
  }

  // ê°€ê²©/ë±ƒì§€ ë“± ë™ì  í…ìŠ¤íŠ¸ë„ ë‹¤ì‹œ ë°˜ì˜
  setPassPlan(state.selectedPlanId || "week7", true);
  renderAuthUI();
  renderMy();
  renderQR();
  renderRecommendModal?.();
}

// ì–¸ì–´ ì„ íƒì—ì„œ ì ìš©
function selectLang(lang){
  state.lang = lang;
  localStorage.setItem("bpass_lang", lang);
  closeModal("langModal");
  applyI18n();
}

    function openLang(){ openModal("langModal"); }

    function selectLang(code){
      state.lang = code;
      localStorage.setItem("bpass_lang", code);
      document.getElementById("langText").innerText = (code||"kr").toUpperCase();
      applyI18n();
      closeModal("langModal");
      renderAuthUI();
      renderMy();
      renderQR();
      renderRecommendModal();
      renderMapFilters();
      feather.replace();
    }

    function applyI18n(){
      const dict = I18N[state.lang] || I18N.kr;

      // data-i18n text
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const k = el.getAttribute("data-i18n");
        if(dict[k] != null) el.innerHTML = dict[k];
      });

      // placeholder
      document.querySelectorAll("[data-i18n-placeholder]").forEach(el=>{
        const k = el.getAttribute("data-i18n-placeholder");
        if(dict[k] != null) el.setAttribute("placeholder", dict[k]);
      });

      // langText
      document.getElementById("langText").innerText = (state.lang||"kr").toUpperCase();
    }

    /* ===== Boot ===== */
    window.addEventListener("load", async ()=>{
      applyI18n();

      // onboarding 1íšŒ
      if(!localStorage.getItem("bpass_onboarding_done")){
        showOnboarding();
      }

      // ë¡œê·¸ì¸/ìƒíƒœ ë¡œë“œ
      await loadMe();

      // ê¸°ë³¸ ì¶”ì²œ ì¹´í…Œê³ ë¦¬ íƒ­ ì´ˆê¸°í™”
      setRecommendCat(state.recommendCat || "stay", false);
      setPassPlan(state.selectedPlanId || "week7", true);

      feather.replace();
    });
  </script>
</body>
</html>