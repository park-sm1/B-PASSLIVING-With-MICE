<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>BÂ·PASS Living</title>

  <link rel="stylesheet" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
  <script src="https://unpkg.com/feather-icons"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    :root {
      --primary: #2563EB;
      --primary-grad: linear-gradient(135deg, #2563EB 0%, #00C6FF 100%);
      --text: #191F28;
      --sub: #6B7280;
      --bg: #F8F9FE;
      --card: rgba(255, 255, 255, 0.85);
      --glass: rgba(255, 255, 255, 0.7);
      --glass-border: 1px solid rgba(255, 255, 255, 0.8);
      --shadow: 0 10px 30px -5px rgba(37, 99, 235, 0.1);
      --radius: 24px;
      --border: rgba(0,0,0,0.06); /* [ìˆ˜ì •] ëˆ„ë½ ë³€ìˆ˜ ë³´ì™„ (login-boxì—ì„œ ì‚¬ìš©ë¨) */
      
      /* ì¹´í…Œê³ ë¦¬ë³„ ìƒ‰ìƒ */
      --c-stay: #FF3B30;
      --c-food: #F97316;
      --c-cafe: #8D6E63;
      --c-gym: #10B981;
      --c-work: #6366F1;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Pretendard", sans-serif; -webkit-tap-highlight-color: transparent; }
    body { background: var(--bg); color: var(--text); overflow: hidden; user-select: none; }
    ::-webkit-scrollbar { display: none; }

    /* ë°°ê²½ ì˜¤ë¡œë¼ */
    .aurora {
      position: fixed; inset: 0; z-index: -2;
      background: 
        radial-gradient(at 10% 10%, rgba(37,99,235,0.15) 0, transparent 60%),
        radial-gradient(at 90% 90%, rgba(204,248,2,0.1) 0, transparent 60%);
      animation: breathe 8s ease-in-out infinite alternate;
    }
    @keyframes breathe { from{opacity:.8;transform:scale(1)} to{opacity:1;transform:scale(1.05)} }

    /* ì•± ë ˆì´ì•„ì›ƒ */
    .app { max-width: 500px; height: 100dvh; margin: 0 auto; position: relative; display: flex; flex-direction: column; background: transparent; }

    /* í—¤ë” */
    header {
      padding: 16px 24px; position: fixed; top: 0; left: 0; right: 0; z-index: 50;
      max-width: 500px; margin: 0 auto; height: 100px; display: flex; flex-direction: column; justify-content: center;
      background: linear-gradient(180deg, rgba(248,249,254,0.95) 0%, rgba(248,249,254,0) 100%);
      pointer-events: none;
    }
    header > * { pointer-events: auto; }

    /* [ìˆ˜ì •] WORK SMART í°íŠ¸ ì¡°ê¸ˆ ì¤„ì´ê³ , WORK~ vs ìŠ¬ë¡œê±´ í–‰ê°„(ê°„ê²©) ë” ì¢í˜ */
    .h-top { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 0px; }
    .brand {
      font-size: 22px;               /* [ìˆ˜ì •] ë” ì‘ê²Œ */
      font-weight: 950;
      letter-spacing: 0.9px;         /* ìê°„ì€ ìœ ì§€/ì•½ê°„ ë„“ê²Œ */
      line-height: 1.0;              /* [ìˆ˜ì •] í–‰ê°„ ë” ì¤„ì„ */
      background: linear-gradient(90deg, var(--primary), #00C6FF);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .lang-btn { 
      background: rgba(255,255,255,0.6); padding: 8px 14px; border-radius: 20px; 
      font-size: 12px; font-weight: 800; border: 1px solid rgba(255,255,255,0.8);
      backdrop-filter: blur(10px); cursor: pointer; display: flex; align-items: center; gap: 4px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .h-sub {
      font-size: 13px;
      font-weight: 700;
      color: var(--sub);
      opacity: 0.9;
      margin-top: 0px;              /* [ìˆ˜ì •] ë” ì¢í˜ */
      line-height: 1.05;            /* [ìˆ˜ì •] í–‰ê°„ ì¤„ì„ */
    }

    /* ë·° ì»¨í…Œì´ë„ˆ */
    .view { flex: 1; overflow-y: auto; padding: 110px 24px 120px; display: none; scroll-behavior: smooth; }
    .view.active { display: block; animation: fadeUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    @keyframes fadeUp { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

    /* ë¡œê·¸ì¸ ë°•ìŠ¤ (ë²„ì „ D ë””ìì¸ ë³µêµ¬) */
    .login-box {
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
      padding: 24px; box-shadow: var(--shadow); backdrop-filter: blur(20px); margin-bottom: 16px;
      transition: transform 0.2s; position: relative; overflow: hidden; cursor: pointer;
    }
    .login-box:active { transform: scale(0.98); }
    .login-box::before {
      content: ""; position: absolute; inset: -50%; 
      background: radial-gradient(circle, rgba(37,99,235,0.1) 0%, transparent 60%);
      animation: rotate 6s linear infinite; z-index: -1;
    }
    @keyframes rotate { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
    .lb-label { font-size: 13px; font-weight: 700; color: var(--sub); margin-bottom: 6px; }
    .lb-title { font-size: 20px; font-weight: 900; color: var(--primary); display: flex; align-items: center; gap: 8px; }

    /* í€µ ë©”ë‰´ */
    .quick-list { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 30px; }
    .q-item { display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; }
    .q-icon {
      width: 54px; height: 54px; border-radius: 20px; background: rgba(255,255,255,0.9);
      border: 1px solid #fff; box-shadow: 0 8px 20px rgba(0,0,0,0.04);
      display: flex; align-items: center; justify-content: center; color: var(--text);
      transition: 0.2s;
    }
    .q-item:active .q-icon { transform: scale(0.92); background: var(--primary); color: #fff; }
    .q-text { font-size: 11px; font-weight: 800; color: var(--sub); }
    
    /* ì»¤ìŠ¤í…€ SVG ì•„ì´ì½˜ */
    .svg-icon { width: 24px; height: 24px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

    /* íŒ¨ìŠ¤ ìƒí’ˆ (Glass Style - z-index ìˆ˜ì •) */
    .pass-wrap { display: flex; flex-direction: column; gap: 16px; margin-bottom: 40px; }
    .pass-card {
      background: rgba(255,255,255,0.6); backdrop-filter: blur(10px);
      border-radius: var(--radius); padding: 24px; margin-bottom: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.04); border: 1px solid rgba(255,255,255,0.8);
      position: relative; z-index: 1;
    }
    
    .pc-tag { 
      display: inline-block; padding: 6px 10px; border-radius: 8px; 
      font-size: 11px; font-weight: 800; background: var(--primary-grad); color: #fff; margin-bottom: 12px;
    }
    .pc-title { font-size: 20px; font-weight: 900; margin-bottom: 4px; color: var(--text); }
    .pc-desc { font-size: 13px; color: var(--sub); margin-bottom: 16px; }
    .pc-price { display: flex; align-items: baseline; gap: 6px; margin-bottom: 16px; }
    .pc-old { text-decoration: line-through; color: #bbb; font-size: 14px; }
    .pc-new { font-size: 24px; font-weight: 900; color: var(--primary); }
    
    .pc-btns { display: grid; grid-template-columns: 1fr 2fr; gap: 8px; }
    .btn-glass { 
      background: rgba(255,255,255,0.5); border: 1px solid rgba(0,0,0,0.1); 
      padding: 14px; border-radius: 16px; font-size: 14px; font-weight: 800; cursor: pointer; color: var(--text);
    }
    .btn-solid { 
      background: var(--primary); color: #fff; border: none;
      padding: 14px; border-radius: 16px; font-size: 14px; font-weight: 800; 
      cursor: pointer; box-shadow: 0 8px 20px rgba(37,99,235,0.25); 
    }
    .btn-solid:active { transform: scale(0.98); }

    /* ì–¸ì–´ íƒ­/ê²°ì œ ì˜µì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn-outline{
      width: 100%;
      background: rgba(255,255,255,0.7);
      border: 1px solid rgba(0,0,0,0.08);
      padding: 14px;
      border-radius: 16px;
      font-size: 14px;
      font-weight: 800;
      cursor: pointer;
      color: var(--text);
      box-shadow: 0 6px 18px rgba(0,0,0,0.05);
    }
    .btn-outline:active{ transform: scale(0.98); }

    /* ì§€ë„ (Map) */
    #view-map { padding: 0; height: 100%; position: relative; }
    #map { width: 100%; height: 100%; z-index: 1; background: #E5E7EB; }
    .map-ui { 
      position: absolute; top: 110px; left: 16px; right: 16px; z-index: 100; 
      pointer-events: none; display: flex; flex-direction: column; gap: 10px;
    }
    .map-ui > * { pointer-events: auto; }
    
    .map-mode { background: #fff; padding: 4px; border-radius: 14px; display: flex; width: fit-content; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 8px; }
    .mm-btn { padding: 8px 14px; border-radius: 10px; font-size: 12px; font-weight: 800; color: var(--sub); cursor: pointer; }
    .mm-btn.active { background: var(--text); color: #fff; }

    /* ê²€ìƒ‰ì°½ ê°€ë¡œ */
    .search-box {
      background: rgba(255,255,255,0.98); backdrop-filter: blur(10px);
      border-radius: 16px; padding: 8px 12px; display: flex; align-items: center; gap: 8px; flex-direction: row;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08); margin-bottom: 8px; pointer-events: auto;
    }
    .sb-input { border: none; background: transparent; flex: 1; font-size: 14px; font-weight: 700; outline: none; height: 40px; }
    .sb-btn { background: var(--text); color: #fff; border-radius: 12px; padding: 0 16px; font-size: 13px; font-weight: 800; border: none; cursor: pointer; height: 36px; display: flex; align-items: center; }

    .cat-row { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px; }
    .cat-chip { 
      background: #fff; padding: 8px 14px; border-radius: 20px; font-size: 12px; font-weight: 800;
      border: 1px solid rgba(0,0,0,0.05); color: var(--sub); box-shadow: 0 4px 10px rgba(0,0,0,0.05); white-space: nowrap; cursor: pointer;
    }
    .cat-chip[data-cat="stay"].active { background: var(--c-stay); color: #fff; }
    .cat-chip[data-cat="food"].active { background: var(--c-food); color: #fff; }
    .cat-chip[data-cat="cafe"].active { background: var(--c-cafe); color: #fff; }
    .cat-chip[data-cat="gym"].active { background: var(--c-gym); color: #fff; }
    .cat-chip[data-cat="work"].active { background: var(--c-work); color: #fff; }
    .cat-chip[data-cat="all"].active { background: var(--text); color: #fff; }

    /* ì¶”ì²œ ë·° */
    .rec-header { padding-bottom: 20px; }
    .rec-tabs { display: flex; gap: 16px; margin-bottom: 20px; overflow-x: auto; }
    .rt-btn { 
      padding: 0; background: transparent; border: none;
      font-size: 17px; font-weight: 700; color: var(--sub); cursor: pointer; white-space: nowrap; margin-bottom: 4px;
    }
    .rt-btn.active { color: var(--text); font-weight: 950; border-bottom: 3px solid var(--text); padding-bottom: 4px; }
    
    .rec-list { padding-bottom: 100px; }
    .rec-card { background: #fff; border-radius: 20px; padding: 16px; margin-bottom: 16px; display: flex; gap: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: none; }
    .rc-img { width: 90px; height: 90px; border-radius: 14px; background: #eee; object-fit: cover; flex-shrink: 0; }
    .rc-info { flex: 1; display: flex; flex-direction: column; justify-content: center; }
    .rc-title { font-size: 16px; font-weight: 900; margin-bottom: 4px; }
    .rc-desc { font-size: 12px; color: var(--sub); margin-bottom: 12px; line-height: 1.3; }
    .rc-acts { display: flex; gap: 8px; }
    .rc-btn { padding: 8px 14px; border-radius: 10px; font-size: 11px; font-weight: 800; background: #F3F4F6; cursor: pointer; border: none; color: var(--text); }
    .rc-btn.map { background: rgba(37,99,235,0.1); color: var(--primary); }

    /* íŒ¨ìŠ¤ íƒ­ (C ë””ìì¸) */
    .cert-card {
      background: linear-gradient(135deg, var(--primary), #00C6FF); color: #fff;
      border-radius: 24px; padding: 28px 24px; position: relative; overflow: hidden;
      box-shadow: 0 15px 40px rgba(37,99,235,0.3); margin-bottom: 24px;
    }
    .cert-card::after { content: "BÂ·PASS"; position: absolute; bottom: -20px; right: -10px; font-size: 80px; font-weight: 900; opacity: 0.1; font-style: italic; }
    .cc-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; }
    .cc-label { font-size: 12px; opacity: 0.8; font-weight: 700; margin-bottom: 4px; }
    .cc-val { font-size: 22px; font-weight: 800; letter-spacing: -0.5px; }
    .cc-status { background: rgba(255,255,255,0.2); backdrop-filter: blur(5px); padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 800; }
    .cc-date { font-size: 13px; opacity: 0.9; }

    /* MY í˜ì´ì§€ */
    .my-tabs { 
      display: flex; gap: 24px; margin-bottom: 24px; overflow-x: auto; padding-bottom: 10px;
    }
    .mt-item { 
      font-size: 17px; font-weight: 700; color: #ccc; cursor: pointer; white-space: nowrap; flex-shrink: 0; padding-bottom: 4px;
    }
    .mt-item.active { 
      color: var(--text); font-weight: 950; border-bottom: 3px solid var(--text); 
    }

    .my-pass-bright {
      background: linear-gradient(135deg, #60A5FA, #3B82F6); 
      border-radius: 24px; padding: 24px; color: #fff;
      box-shadow: 0 10px 30px rgba(59,130,246,0.3); margin-bottom: 20px;
      position: relative; overflow: hidden;
    }

    /* MY ì„¸ë¶€ ì¹¸ (ìœ ë¦¬ íš¨ê³¼) */
    .v-item { 
      background: rgba(255,255,255,0.5); border-radius: 16px; padding: 20px; margin-bottom: 12px; 
      border: none; backdrop-filter: blur(10px);
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.03);
    }
    .v-btn {
      background: var(--text); color: #fff; border: none; padding: 8px 16px; border-radius: 10px; 
      font-size: 12px; font-weight: 800; cursor: pointer;
    }

    /* í•˜ë‹¨ ë°” (C ë²„ì „: ì•„ì´ì½˜+í…ìŠ¤íŠ¸) */
    .nav-bar {
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
      width: calc(100% - 48px); max-width: 450px;
      background: rgba(255,255,255,0.95); backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.5); padding: 14px 20px; border-radius: 30px;
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: 0 20px 50px rgba(0,0,0,0.15); z-index: 1000;
    }
    .nav-item { color: #C0C0C0; cursor: pointer; transition: 0.2s; position: relative; display: flex; flex-direction: column; align-items: center; gap: 4px; }
    .nav-item.active { color: var(--primary); transform: translateY(-2px); }
    .nav-item span { font-size: 9px; font-weight: 800; }
    .nav-item i { width: 22px; height: 22px; }

    .logout-btn {
      width: 100%; padding: 16px; border-radius: 16px; background: #E5E7EB; 
      color: var(--sub); font-weight: 800; border: none; margin-top: 30px; cursor: pointer;
    }

    /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
    .loading-overlay {
      position: fixed; inset: 0; z-index: 3000; background: rgba(255,255,255,0.98);
      display: none; flex-direction: column; align-items: center; justify-content: center;
    }
    .spinner {
      width: 60px; height: 60px; border: 6px solid rgba(37,99,235,0.1);
      border-top-color: var(--primary); border-radius: 50%;
      animation: spin 1s linear infinite; margin-bottom: 20px;
    }
    .loading-text { font-size: 20px; font-weight: 900; color: var(--text); animation: pulse 1s infinite; }
    .check-icon { width: 60px; height: 60px; color: #10B981; display: none; animation: pop 0.3s; margin-bottom: 20px; }
    @keyframes spin { to {transform: rotate(360deg);} }
    @keyframes pulse { 0% {opacity:0.6} 100% {opacity:1} }
    @keyframes pop { from{transform:scale(0)} to{transform:scale(1)} }

    /* ëª¨ë‹¬ */
    .overlay {
      position: fixed; inset: 0; z-index: 2000; background: rgba(0,0,0,0.6);
      backdrop-filter: blur(6px); display: none; align-items: flex-end; justify-content: center;
    }
    .modal {
      width: 100%; max-width: 500px; background: #fff; border-radius: 30px 30px 0 0;
      padding: 28px 24px 50px; animation: slideUp 0.3s cubic-bezier(0.16,1,0.3,1);
      max-height: 85vh; overflow-y: auto;
    }
    @keyframes slideUp { from{transform:translateY(100%)} to{transform:translateY(0)} }
    .grab { width: 40px; height: 4px; background: #E5E7EB; border-radius: 2px; margin: 0 auto 20px; }
    .modal h2 { font-size: 22px; font-weight: 950; margin-bottom: 16px; color: var(--text); }
    .modal-content { font-size: 14px; color: var(--sub); line-height: 1.6; white-space: pre-line; margin-bottom: 24px; }
    
    /* í•€ ìŠ¤íƒ€ì¼ */
    .pin {
      width: 32px; height: 32px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg);
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2); border: 2px solid #fff; transition: 0.3s;
    }
    .pin > i, .pin > svg { transform: rotate(45deg); width: 16px; height: 16px; color: #fff; }
    /* í•€ ìƒ‰ìƒ */
    .pin.stay { background: var(--c-stay); z-index: 1000 !important; width: 40px; height: 40px; }
    .pin.food { background: var(--c-food); }
    .pin.cafe { background: var(--c-cafe); }
    .pin.gym { background: var(--c-gym); }
    .pin.work { background: var(--c-work); }
    .pin.dimmed { filter: grayscale(100%); opacity: 0.3; }
    .pin.non-partner { opacity: 0.4; filter: grayscale(0.5); }

    /* ëª¨ë‹¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ (C ìŠ¤íƒ€ì¼) */
    .benefit-item { display: flex; align-items: center; margin-bottom: 12px; font-size: 14px; font-weight: 600; color: var(--text); }
    .benefit-item i { color: var(--primary); margin-right: 10px; width: 18px; }
  </style>
</head>

<body>

  <div class="aurora"></div>
  
  <div id="loadingLayer" class="loading-overlay">
    <div class="spinner" id="loadSpin"></div>
    <i data-feather="check-circle" class="check-icon" id="loadCheck"></i>
    <div class="loading-text" id="loadingText">ê²°ì œ ìš”ì²­ ì¤‘...</div>
  </div>

  <div class="app">
    <header>
      <div class="h-top">
        <div class="brand" data-i18n="brand">WORK SMART, STAY BUSAN</div>
        <div class="lang-btn" onclick="openModal('modal-lang')">
           <i data-feather="globe" style="width:14px;"></i> <span id="curLang">KR</span>
        </div>
      </div>
      <div class="h-sub" data-i18n="slogan">ë¹„ì¦ˆë‹ˆìŠ¤ íŠ¸ë¦½ì˜ ìƒˆë¡œìš´ ê¸°ì¤€, BÂ·PASS Living</div>
    </header>

    <div id="view-home" class="view active">
      
      <div class="login-box" onclick="handleLoginBox()">
        <div class="lb-label" id="homeLabel" data-i18n="login_label">ë‚´ íŒ¨ìŠ¤ ìƒíƒœ</div>
        <div class="lb-title" id="homeTitle">
          <span data-i18n="login_req">ë¡œê·¸ì¸ í›„ í™•ì¸í•˜ì„¸ìš”</span> <i data-feather="chevron-right"></i>
        </div>
      </div>

      <div class="quick-list">
        <div class="q-item" onclick="openInfo('taxi')">
          <div class="q-icon">
            <svg class="svg-icon" viewBox="0 0 24 24"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/></svg>
          </div>
          <span class="q-text" data-i18n="q_taxi">íƒì‹œ</span>
        </div>
        <div class="q-item" onclick="openInfo('work')">
          <div class="q-icon"><i data-feather="briefcase"></i></div>
          <span class="q-text" data-i18n="q_work">ì›Œí¬</span>
        </div>
        <div class="q-item" onclick="openInfo('gym')">
          <div class="q-icon">
             <svg class="svg-icon" viewBox="0 0 24 24"><path d="M6.5 10l-.8-2.3a2 2 0 0 0-2.6-1.1l-.3.1a2 2 0 0 0-1.1 2.6L4.2 17a2 2 0 0 0 2.6 1.1l.3-.1a2 2 0 0 0 1.1-2.6L7.5 13M17.5 10l.8-2.3a2 2 0 0 1 2.6-1.1l.3.1a2 2 0 0 1 1.1 2.6L19.8 17a2 2 0 0 1-2.6 1.1l-.3-.1a2 2 0 0 1-1.1-2.6L16.5 13M6.5 11.5h11"/></svg>
          </div>
          <span class="q-text" data-i18n="q_gym">í—¬ìŠ¤</span>
        </div>
        <div class="q-item" onclick="openInfo('cafe')">
          <div class="q-icon"><i data-feather="coffee"></i></div>
          <span class="q-text" data-i18n="q_cafe">ì¹´í˜</span>
        </div>
        <div class="q-item" onclick="openInfo('food')">
          <div class="q-icon">
            <svg class="svg-icon" viewBox="0 0 24 24"><path d="M16 2v14a4 4 0 0 1-4 4H5"/><path d="M12 2v6"/><path d="M8 2v6"/><path d="M4 2v6a4 4 0 0 0 4 4"/></svg>
          </div>
          <span class="q-text" data-i18n="q_food">ìŒì‹ì </span>
        </div>
      </div>

      <h3 style="margin: 30px 0 16px; font-size: 18px; font-weight: 800;" data-i18n="pass_title">íŒ¨ìŠ¤ êµ¬ë§¤í•˜ê¸°</h3>

      <div class="pass-wrap">
        <div class="pass-card">
          <div class="pc-tag">SHORT STAY</div>
          <div class="pc-title">Living Day (3ì¼)</div>
          <div class="pc-desc" data-i18n="p3_desc">ì§§ì€ ì¶œì¥ê³¼ ë¯¸íŒ…ì— ìµœì í™”ëœ íŒ¨ìŠ¤</div>
          <div class="pc-price">
            <span class="pc-old">79,000</span>
            <span class="pc-new">49,000ì›</span>
          </div>
          <div class="pc-btns">
            <button class="btn-glass" onclick="openPassDetail('3')" data-i18n="btn_look">ìƒì„¸ì •ë³´</button>
            <button class="btn-solid" onclick="openPay('3')" data-i18n="btn_buy">êµ¬ë§¤í•˜ê¸°</button>
          </div>
        </div>
        <div class="pass-card">
          <div class="pc-tag">LONG STAY</div>
          <div class="pc-title">Living Week (7ì¼)</div>
          <div class="pc-desc" data-i18n="p7_desc">ì¼ì£¼ì¼ê°„ ë¶€ì‚° ì›Œì¼€ì´ì…˜ì„ ìœ„í•œ ì˜¬ì¸ì› íŒ¨ìŠ¤</div>
          <div class="pc-price">
            <span class="pc-old">129,000</span>
            <span class="pc-new">99,000ì›</span>
          </div>
          <div class="pc-btns">
            <button class="btn-glass" onclick="openPassDetail('7')" data-i18n="btn_look">ìƒì„¸ì •ë³´</button>
            <button class="btn-solid" onclick="openPay('7')" data-i18n="btn_buy">êµ¬ë§¤í•˜ê¸°</button>
          </div>
        </div>
      </div>

      <div style="margin-top:40px; text-align:center;">
        <div style="display:flex; justify-content:center; gap:12px; margin-bottom:12px;">
          <span style="font-size:11px; font-weight:700; color:var(--sub); cursor:pointer;" onclick="openTerms('terms')" data-i18n="f_terms">ì´ìš©ì•½ê´€</span>
          <span style="font-size:11px; font-weight:700; color:var(--sub); cursor:pointer;" onclick="openTerms('privacy')" data-i18n="f_priv">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</span>
          <span style="font-size:11px; font-weight:700; color:var(--sub); cursor:pointer;" onclick="openTerms('refund')" data-i18n="f_ref">ìœ ì˜ì‚¬í•­/í™˜ë¶ˆ</span>
          <span style="font-size:11px; font-weight:700; color:var(--sub); cursor:pointer;" onclick="openTerms('contact')" data-i18n="f_contact">ë¬¸ì˜í•˜ê¸°</span>
        </div>
        <div style="font-size:10px; color:#bbb;">
          * ë³¸ í™”ë©´ì€ ì‹œì—°/í”„ë¡œí† íƒ€ì… ëª©ì ì˜ UIì´ë©°,<br>ì‹¤ì œ ì œíœ´/ìš´ì˜ ì •ë³´ëŠ” ì¶”í›„ ì ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>

    <div id="view-pass" class="view">
      <h2 style="font-size:24px; font-weight:950; margin-bottom:20px;">Digital Pass</h2>
      
      <div class="cert-card" id="certCard">
        <div class="cc-top">
          <div>
            <div class="cc-label">NAME</div>
            <div class="cc-val" id="certName">GUEST</div>
          </div>
          <div class="cc-status" id="certStatus">INACTIVE</div>
        </div>
        <div style="margin-bottom:20px;">
          <div class="cc-label">PASS ID</div>
          <div class="cc-val" id="certId" style="font-family:monospace;">-</div>
        </div>
        <div class="cc-date">
          ë§Œë£Œì¼: <span id="certDate">-</span>
        </div>
      </div>

      <div style="font-size:13px; color:var(--sub); text-align:center; line-height:1.6;" id="certMsg">
        ë¡œê·¸ì¸ ë° êµ¬ë§¤ í›„ í™œì„±í™”ë©ë‹ˆë‹¤.<br>
        ì œíœ´ì²˜ì—ì„œ ì´ í™”ë©´ì„ ë³´ì—¬ì£¼ì„¸ìš”.
      </div>
    </div>

    <div id="view-map" class="view">
      <div class="map-ui">
        <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:8px;">
          <div class="map-mode">
            <div class="mm-btn active" id="mode-cat" onclick="setMapMode('cat')">ì¹´í…Œê³ ë¦¬ë³„</div>
            <div class="mm-btn" id="mode-stay" onclick="setMapMode('stay')">ìˆ™ì†Œ ì£¼ë³€</div>
          </div>
        </div>
        
        <div class="search-box">
          <i data-feather="search" style="width:16px; color:var(--sub);"></i>
          <input class="sb-input" id="mapSearchInput" placeholder="ì¥ì†Œëª… ê²€ìƒ‰" onkeyup="if(event.key==='Enter') execSearch()">
          <button class="sb-btn" onclick="execSearch()">ê²€ìƒ‰</button>
        </div>

        <div class="cat-row" id="mapFilters">
          <div class="cat-chip active" data-cat="all" onclick="filterMap('all', this)">ì „ì²´</div>
          <div class="cat-chip" data-cat="stay" onclick="filterMap('stay', this)">ìˆ™ì†Œ</div>
          <div class="cat-chip" data-cat="food" onclick="filterMap('food', this)">ìŒì‹ì </div>
          <div class="cat-chip" data-cat="cafe" onclick="filterMap('cafe', this)">ì¹´í˜</div>
          <div class="cat-chip" data-cat="gym" onclick="filterMap('gym', this)">í—¬ìŠ¤</div>
          <div class="cat-chip" data-cat="work" onclick="filterMap('work', this)">ì›Œí¬ìŠ¤í˜ì´ìŠ¤</div>
        </div>
      </div>
      <div id="map"></div>
    </div>

    <div id="view-rec" class="view">
      <div class="rec-header">
        <h2 style="font-size:24px; font-weight:950;">ë¶€ì‚°ì„ ì œëŒ€ë¡œ ëŠê»´ ë³´ì„¸ìš”!</h2>
      </div>

      <div class="rec-tabs">
        <button class="rt-btn active" onclick="loadRec('stay', this)">ìˆ™ì†Œ</button>
        <button class="rt-btn" onclick="loadRec('food', this)">ìŒì‹ì </button>
        <button class="rt-btn" onclick="loadRec('cafe', this)">ì¹´í˜</button>
        <button class="rt-btn" onclick="loadRec('gym', this)">í—¬ìŠ¤ì¥</button>
        <button class="rt-btn" onclick="loadRec('work', this)">ì›Œí¬ìŠ¤í˜ì´ìŠ¤</button>
      </div>

      <div class="rec-list" id="recList"></div>
    </div>

    <div id="view-my" class="view">
      <h2 style="font-size:24px; font-weight:950; margin-bottom:20px;">My Lounge</h2>

      <div class="my-tabs">
        <div class="mt-item active" onclick="switchMy(0)">ë‚´ íŒ¨ìŠ¤</div>
        <div class="mt-item" onclick="switchMy(1)">ë°”ìš°ì²˜</div>
        <div class="mt-item" onclick="switchMy(2)">ì´ìš©ë‚´ì—­</div>
        <div class="mt-item" onclick="switchMy(3)">ì •ì‚°</div>
        <div class="mt-item" onclick="switchMy(4)">ì •ë³´</div>
      </div>

      <div class="my-sec" id="ms-0">
        <div class="my-pass-bright">
          <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <div>
              <div style="font-size:11px; opacity:0.8; margin-bottom:4px;">MEMBERSHIP</div>
              <div style="font-size:22px; font-weight:900;" id="mp-title">êµ¬ë§¤ ë‚´ì—­ ì—†ìŒ</div>
            </div>
            <div style="background:rgba(255,255,255,0.2); padding:6px 12px; border-radius:20px; height:fit-content; font-size:11px; font-weight:800;" id="mp-status">INACTIVE</div>
          </div>
          <div style="font-size:13px; opacity:0.9;">
            <span id="mp-time">íŒ¨ìŠ¤ êµ¬ë§¤ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</span>
          </div>
        </div>
      </div>

      <div class="my-sec" id="ms-1" style="display:none;">
        <div id="voucherList">
          <div style="text-align:center; padding:40px; color:#aaa; font-size:14px;">êµ¬ë§¤í•œ íŒ¨ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>
      </div>

      <div class="my-sec" id="ms-2" style="display:none;">
        <div class="v-item"><span style="color:var(--sub); font-size:14px;">ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</span></div>
      </div>

      <div class="my-sec" id="ms-3" style="display:none;">
        <div class="v-item" onclick="downloadReceipt()">
          <span style="font-weight:700;">í†µí•© ì˜ìˆ˜ì¦ ë°œê¸‰</span>
          <i data-feather="download"></i>
        </div>
        <div class="v-item" onclick="promptEmail()">
          <span style="font-weight:700;">ë‚´ì—­ì„œ ì´ë©”ì¼ ì „ì†¡</span>
          <i data-feather="mail"></i>
        </div>
      </div>

      <div class="my-sec" id="ms-4" style="display:none;">
        <div style="background:rgba(255,255,255,0.5); backdrop-filter:blur(10px); border-radius:16px;">
          <div style="padding:18px; border-bottom:1px solid rgba(0,0,0,0.05); font-weight:700;" onclick="openTerms('contact')">ê³ ê°ì„¼í„° / ë¬¸ì˜</div>
          <div style="padding:18px; border-bottom:1px solid rgba(0,0,0,0.05); font-weight:700;" onclick="openTerms('terms')">ì´ìš©ì•½ê´€</div>
          <div style="padding:18px; border-bottom:1px solid rgba(0,0,0,0.05); font-weight:700;" onclick="openTerms('privacy')">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</div>
          <div style="padding:18px; font-weight:700;" onclick="openTerms('refund')">í™˜ë¶ˆ/ì·¨ì†Œ ì •ì±…</div>
        </div>
      </div>

      <button class="logout-btn" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div class="nav-bar">
      <div class="nav-item active" onclick="goView('home', this)"><i data-feather="home"></i><span>í™ˆ</span></div>
      <div class="nav-item" onclick="goView('pass', this)"><i data-feather="credit-card"></i><span>íŒ¨ìŠ¤</span></div>
      <div class="nav-item" onclick="goView('map', this)"><i data-feather="map"></i><span>ì§€ë„</span></div>
      <div class="nav-item" onclick="goView('rec', this)"><i data-feather="star"></i><span>ì¶”ì²œ</span></div>
      <div class="nav-item" onclick="goView('my', this)"><i data-feather="user"></i><span>MY</span></div>
    </div>

    <div id="modal-info" class="overlay" onclick="closeModal(this)">
      <div class="modal" onclick="event.stopPropagation()">
        <div class="grab"></div>
        <h2 id="mi-title">Title</h2>
        <div class="modal-content" id="mi-desc">Desc</div>
        <button class="btn-solid" style="width:100%" onclick="closeModal(document.getElementById('modal-info'))">í™•ì¸</button>
      </div>
    </div>

    <div id="modal-pass-detail" class="overlay" onclick="closeModal(this)">
      <div class="modal" onclick="event.stopPropagation()">
        <div class="grab"></div>
        <h2 id="pd-title">Living Week</h2>
        <div class="md-list" style="margin-bottom:24px;">
          <div class="benefit-item"><i data-feather="check"></i> <div>ì›Œí¬ìŠ¤í˜ì´ìŠ¤: 4ì‹œê°„ê¶Œ <span id="md-work">(2ë§¤)</span></div></div>
          <div class="benefit-item"><i data-feather="check"></i> <div>í—¬ìŠ¤ì¥: ì¼ì¼ê¶Œ <span id="md-gym">(2ë§¤)</span></div></div>
          <div class="benefit-item"><i data-feather="check"></i> <div>êµí†µ: ì¹´ì¹´ì˜¤T í•€ë²ˆí˜¸ ì§€ê¸‰</div></div>
          <div class="benefit-item"><i data-feather="check"></i> <div>F&B: ì¹´í˜/ë§›ì§‘ 20% í˜„ì¥ í• ì¸</div></div>
        </div>
        <div style="background:#f5f5f5; padding:15px; border-radius:12px; margin-bottom:20px;">
          <div style="font-weight:700; margin-bottom:4px; font-size:13px;">ì£¼ìš” ì´ìš© ê°€ëŠ¥ ì œíœ´ì²˜</div>
          <div style="font-size:12px; color:var(--sub); line-height:1.4;">
            ìœ„ì›Œí¬ BIFC, ì¹´í˜051 ì„¼í…€ì , ì§ë°•ìŠ¤ ì„¼í…€, ì‹ ë¼ìŠ¤í…Œì´ í•´ìš´ëŒ€, í•´ìš´ëŒ€ì•”ì†Œê°ˆë¹„ ë“±
          </div>
        </div>
        <button class="btn-solid" style="width:100%" onclick="closeModal(document.getElementById('modal-pass-detail'))">ë‹«ê¸°</button>
      </div>
    </div>

    <div id="modal-pay" class="overlay" onclick="closeModal(this)">
      <div class="modal" onclick="event.stopPropagation()">
        <div class="grab"></div>
        <h2>ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ</h2>
        <div style="font-size:24px; font-weight:900; color:var(--primary); margin-bottom:24px;" id="pay-amt">0ì›</div>
        <div style="display:grid; gap:10px;">
          <button class="btn-outline" style="background:#FEE500; border:none;" onclick="processPay()">ì¹´ì¹´ì˜¤í˜ì´</button>
          <button class="btn-outline" style="background:#03C75A; color:#fff; border:none;" onclick="processPay()">ë„¤ì´ë²„í˜ì´</button>
          <button class="btn-outline" onclick="processPay()">ì‹ ìš©/ì²´í¬ì¹´ë“œ</button>
          <button class="btn-outline" onclick="processPay()">íœ´ëŒ€í°ê²°ì œ</button>
        </div>
      </div>
    </div>

    <div id="modal-rec-detail" class="overlay" onclick="closeModal(this)">
      <div class="modal" onclick="event.stopPropagation()">
        <div class="grab"></div>
        <h2 id="rd-title">ì¥ì†Œëª…</h2>
        <img id="rd-img" src="" style="width:100%; height:200px; border-radius:16px; object-fit:cover; margin-bottom:16px;">
        <div class="modal-content" id="rd-desc">ì„¤ëª…</div>
        <button class="btn-solid" style="width:100%" onclick="closeModal(document.getElementById('modal-rec-detail'))">ë‹«ê¸°</button>
      </div>
    </div>

    <!-- [ìˆ˜ì •] ë°”ìš°ì²˜ ì‚¬ìš© ëª¨ë‹¬ ë¬¸êµ¬ ë³€ê²½ -->
    <div id="modal-voucher-code" class="overlay" onclick="closeModal(this)">
      <div class="modal" onclick="event.stopPropagation()">
        <div class="grab"></div>
        <h2 style="text-align:center;">ë°”ìš°ì²˜ ì‚¬ìš©</h2>
        <div style="text-align:center; padding:30px 0;">
          <div style="color:var(--sub); font-size:14px; margin-bottom:10px;">ì¹´ì¹´ì˜¤T ì•±ì—ì„œ PINì„ ë“±ë¡í•˜ì„¸ìš”</div>
          <div style="font-size:30px; font-weight:900; letter-spacing:2px; color:var(--primary);">A1B2-C3D4</div>
        </div>
        <button class="btn-solid" style="width:100%" onclick="closeModal(document.getElementById('modal-voucher-code'))">ì‚¬ìš© ì™„ë£Œ</button>
      </div>
    </div>

    <div id="modal-lang" class="overlay" onclick="closeModal(this)">
      <div class="modal" onclick="event.stopPropagation()">
        <div class="grab"></div><h2>Language</h2>
        <div style="display:flex;flex-direction:column;gap:10px;">
          <button class="btn-outline" onclick="setLang('KR')">ğŸ‡°ğŸ‡· í•œêµ­ì–´</button>
          <button class="btn-outline" onclick="setLang('EN')">ğŸ‡ºğŸ‡¸ English</button>
          <button class="btn-outline" onclick="setLang('CN')">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</button>
          <button class="btn-outline" onclick="setLang('JP')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
        </div>
      </div>
    </div>

    <div id="modal-terms" class="overlay" onclick="closeModal(this)">
      <div class="modal" onclick="event.stopPropagation()">
        <div class="grab"></div>
        <h2 id="mt-title">ì œëª©</h2>
        <div class="modal-content" id="mt-body">ë‚´ìš©</div>
      </div>
    </div>

  </div>

    <script>
    feather.replace();

    /* --- STATE --- */
    let user = { loggedIn: false, hasPass: false, passDays: 0 };
    let map = null, markers = [], mapMode = 'cat';
    let curLang = 'KR';

    /* --- I18N DATA --- */
    const i18n = {
      KR: { brand:"WORK SMART, STAY BUSAN", sub:"ë¹„ì¦ˆë‹ˆìŠ¤ íŠ¸ë¦½ì˜ ìƒˆë¡œìš´ ê¸°ì¤€, BÂ·PASS Living", login_plz:"ë¡œê·¸ì¸ í›„ í™•ì¸í•˜ì„¸ìš”", pass_need:"íŒ¨ìŠ¤ êµ¬ë§¤ê°€ í•„ìš”í•©ë‹ˆë‹¤", my_pass:"ë‚´ íŒ¨ìŠ¤ ìƒíƒœ", welcome:"í™˜ì˜í•©ë‹ˆë‹¤", buy_title:"íŒ¨ìŠ¤ êµ¬ë§¤í•˜ê¸°", q_taxi:"íƒì‹œ", q_work:"ì›Œí¬", q_gym:"í—¬ìŠ¤", q_cafe:"ì¹´í˜", q_food:"ìŒì‹ì ", short:"SHORT STAY", long:"LONG STAY", p3_desc:"ì§§ì€ ì¶œì¥ê³¼ ë¯¸íŒ…ì— ìµœì í™”ëœ íŒ¨ìŠ¤", p7_desc:"ì¼ì£¼ì¼ê°„ ë¶€ì‚° ì›Œì¼€ì´ì…˜ì„ ìœ„í•œ ì˜¬ì¸ì› íŒ¨ìŠ¤", look:"ìƒì„¸ì •ë³´", buy:"êµ¬ë§¤í•˜ê¸°" },
      EN: { brand:"WORK SMART, STAY BUSAN", sub:"New Standard for Business Trips", login_plz:"Please Login", pass_need:"Pass Required", my_pass:"My Pass Status", welcome:"Welcome", buy_title:"Buy Pass", q_taxi:"Taxi", q_work:"Work", q_gym:"Gym", q_cafe:"Cafe", q_food:"Food", short:"SHORT STAY", long:"LONG STAY", p3_desc:"Best for short business trips", p7_desc:"All-in-one pass for week-long stay", look:"Details", buy:"Buy" },
      CN: { brand:"å·¥ä½œä¸ç”Ÿæ´», é‡œå±±", sub:"å•†åŠ¡æ—…è¡Œçš„æ–°æ ‡å‡†", login_plz:"è¯·ç™»å½•", pass_need:"éœ€è¦è´­ä¹°é€šè¡Œè¯", my_pass:"æˆ‘çš„é€šè¡Œè¯", welcome:"æ¬¢è¿", buy_title:"è´­ä¹°é€šè¡Œè¯", q_taxi:"å‡ºç§Ÿè½¦", q_work:"åŠå…¬", q_gym:"å¥èº«", q_cafe:"å’–å•¡", q_food:"ç¾é£Ÿ", short:"çŸ­æœŸåœç•™", long:"é•¿æœŸåœç•™", p3_desc:"é€‚åˆçŸ­æœŸå‡ºå·®", p7_desc:"ä¸€å‘¨å·¥ä½œåº¦å‡å…¨èƒ½é€šè¡Œè¯", look:"è¯¦æƒ…", buy:"è´­ä¹°" },
      JP: { brand:"ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒãƒ¼ãƒˆ, é‡œå±±ã‚¹ãƒ†ã‚¤", sub:"å‡ºå¼µã®æ–°ã—ã„ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰", login_plz:"ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„", pass_need:"ãƒ‘ã‚¹ã®è³¼å…¥ãŒå¿…è¦ã§ã™", my_pass:"ãƒ‘ã‚¹ã®çŠ¶æ…‹", welcome:"ã‚ˆã†ã“ã", buy_title:"ãƒ‘ã‚¹è³¼å…¥", q_taxi:"ã‚¿ã‚¯ã‚·ãƒ¼", q_work:"ãƒ¯ãƒ¼ã‚¯", q_gym:"ã‚¸ãƒ ", q_cafe:"ã‚«ãƒ•ã‚§", q_food:"ã‚°ãƒ«ãƒ¡", short:"çŸ­æœŸæ»åœ¨", long:"é•·æœŸæ»åœ¨", p3_desc:"çŸ­æœŸå‡ºå¼µã«æœ€é©", p7_desc:"1é€±é–“ã®ãƒ¯ãƒ¼ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨", look:"è©³ç´°", buy:"è³¼å…¥" }
    };

    /* --- MAP DATA --- */
    const partners = [];
    const areas = [
      {lat:35.157, lng:129.059},
      {lat:35.097, lng:129.034},
      {lat:35.153, lng:129.118},
      {lat:35.169, lng:129.136}
    ];
    
    const cats = ['food','cafe','gym','work','stay'];
    const names = {
      food:['ê°œë¯¸ì§‘','ì´ˆëŸ‰ë°€ë©´','í•´ìš´ëŒ€ì•”ì†Œê°ˆë¹„','ì´ì¬ëª¨í”¼ì','ìˆ˜ë³€ìµœê³ êµ­ë°¥','ê¸ˆìˆ˜ë³µêµ­','ì†ì‹œì›í•œëŒ€êµ¬íƒ•','ì˜µìŠ¤','ê³ ë˜ì‚¬ì–´ë¬µ','ìŒë‘¥ì´êµ­ë°¥'],
      cafe:['ì¹´í˜051','ìŠ¤íƒ€ë²…ìŠ¤','ë¸”ë™ì—…ì»¤í”¼','ëª¨ëª¨ìŠ¤ì»¤í”¼','ì›¨ì´ë¸Œì˜¨','ë¹„ë¹„ë¹„ë‹¹','ë‘ë°ìë·°','ë¸”ë£¨ìƒ¥','í…í¼ì„¼íŠ¸','ì»´í¬ì¦ˆ','ì´ë””ì•¼','íˆ¬ì¸í”Œë ˆì´ìŠ¤','í• ë¦¬ìŠ¤','í´ë°”ì…‹','ì»¤í”¼ë¹ˆ'],
      gym:['ì§ë°•ìŠ¤','ì œì„ìŠ¤ì§','í”„ë¼ì„íœ˜íŠ¸ë‹ˆìŠ¤','ë§ˆë¦°ì‹œí‹°ì§','ì„¼í…€í—¬ìŠ¤','í•´ìš´ëŒ€í¬ë¡œìŠ¤í•','ìš”ê°€ë£©ìŠ¤','í•„ë¼í…ŒìŠ¤365','ë°”ë””ì±„ë„','ìŠ¤í¬ì• ë‹ˆ','ë©‹ì§','í”¼íŠ¸ë‹ˆìŠ¤101','ë²„ë‹ì§','íˆíŠ¸ì§','ë¹„íƒ€ë¯¼íœ˜íŠ¸ë‹ˆìŠ¤'],
      work:['ìœ„ì›Œí¬','íŒ¨ìŠ¤íŠ¸íŒŒì´ë¸Œ','íŒ¨ìŠ¤íŒŒì¸ë”','0.9M','ì¹´í˜ìœ„ë“œ','ë¬´ì‹ ì‚¬ìŠ¤íŠœë””ì˜¤','KT&Gìƒìƒë§ˆë‹¹','ë¶€ì‚°ì½˜í…ì¸ ì½”ë¦¬ì•„','ë¶€ì‚°ì°½ì—…ì¹´í˜','ì„¼í…€ë¹„ì¦ˆ','ì›Œí¬í”Œë ‰ìŠ¤','ë¦¬ì €ìŠ¤','ìŠ¤íŒŒí¬í”ŒëŸ¬ìŠ¤','ê°€ë¼ì§€','ë§ˆì´ì›Œí¬ìŠ¤í˜ì´ìŠ¤'],
      stay:['ì‹ ë¼ìŠ¤í…Œì´','ê·¸ëœë“œì¡°ì„ ','íŒŒë¼ë‹¤ì´ìŠ¤','ì›¨ìŠ¤í‹´ì¡°ì„ ','íŒŒí¬í•˜ì–íŠ¸','ë¡¯ë°í˜¸í…”','ì•„ë°”ë‹ˆ','ë¼ë°œìŠ¤','í˜ì–´í•„ë“œ','ì•„ë‚œí‹°','ì‹œê·¸ë‹ˆì—˜','ííŠ¼','í•˜ìš´ë“œí˜¸í…”','ë¸Œë¼ìš´ë„íŠ¸','í† ìš”ì½”ì¸']
    };

    for(let i=0; i<100; i++) {
      const c = cats[i % 5];
      const n = names[c][i % 10];
      const area = areas[i % 4];
      partners.push({
        id: i, cat: c, name: n,
        lat: area.lat + (Math.random()-0.5)*0.03,
        lng: area.lng + (Math.random()-0.5)*0.03,
        partner: Math.random() > 0.4,
        img: `https://picsum.photos/200/200?random=${i}`
      });
    }

    const recData = {
      stay: partners.filter(p=>p.cat==='stay').slice(0,10),
      food: partners.filter(p=>p.cat==='food').slice(0,10),
      cafe: partners.filter(p=>p.cat==='cafe').slice(0,10),
      gym: partners.filter(p=>p.cat==='gym').slice(0,10),
      work: partners.filter(p=>p.cat==='work').slice(0,10)
    };

    /* --- INIT --- */
    window.onload = () => {
      loadRec('stay', document.querySelector('.rt-btn.active'));
      updateHomeUI();
    };

    /* --- NAVIGATION --- */
    function goView(id, el) {
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.getElementById('view-'+id).classList.add('active');
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      el.classList.add('active');
      if(id==='map') setTimeout(initMap, 200);
      feather.replace();
    }

    /* --- HOME LOGIC --- */
    function handleLoginBox() {
      if(!user.loggedIn) {
        if(confirm("ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.(ì‹œì—°ìš©)")) {
          user.loggedIn = true;
          alert("ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
          updateHomeUI();
          updatePassUI();
        }
      } else if(!user.hasPass) {
        alert("ì•„ë˜ì—ì„œ íŒ¨ìŠ¤ë¥¼ êµ¬ë§¤í•´ì£¼ì„¸ìš”.");
        document.querySelector('.pass-wrap').scrollIntoView({behavior:'smooth'});
      } else {
        goView('pass', document.querySelectorAll('.nav-item')[1]);
      }
    }

    function updateHomeUI() {
      const t = document.getElementById('homeTitle');
      const l = document.getElementById('homeLabel');
      const txt = i18n[curLang];
      
      if(user.loggedIn) {
        l.innerText = "í™ê¸¸ë™ë‹˜, " + txt.welcome;
        if(user.hasPass) {
          t.innerHTML = `<span style="color:#10B981">ACTIVE PASS</span> <i data-feather="check-circle" style="color:#2563EB"></i>`;
        } else {
          t.innerHTML = `${txt.pass_need} <i data-feather="shopping-bag"></i>`;
        }
      } else {
        l.innerText = txt.my_pass;
        t.innerHTML = `${txt.login_plz} <i data-feather="chevron-right"></i>`;
      }
      feather.replace();
    }

    function openInfo(type) {
      const data = {
        taxi: {t:"íƒì‹œ ì´ìš© ì•ˆë‚´", d:"íŒ¨ìŠ¤ êµ¬ë§¤ ì‹œ PINì´ ì§€ê¸‰ë©ë‹ˆë‹¤.\nMY > ë°”ìš°ì²˜ì—ì„œ í™•ì¸ í›„,\nì¹´ì¹´ì˜¤T ì•±ì— ë“±ë¡í•˜ì—¬ ì¦‰ì‹œ ì‚¬ìš©í•˜ì„¸ìš”."},
        work: {t:"ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ìš©", d:"4ì‹œê°„ ì´ìš©ê¶Œ ê¸°ì¤€ì…ë‹ˆë‹¤.\n3ì¼ê¶Œì€ 2ë§¤, 7ì¼ê¶Œì€ 4ë§¤ ì§€ê¸‰ë©ë‹ˆë‹¤.\nì´ìš©ì€ MY > ë°”ìš°ì²˜ì—ì„œ í™•ì¸ í›„ ì‚¬ìš© ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ì§„í–‰í•´ ì£¼ì„¸ìš”."},
        gym: {t:"í—¬ìŠ¤ì¥ ì´ìš©", d:"ì¼ì¼ê¶Œìœ¼ë¡œ ì§€ê¸‰ë©ë‹ˆë‹¤.\n3ì¼ê¶Œì€ 2ë§¤, 7ì¼ê¶Œì€ 4ë§¤ ì§€ê¸‰ë©ë‹ˆë‹¤.\nì´ìš©ì€ MY > ë°”ìš°ì²˜ì—ì„œ í™•ì¸ í›„ ì‚¬ìš© ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ì§„í–‰í•´ ì£¼ì„¸ìš”."},
        cafe: {t:"ì¹´í˜ í• ì¸", d:"ì§€ë„ì— í‘œì‹œëœ ì œíœ´ ë§¤ì¥ì„ ë°©ë¬¸í•˜ì—¬\nê²°ì œ ì „ íŒ¨ìŠ¤ í™”ë©´ì„ ë³´ì—¬ì£¼ì‹œë©´ ì¦‰ì‹œ í• ì¸ë©ë‹ˆë‹¤."},
        food: {t:"ìŒì‹ì  í• ì¸", d:"ì§€ë„ì— í‘œì‹œëœ ì œíœ´ ë§¤ì¥ì„ ë°©ë¬¸í•˜ì—¬\nê²°ì œ ì „ íŒ¨ìŠ¤ í™”ë©´ì„ ë³´ì—¬ì£¼ì‹œë©´ ì¦‰ì‹œ í• ì¸ë©ë‹ˆë‹¤."}
      };
      document.getElementById('mi-title').innerText = data[type].t;
      document.getElementById('mi-desc').innerText = data[type].d;
      openModal('modal-info');
    }

    /* --- PASS PURCHASE --- */
    function openPassDetail(days) {
      const is3 = days === '3';
      const cnt = is3 ? '(2ë§¤)' : '(4ë§¤)';
      document.getElementById('pd-title').innerText = is3 ? 'Living Day (3ì¼)' : 'Living Week (7ì¼)';
      document.getElementById('md-work').innerText = cnt;
      document.getElementById('md-gym').innerText = cnt;
      feather.replace();
      openModal('modal-pass-detail');
    }

    let tempPayDays = 0;
    function openPay(days) {
      if(!user.loggedIn) return alert("ë¡œê·¸ì¸ í›„ êµ¬ë§¤ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      tempPayDays = parseInt(days);
      const pr = days==='3' ? "49,000ì›" : "99,000ì›";
      document.getElementById('pay-amt').innerText = pr;
      openModal('modal-pay');
    }

    function processPay() {
      if(confirm("ê²°ì œë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        closeModal(document.getElementById('modal-pay'));
        document.getElementById('loadingLayer').style.display = 'flex';
        
        const txt = document.getElementById('loadingText');
        const check = document.getElementById('loadCheck');
        const spin = document.getElementById('loadSpin');
        
        check.style.display = 'none'; spin.style.display = 'block';
        txt.innerText = "ê²°ì œ ìš”ì²­ ì¤‘...";
        
        setTimeout(() => {
          txt.innerText = "ë³´ì•ˆ ì—°ê²° ì¤‘...";
          setTimeout(() => {
            txt.innerText = "ì¹´ë“œì‚¬ ìŠ¹ì¸ ì¤‘...";
            setTimeout(() => {
              spin.style.display = 'none';
              check.style.display = 'block';
              txt.innerText = "ê²°ì œ ì™„ë£Œ!";
              feather.replace();
              setTimeout(() => {
                document.getElementById('loadingLayer').style.display = 'none';
                user.hasPass = true;
                user.passDays = tempPayDays;
                updateHomeUI();
                updatePassUI();
                updateVoucherUI();
                alert("ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! íŒ¨ìŠ¤ê°€ í™œì„±í™”ë©ë‹ˆë‹¤.");
                goView('pass', document.querySelectorAll('.nav-item')[1]);
              }, 1000);
            }, 1000);
          }, 1000);
        }, 1000);
      }
    }

    /* --- PASS UI --- */
    function updatePassUI() {
      if(user.hasPass) {
        const end = new Date();
        end.setDate(end.getDate() + user.passDays);
        const diff = Math.ceil((end - new Date()) / (1000*60*60*24));
        const str = end.toLocaleDateString();

        document.getElementById('certName').innerText = "í™ê¸¸ë™";
        document.getElementById('certStatus').innerText = "ACTIVE";
        document.getElementById('certId').innerText = "BP-" + Math.floor(Math.random()*100000);
        document.getElementById('certDate').innerText = `${str} (${diff}ì¼ ë‚¨ìŒ)`;
        document.getElementById('certMsg').innerText = "ì œíœ´ì²˜ì—ì„œ ìœ„ í™”ë©´ì„ ì œì‹œí•˜ë©´\nì¦‰ì‹œ í˜œíƒì´ ì ìš©ë©ë‹ˆë‹¤.";

        document.getElementById('mp-title').innerText = user.passDays===3 ? 'Living Day (3ì¼)' : 'Living Week (7ì¼)';
        document.getElementById('mp-status').innerText = "ACTIVE";
        document.getElementById('mp-time').innerText = `${str} (${diff}ì¼ ë‚¨ìŒ)`;
      }
    }

    /* --- VOUCHER UI --- */
    function updateVoucherUI() {
      const cnt = user.passDays === 3 ? 2 : 4;
      const list = document.getElementById('voucherList');
      
      list.innerHTML = `
        <div class="v-item">
          <div>
            <div style="font-weight:800; font-size:16px;">ì¹´ì¹´ì˜¤T PIN</div>
            <div style="font-size:13px; color:#888;">ë°œê¸‰ ì™„ë£Œ</div>
          </div>
          <button class="v-btn" onclick="openVoucher()">ì‚¬ìš©</button>
        </div>
        <div class="v-item">
          <div>
            <div style="font-weight:800; font-size:16px;">ê³µìœ ì˜¤í”¼ìŠ¤ 4ì‹œê°„ê¶Œ</div>
            <div style="font-size:13px; color:#888;">${cnt}ë§¤ ë³´ìœ </div>
          </div>
          <button class="v-btn" onclick="openVoucher()">ì‚¬ìš©</button>
        </div>
        <div class="v-item">
          <div>
            <div style="font-weight:800; font-size:16px;">í—¬ìŠ¤ì¥ ì¼ì¼ê¶Œ</div>
            <div style="font-size:13px; color:#888;">${cnt}ë§¤ ë³´ìœ </div>
          </div>
          <button class="v-btn" onclick="openVoucher()">ì‚¬ìš©</button>
        </div>
      `;
    }

    function openVoucher() { openModal('modal-voucher-code'); }
    function downloadReceipt() { if(!user.loggedIn || !user.hasPass) return alert("íŒ¨ìŠ¤ êµ¬ë§¤ í›„ ì´ìš© ê°€ëŠ¥"); alert("ë‹¤ìš´ë¡œë“œ ì‹œì‘"); }
    function promptEmail() { if(!user.loggedIn || !user.hasPass) return alert("íŒ¨ìŠ¤ êµ¬ë§¤ í›„ ì´ìš© ê°€ëŠ¥"); prompt("ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥:"); }

    /* --- MAP --- */
    function initMap() {
      if(map) { map.invalidateSize(); return; }
      map = L.map('map', { zoomControl: false }).setView([35.157, 129.059], 12);
      L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);
      renderMarkers();
    }

    function setMapMode(mode) {
      mapMode = mode;
      document.getElementById('mode-cat').classList.toggle('active', mode==='cat');
      document.getElementById('mode-stay').classList.toggle('active', mode==='stay');
      document.getElementById('mapFilters').style.display = mode==='cat' ? 'flex' : 'none';
      renderMarkers();
    }

    function filterMap(cat, el) {
      document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
      el.classList.add('active');
      renderMarkers(cat);
    }

    function renderMarkers(filter = 'all') {
      markers.forEach(m => map.removeLayer(m));
      markers = [];
      
      let targets = partners;
      if(mapMode === 'stay') {
        targets = partners.filter(p => p.cat === 'stay');
      } else {
        const activeChip = document.querySelector('.cat-chip.active');
        const activeCat = activeChip ? activeChip.dataset.cat : 'all';
        if(activeCat !== 'all') targets = partners.filter(p => p.cat === activeCat);
      }

      targets.forEach(p => {
        const typeClass = p.cat + (p.partner ? '' : ' non-partner');
        let iconSvg = '';
        if(p.cat==='stay') iconSvg = '<i data-feather="home"></i>';
        else if(p.cat==='food') iconSvg = '<svg class="svg-icon" viewBox="0 0 24 24"><path d="M16 2v14a4 4 0 0 1-4 4H5"/><path d="M12 2v6"/><path d="M8 2v6"/><path d="M4 2v6a4 4 0 0 0 4 4"/></svg>';
        else if(p.cat==='cafe') iconSvg = '<i data-feather="coffee"></i>';
        else if(p.cat==='gym') iconSvg = '<svg class="svg-icon" viewBox="0 0 24 24"><path d="M6.5 10l-.8-2.3a2 2 0 0 0-2.6-1.1l-.3.1a2 2 0 0 0-1.1 2.6L4.2 17a2 2 0 0 0 2.6 1.1l.3-.1a2 2 0 0 0 1.1-2.6L7.5 13M17.5 10l.8-2.3a2 2 0 0 1 2.6-1.1l.3.1a2 2 0 0 1 1.1 2.6L19.8 17a2 2 0 0 1-2.6 1.1l-.3-.1a2 2 0 0 1-1.1-2.6L16.5 13M6.5 11.5h11"/></svg>';
        else iconSvg = '<i data-feather="briefcase"></i>';

        const iconHtml = `<div class="pin ${typeClass}">${iconSvg}</div>`;
        const icon = L.divIcon({ className:'custom', html:iconHtml, iconSize:[30,30], iconAnchor:[15,30] });
        
        const m = L.marker([p.lat, p.lng], { icon: icon }).addTo(map);
        m.__pid = p.id; /* [ìˆ˜ì •] ê²€ìƒ‰ìš© id ì—°ê²° */

        if(mapMode === 'stay') {
          m.on('click', () => {
             document.querySelectorAll('.pin').forEach(el => el.classList.add('dimmed'));
             const currentPin = m.getElement().querySelector('.pin');
             if(currentPin) currentPin.classList.remove('dimmed');
             alert(p.name + " ë°˜ê²½ 2km ì œíœ´ì²˜ë¥¼ íƒìƒ‰í•©ë‹ˆë‹¤.");
             feather.replace();
          });
        } else {
           m.bindPopup(`<b>${p.name}</b><br>${p.partner?'ì œíœ´':'ë¹„ì œíœ´'}`);
        }
        markers.push(m);
      });
      feather.replace();
    }

    function getDist(lat1, lng1, lat2, lng2) { return Math.sqrt(Math.pow(lat1-lat2, 2) + Math.pow(lng1-lng2, 2)); }

    /* [ìˆ˜ì •] ì§€ë„ ê²€ìƒ‰ ì§„ì§œ ë™ì‘: ì´ë¦„ í¬í•¨ ë§¤ì¹­ -> í•´ë‹¹ ë§ˆì»¤ë¡œ ì´ë™ + íŒì—… ì˜¤í”ˆ */
    function execSearch() {
      if(!map) initMap();
      const input = document.getElementById('mapSearchInput');
      const q = (input.value || "").trim().toLowerCase();
      if(!q) return alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

      // stay ëª¨ë“œë©´ íŒì—…ì´ ì—†ì–´ì„œ cat ëª¨ë“œë¡œ ê°•ì œ (ê²€ìƒ‰ UX)
      if(mapMode !== 'cat') setMapMode('cat');

      const found = partners.find(p => (p.name || "").toLowerCase().includes(q));
      if(!found) return alert("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");

      // í˜¹ì‹œ í•„í„°ê°€ ê±¸ë ¤ìˆìœ¼ë©´ ì „ì²´ë¡œ ë°”ê¿”ì„œ ë§ˆì»¤ê°€ ë³´ì´ê²Œ í•¨
      const allChip = document.querySelector('.cat-chip[data-cat="all"]');
      if(allChip){
        document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
        allChip.classList.add('active');
      }
      renderMarkers('all');

      setTimeout(() => {
        map.setView([found.lat, found.lng], 15);
        const mk = markers.find(m => m.__pid === found.id);
        if(mk && mk.getPopup()){
          mk.openPopup();
        } else {
          L.popup().setLatLng([found.lat, found.lng])
            .setContent(`<b>${found.name}</b><br>${found.partner?'ì œíœ´':'ë¹„ì œíœ´'}`)
            .openOn(map);
        }
      }, 50);
    }

  /* --- ì¶”ì²œíƒ­ --- [êµì²´ ì‹œì‘] --- */

/** [ìˆ˜ì •] ì¶”ì²œ íƒ­ì€ ì‹¤ì œ ìƒí˜¸ ê¸°ë°˜ìœ¼ë¡œ ê³ ì • ë¦¬ìŠ¤íŠ¸ ì‚¬ìš© */
const REC_PLACES = {
  stay: [
    { id: 1001, cat: "stay", name: "ì‹œê·¸ë‹ˆì—˜ ë¶€ì‚°", short: "í•´ìš´ëŒ€ ì˜¤ì…˜ë·° ëŸ­ì…”ë¦¬ í˜¸í…”", img: "https://source.unsplash.com/600x600/?hotel,busan&sig=1001" },
    { id: 1002, cat: "stay", name: "íŒŒë¼ë‹¤ì´ìŠ¤ í˜¸í…” ë¶€ì‚°", short: "í•´ìš´ëŒ€ ëŒ€í‘œ ë¦¬ì¡°íŠ¸í˜• í˜¸í…”", img: "https://source.unsplash.com/600x600/?resort,beach&sig=1002" },
    { id: 1003, cat: "stay", name: "íŒŒí¬ í•˜ì–íŠ¸ ë¶€ì‚°", short: "ë§ˆë¦°ì‹œí‹° ì¸ê·¼ í”„ë¦¬ë¯¸ì—„ í˜¸í…”", img: "https://source.unsplash.com/600x600/?luxury,hotel&sig=1003" },
    { id: 1004, cat: "stay", name: "ê·¸ëœë“œ ì¡°ì„  ë¶€ì‚°", short: "í•´ìš´ëŒ€ ì¤‘ì‹¬, ê°ê°ì ì¸ ìŠ¤í…Œì´", img: "https://source.unsplash.com/600x600/?boutique,hotel&sig=1004" },
    { id: 1005, cat: "stay", name: "ì›¨ìŠ¤í‹´ ì¡°ì„  ë¶€ì‚°", short: "ë™ë°±ì„¬/í•´ìš´ëŒ€ ì‚°ì±… ì½”ìŠ¤ ìµœì ", img: "https://source.unsplash.com/600x600/?hotel,sea&sig=1005" },
    { id: 1006, cat: "stay", name: "ì‹ ë¼ìŠ¤í…Œì´ í•´ìš´ëŒ€", short: "ì¶œì¥Â·ì›Œì¼€ì´ì…˜ ê°€ì„±ë¹„ ìŠ¤í…Œì´", img: "https://source.unsplash.com/600x600/?business,hotel&sig=1006" },
    { id: 1007, cat: "stay", name: "ì•„ë‚œí‹° ì•³ ë¶€ì‚° ì½”ë¸Œ", short: "ê¸°ì¥ ì˜¤ì…˜ ë¦¬ì¡°íŠ¸, ê°ì„± íœ´ì–‘", img: "https://source.unsplash.com/600x600/?ocean,resort&sig=1007" },
    { id: 1008, cat: "stay", name: "ë¡¯ë°í˜¸í…” ë¶€ì‚°", short: "ì„œë©´ ì¤‘ì‹¬, ì´ë™/ë¯¸íŒ… í¸ë¦¬", img: "https://source.unsplash.com/600x600/?city,hotel&sig=1008" }
  ],

  food: [
    { id: 2001, cat: "food", name: "í•´ìš´ëŒ€ì•”ì†Œê°ˆë¹„ì§‘", short: "ë¶€ì‚° ëŒ€í‘œ í•œìš°ê°ˆë¹„ ë§›ì§‘", img: "https://source.unsplash.com/600x600/?korean,bbq&sig=2001" },
    { id: 2002, cat: "food", name: "ì´ˆëŸ‰ë°€ë©´", short: "ë¶€ì‚° í•˜ë©´ ë°€ë©´, í´ë˜ì‹ ì›ì¡°", img: "https://source.unsplash.com/600x600/?noodles&sig=2002" },
    { id: 2003, cat: "food", name: "ê°œë¯¸ì§‘(ë‚™ê³±ìƒˆ)", short: "ë‚™ì§€+ê³±ì°½+ìƒˆìš° â€˜ë‚™ê³±ìƒˆâ€™", img: "https://source.unsplash.com/600x600/?spicy,stew&sig=2003" },
    { id: 2004, cat: "food", name: "ê¸ˆìˆ˜ë³µêµ­", short: "í•´ìš´ëŒ€ ë³µêµ­ìœ¼ë¡œ ìœ ëª…", img: "https://source.unsplash.com/600x600/?fish,soup&sig=2004" },
    { id: 2005, cat: "food", name: "ìŒë‘¥ì´ë¼ì§€êµ­ë°¥", short: "ì„œë©´ ìª½ ë¼ì§€êµ­ë°¥ ê°•ì", img: "https://source.unsplash.com/600x600/?soup,korean&sig=2005" },
    { id: 2006, cat: "food", name: "ì´ì¬ëª¨í”¼ì(ì„œë©´)", short: "ë¶€ì‚° ë¡œì»¬ í”¼ì ë§›ì§‘ìœ¼ë¡œ ìœ ëª…", img: "https://source.unsplash.com/600x600/?pizza&sig=2006" },
    { id: 2007, cat: "food", name: "ìê°ˆì¹˜ì‹œì¥(íšŒ/í•´ì‚°ë¬¼)", short: "ë¶€ì‚° ë°”ë‹¤ ë¨¹ê±°ë¦¬ì˜ ìƒì§•", img: "https://source.unsplash.com/600x600/?seafood,market&sig=2007" },
    { id: 2008, cat: "food", name: "ë™ë˜í• ë§¤íŒŒì „", short: "ë™ë˜ íŒŒì „Â·ë§‰ê±¸ë¦¬ ì¡°í•©", img: "https://source.unsplash.com/600x600/?pancake,korean&sig=2008" }
  ],

  cafe: [
    { id: 3001, cat: "cafe", name: "ëª¨ëª¨ìŠ¤ì»¤í”¼(ë¶€ì‚°)", short: "ìŠ¤í˜ì…œí‹° ì»¤í”¼ë¡œ ìœ ëª…", img: "https://source.unsplash.com/600x600/?coffee,shop&sig=3001" },
    { id: 3002, cat: "cafe", name: "ì›¨ì´ë¸Œì˜¨ ì»¤í”¼(ê¸°ì¥)", short: "ë°”ë‹¤ë·°ë¡œ ìœ ëª…í•œ ëŒ€í˜• ì¹´í˜", img: "https://source.unsplash.com/600x600/?cafe,ocean&sig=3002" },
    { id: 3003, cat: "cafe", name: "F1963 í…Œë¼ë¡œì‚¬", short: "ë¬¸í™”ê³µê°„+ì¹´í˜, ì‘ì—…í•˜ê¸° ì¢‹ìŒ", img: "https://source.unsplash.com/600x600/?coffee,roastery&sig=3003" },
    { id: 3004, cat: "cafe", name: "ë©”ì´í¬ì”¨(ì˜ë„)", short: "ì˜ë„ ê°ì„± ë°”ë‹¤ ì¹´í˜ë¡œ ìœ ëª…", img: "https://source.unsplash.com/600x600/?cafe,busan&sig=3004" },
    { id: 3005, cat: "cafe", name: "ì˜µìŠ¤(OPS)", short: "ë¶€ì‚° ëŒ€í‘œ ë² ì´ì»¤ë¦¬", img: "https://source.unsplash.com/600x600/?bakery&sig=3005" },
    { id: 3006, cat: "cafe", name: "ì¹´í˜051(ë¶€ì‚°)", short: "ë¶€ì‚° ë¡œì»¬ ì¹´í˜ ë¸Œëœë“œ", img: "https://source.unsplash.com/600x600/?iced,coffee&sig=3006" },
    { id: 3007, cat: "cafe", name: "í°ì—¬ìš¸ë¬¸í™”ë§ˆì„ ì¹´í˜ê±°ë¦¬", short: "ë·°+ì‚°ì±… ì½”ìŠ¤, ì¹´í˜ ë°€ì§‘", img: "https://source.unsplash.com/600x600/?cliff,cafe&sig=3007" },
    { id: 3008, cat: "cafe", name: "í•´ë¦¬ë‹¨ê¸¸ ì¹´í˜ê±°ë¦¬", short: "í•´ìš´ëŒ€ ê°ì„± ì¹´í˜/ë””ì €íŠ¸", img: "https://source.unsplash.com/600x600/?dessert,cafe&sig=3008" }
  ],

  gym: [
    { id: 4001, cat: "gym", name: "ì§ë°•ìŠ¤(ë¶€ì‚°)", short: "24ì‹œê°„ í—¬ìŠ¤ì¥ìœ¼ë¡œ ìœ ëª…í•œ í¸", img: "https://source.unsplash.com/600x600/?gym,fitness&sig=4001" },
    { id: 4002, cat: "gym", name: "ìŠ¤í¬ì• ë‹ˆ(ë¶€ì‚°)", short: "ëŒ€í˜• ì²´ì¸, ì ‘ê·¼ì„± ì¢‹ì€ í¸", img: "https://source.unsplash.com/600x600/?fitness,training&sig=4002" },
    { id: 4003, cat: "gym", name: "ì• ë‹ˆíƒ€ì„ í”¼íŠ¸ë‹ˆìŠ¤(ë¶€ì‚°)", short: "24ì‹œê°„ ì²´ì¸, ê°„í¸ ì´ìš©", img: "https://source.unsplash.com/600x600/?workout&sig=4003" },
    { id: 4004, cat: "gym", name: "í¬ë¡œìŠ¤í• í•´ìš´ëŒ€", short: "ê³ ê°•ë„ ê·¸ë£¹ íŠ¸ë ˆì´ë‹", img: "https://source.unsplash.com/600x600/?crossfit&sig=4004" },
    { id: 4005, cat: "gym", name: "ì„¼í…€ í”¼íŠ¸ë‹ˆìŠ¤(ì„¼í…€ê¶Œ)", short: "ì„¼í…€/ë²¡ìŠ¤ì½” ì¸ê·¼ ìš´ë™", img: "https://source.unsplash.com/600x600/?dumbbell,gym&sig=4005" },
    { id: 4006, cat: "gym", name: "ì„œë©´ í”¼íŠ¸ë‹ˆìŠ¤(ì„œë©´ê¶Œ)", short: "ì„œë©´ ì¤‘ì‹¬, ì´ë™ í¸ë¦¬", img: "https://source.unsplash.com/600x600/?fitness,gym&sig=4006" },
    { id: 4007, cat: "gym", name: "ë§ˆë¦°ì‹œí‹° í”¼íŠ¸ë‹ˆìŠ¤(ë§ˆë¦°ì‹œí‹°)", short: "ë§ˆë¦°ì‹œí‹° ì¸ê·¼ ì´ìš©", img: "https://source.unsplash.com/600x600/?training,gym&sig=4007" },
    { id: 4008, cat: "gym", name: "ìš”ê°€/í•„ë¼í…ŒìŠ¤ ìŠ¤íŠœë””ì˜¤(ë¶€ì‚°)", short: "ì»¨ë””ì…˜ íšŒë³µìš© ë¼ì´íŠ¸ ìš´ë™", img: "https://source.unsplash.com/600x600/?pilates,yoga&sig=4008" }
  ],

  work: [
    { id: 5001, cat: "work", name: "WeWork ë¶€ì‚° BIFC", short: "ë¶€ì‚° êµ­ì œê¸ˆìœµì„¼í„° ê³µìœ ì˜¤í”¼ìŠ¤", img: "https://source.unsplash.com/600x600/?coworking,office&sig=5001" },
    { id: 5002, cat: "work", name: "U-Space BIFC", short: "BIFC ì¸ê·¼ ë¹„ì¦ˆë‹ˆìŠ¤ ê³µê°„", img: "https://source.unsplash.com/600x600/?office,workspace&sig=5002" },
    { id: 5003, cat: "work", name: "ë¦¬ì €ìŠ¤(ë¶€ì‚°)", short: "ë¯¸íŒ…/ì—…ë¬´ ê°€ëŠ¥í•œ ê¸€ë¡œë²Œ ì˜¤í”¼ìŠ¤", img: "https://source.unsplash.com/600x600/?meeting,room&sig=5003" },
    { id: 5004, cat: "work", name: "ì˜ë„ ì½”ì›Œí‚¹(AREA6 ë“±)", short: "ì˜ë„ ìª½ ì½”ì›Œí‚¹/í¬ë¦¬ì—ì´í‹°ë¸Œ", img: "https://source.unsplash.com/600x600/?creative,workspace&sig=5004" },
    { id: 5005, cat: "work", name: "ì„¼í…€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¼ìš´ì§€(ì„¼í…€ê¶Œ)", short: "ì„¼í…€/ë²¡ìŠ¤ì½” ì£¼ë³€ ì—…ë¬´ ê³µê°„", img: "https://source.unsplash.com/600x600/?laptop,cafe&sig=5005" },
    { id: 5006, cat: "work", name: "ì„œë©´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¼ìš´ì§€(ì„œë©´ê¶Œ)", short: "ì„œë©´ ì¤‘ì‹¬, ë¯¸íŒ…/ì‘ì—… í¸ë¦¬", img: "https://source.unsplash.com/600x600/?workspace,laptop&sig=5006" },
    { id: 5007, cat: "work", name: "ë¶€ì‚°ì°½ì—…ì¹´í˜/ì§€ì›ê³µê°„", short: "ìŠ¤íƒ€íŠ¸ì—…/ì°½ì—… ì§€ì› ê³µê°„ í™œìš©", img: "https://source.unsplash.com/600x600/?startup,office&sig=5007" },
    { id: 5008, cat: "work", name: "ìŠ¤í„°ë””ì¹´í˜(ë¶€ì‚°)", short: "ì¡°ìš©íˆ ì§‘ì¤‘í•˜ê¸° ì¢‹ì€ ê³µê°„", img: "https://source.unsplash.com/600x600/?study,cafe&sig=5008" }
  ]
};

/** [ìˆ˜ì •] idë¡œ ì¶”ì²œ ì¥ì†Œ ì°¾ê¸° (partners ë§ê³  REC_PLACESì—ì„œ ê²€ìƒ‰) */
function getPartnerById(id){
  const all = [
    ...REC_PLACES.stay,
    ...REC_PLACES.food,
    ...REC_PLACES.cafe,
    ...REC_PLACES.gym,
    ...REC_PLACES.work
  ];
  return all.find(p => p.id === id);
}

/* --- ì¶”ì²œíƒ­ --- [êµì²´ ë] --- */


    function openRecDetail(id){
      const item = getPartnerById(id);
      if(!item) return;

      document.getElementById('rd-title').innerText = item.name;
      document.getElementById('rd-img').src = item.img;

      const catLabel = { stay:"ìˆ™ì†Œ", food:"ìŒì‹ì ", cafe:"ì¹´í˜", gym:"í—¬ìŠ¤ì¥", work:"ì›Œí¬ìŠ¤í˜ì´ìŠ¤" }[item.cat] || "ì¥ì†Œ";
      const partnerTxt = item.partner ? "ì œíœ´ì²˜" : "ë¹„ì œíœ´(ì¶”ì²œ)";
      document.getElementById('rd-desc').innerText =
        `${catLabel} Â· ${partnerTxt}\n` +
        `ì¶œë°œì§€ ê¸°ì¤€ìœ¼ë¡œ ì ‘ê·¼ì„±ì´ ì¢‹ì€ ìœ„ì¹˜ì— ìˆëŠ” ì¶”ì²œ ì¥ì†Œì…ë‹ˆë‹¤.\n` +
        `í˜„ì¥ ë°©ë¬¸ ì‹œ ìš´ì˜ ì‹œê°„/ì´ìš© ì¡°ê±´ì€ ë³€ë™ë  ìˆ˜ ìˆìœ¼ë‹ˆ í™•ì¸ í›„ ì´ìš©í•´ ì£¼ì„¸ìš”.`;

      openModal('modal-rec-detail');
    }

    function openRecMap(id){
      const item = getPartnerById(id);
      if(!item) return;

      goView('map', document.querySelectorAll('.nav-item')[2]);
      setTimeout(() => {
        initMap();
        if(map){
          map.setView([item.lat, item.lng], 15);
          L.popup()
            .setLatLng([item.lat, item.lng])
            .setContent(`<b>${item.name}</b><br>${item.partner?'ì œíœ´':'ë¹„ì œíœ´'}`)
            .openOn(map);
        }
      }, 260);
    }

    function loadRec(cat, el) {
  document.querySelectorAll('.rt-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');

  const list = document.getElementById('recList');
  list.innerHTML = "";

  // âœ… [ìˆ˜ì •] ë°˜ë³µë˜ëŠ” recData ëŒ€ì‹ , ê³ ì • ì¶”ì²œ ë¦¬ìŠ¤íŠ¸(REC_PLACES)ë¥¼ ì‚¬ìš©
  (REC_PLACES[cat] || []).forEach(item => {
    const div = document.createElement('div');
    div.className = 'rec-card';
    div.innerHTML = `
      <img src="${item.img}" class="rc-img">
      <div class="rc-info">
        <div class="rc-title">${item.name}</div>
        <div class="rc-desc">${item.short || "ë¶€ì‚° ì¶”ì²œ ì¥ì†Œ"}</div>
        <div class="rc-acts">
          <button class="rc-btn" onclick="openRecDetail(${item.id})">ìì„¸íˆ</button>
          <button class="rc-btn map" onclick="openRecMap(${item.id})">ì§€ë„</button>
        </div>
      </div>`;
    list.appendChild(div);
  });
}


    function switchMy(idx) {
      document.querySelectorAll('.mt-item').forEach((e, i) => e.classList.toggle('active', i===idx));
      document.querySelectorAll('.my-sec').forEach((e, i) => e.style.display = i===idx ? 'block' : 'none');
    }

    /* ì•½ê´€/ë¬¸ì˜ */
    function openTerms(type) {
      const titles = { terms:"ì´ìš©ì•½ê´€", privacy:"ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨", refund:"í™˜ë¶ˆ/ì·¨ì†Œ", contact:"ë¬¸ì˜í•˜ê¸°" };
      document.getElementById('mt-title').innerText = titles[type];

      const bodies = {
        terms:
`ì œ1ì¡°(ëª©ì )
ë³¸ ì•½ê´€ì€ BÂ·PASS Living(ì´í•˜ â€œì„œë¹„ìŠ¤â€)ì˜ ì´ìš©ê³¼ ê´€ë ¨í•˜ì—¬ ì„œë¹„ìŠ¤ ì œê³µìì™€ ì´ìš©ì ê°„ì˜ ê¶Œë¦¬Â·ì˜ë¬´ ë° ì±…ì„ì‚¬í•­ì„ ê·œì •í•©ë‹ˆë‹¤.

ì œ2ì¡°(ì„œë¹„ìŠ¤ ì œê³µ)
ì„œë¹„ìŠ¤ëŠ” ë””ì§€í„¸ íŒ¨ìŠ¤ í™•ì¸, ì œíœ´ì²˜ ì •ë³´ ì•ˆë‚´, ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ ì œê³µ ë“± í¸ì˜ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
ì„œë¹„ìŠ¤ í™”ë©´Â·êµ¬ì„±Â·ì œê³µ ë²”ìœ„ëŠ” ìš´ì˜ ì •ì±…ì— ë”°ë¼ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì œ3ì¡°(ì´ìš©ìì˜ ì˜ë¬´)
ì´ìš©ìëŠ” íƒ€ì¸ì˜ ì •ë³´ë¥¼ ë„ìš©í•˜ê±°ë‚˜ ì„œë¹„ìŠ¤ ìš´ì˜ì„ ë°©í•´í•˜ëŠ” í–‰ìœ„ë¥¼ í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.
ë¶€ì • ì´ìš©ì´ í™•ì¸ë  ê²½ìš° ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì œ4ì¡°(ë©´ì±…)
ì œíœ´ì²˜ ìš´ì˜ì‹œê°„, ì œê³µ í˜œíƒ, í˜„ì¥ ì •ì±… ë“±ì€ ì œíœ´ì‚¬ ì‚¬ì •ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë©°, ì„œë¹„ìŠ¤ëŠ” í˜„ì¥ ë³€ê²½ì‚¬í•­ì— ëŒ€í•´ ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.`,
        privacy:
`1) ìˆ˜ì§‘ í•­ëª©
ì„œë¹„ìŠ¤ ì´ìš© ê³¼ì •ì—ì„œ ì–¸ì–´ ì„¤ì •, ê¸°ê¸° ì •ë³´(ë¸Œë¼ìš°ì €/OS ë“±), ì´ìš© ê¸°ë¡(íƒ­ ì´ë™/ë²„íŠ¼ í´ë¦­ ë“±)ì´ ìˆ˜ì§‘ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2) ì´ìš© ëª©ì 
ì„œë¹„ìŠ¤ í’ˆì§ˆ ê°œì„ , ì˜¤ë¥˜ ë¶„ì„, ì‚¬ìš©ì ê²½í—˜(UX) ê°œì„ ì„ ìœ„í•´ í™œìš©ë©ë‹ˆë‹¤.

3) ë³´ê´€ ë° íŒŒê¸°
ëª©ì  ë‹¬ì„± í›„ ì§€ì²´ ì—†ì´ íŒŒê¸°í•˜ë©°, ë²•ë ¹ì— ë”°ë¼ ë³´ê´€ì´ í•„ìš”í•œ ê²½ìš° í•´ë‹¹ ê¸°ê°„ ë™ì•ˆ ë³´ê´€í•©ë‹ˆë‹¤.

4) ì œ3ì ì œê³µ
ì›ì¹™ì ìœ¼ë¡œ ì´ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ì™¸ë¶€ì— ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ë²•ë ¹ì— ê·¼ê±°í•œ ìš”ì²­ì´ ìˆëŠ” ê²½ìš° ì˜ˆì™¸ë¡œ í•©ë‹ˆë‹¤.

5) ë¬¸ì˜
ê°œì¸ì •ë³´ ê´€ë ¨ ë¬¸ì˜ëŠ” â€˜ë¬¸ì˜í•˜ê¸°â€™ ë©”ë‰´ë¥¼ í†µí•´ ì ‘ìˆ˜í•´ ì£¼ì„¸ìš”.`,
        refund:
`ìœ ì˜ì‚¬í•­
- ì œíœ´ í˜œíƒì€ ì œíœ´ì²˜ í˜„ì¥ ì •ì±…(ìš´ì˜ì‹œê°„/ì¬ê³ /ì˜ˆì•½ ìƒí™©)ì— ë”°ë¼ ì œê³µì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì´ìš©ìëŠ” ë°©ë¬¸ ì „ ì œíœ´ì²˜ì˜ ìš´ì˜ ì •ë³´ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

í™˜ë¶ˆ/ì·¨ì†Œ(ì•ˆë‚´)
- ê²°ì œ í›„ ë¯¸ì‚¬ìš© ìƒíƒœì—ì„œ ì·¨ì†Œë¥¼ ìš”ì²­í•œ ê²½ìš°, ë‚´ë¶€ í™•ì¸ ì ˆì°¨ í›„ í™˜ë¶ˆì´ ì§„í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì¼ë¶€ í˜œíƒ(ë°”ìš°ì²˜ ì‚¬ìš© ë“±)ì´ ì‚¬ìš© ì²˜ë¦¬ëœ ê²½ìš° í™˜ë¶ˆì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- í™˜ë¶ˆ ì†Œìš” ê¸°ê°„ì€ ê²°ì œìˆ˜ë‹¨ ë° ì¹´ë“œì‚¬ ì •ì±…ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
        contact:
`ë¬¸ì˜ ì±„ë„
- ì•±/ì›¹ ë‚´ â€˜ë¬¸ì˜í•˜ê¸°â€™ ë©”ë‰´ë¡œ ì ‘ìˆ˜
- ìš´ì˜ì‹œê°„: í‰ì¼ 10:00 ~ 18:00 (ê³µíœ´ì¼ ì œì™¸)

ë¹ ë¥¸ ì•ˆë‚´ë¥¼ ìœ„í•´ ì•„ë˜ ì •ë³´ë¥¼ í•¨ê»˜ ë‚¨ê²¨ì£¼ì„¸ìš”.
1) ë¬¸ì˜ ìœ í˜•(ê²°ì œ/íŒ¨ìŠ¤/ì œíœ´ì²˜/ì˜¤ë¥˜)
2) ë°œìƒ í™”ë©´(ì˜ˆ: ì¶”ì²œ íƒ­ > ì§€ë„ ë²„íŠ¼)
3) ì‚¬ìš© ê¸°ê¸°/ë¸Œë¼ìš°ì €
4) ë¬¸ì œ ìƒí™©(ê°€ëŠ¥í•˜ë©´ ìº¡ì²˜ í¬í•¨)

ì ‘ìˆ˜ëœ ë¬¸ì˜ëŠ” ìˆœì°¨ì ìœ¼ë¡œ í™•ì¸ í›„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.`
      };

      document.getElementById('mt-body').innerText = bodies[type] || bodies.terms;
      openModal('modal-terms');
    }

    /* ì–¸ì–´ */
    function setLang(lang) {
      curLang = lang;
      document.getElementById('curLang').innerText = lang;
      closeModal(document.getElementById('modal-lang'));
      updateHomeUI();
      
      const txt = i18n[lang];
      document.querySelector('.brand').innerText = txt.brand;
      document.querySelector('.h-sub').innerText = txt.sub;

      const alias = { slogan: "sub", pass_title: "buy_title", btn_look: "look", btn_buy: "buy" };
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const realKey = alias[key] || key;
        if (txt[realKey] !== undefined) el.innerText = txt[realKey];
      });

      feather.replace();
    }

    /* ëª¨ë‹¬ */
    function openModal(id) {
      const el = typeof id === 'string' ? document.getElementById(id) : id;
      if (!el) return;
      el.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    function closeModal(target) {
      const el = (target instanceof HTMLElement)
        ? target
        : (typeof target === 'string' ? document.getElementById(target) : null);
      if (!el) return;
      el.style.display = 'none';
      document.body.style.overflow = 'hidden';
    }

    /* ë¡œê·¸ì•„ì›ƒ */
    function handleLogout() {
      if(!confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
      user = { loggedIn: false, hasPass: false, passDays: 0 };

      document.getElementById('certName').innerText = "GUEST";
      document.getElementById('certStatus').innerText = "INACTIVE";
      document.getElementById('certId').innerText = "-";
      document.getElementById('certDate').innerText = "-";
      document.getElementById('certMsg').innerHTML = "ë¡œê·¸ì¸ ë° êµ¬ë§¤ í›„ í™œì„±í™”ë©ë‹ˆë‹¤.<br>ì œíœ´ì²˜ì—ì„œ ì´ í™”ë©´ì„ ë³´ì—¬ì£¼ì„¸ìš”.";

      document.getElementById('mp-title').innerText = "êµ¬ë§¤ ë‚´ì—­ ì—†ìŒ";
      document.getElementById('mp-status').innerText = "INACTIVE";
      document.getElementById('mp-time').innerText = "íŒ¨ìŠ¤ êµ¬ë§¤ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.";

      document.getElementById('voucherList').innerHTML =
        `<div style="text-align:center; padding:40px; color:#aaa; font-size:14px;">êµ¬ë§¤í•œ íŒ¨ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;

      updateHomeUI();
      goView('home', document.querySelectorAll('.nav-item')[0]);
    }

  </script>
</body>
</html>
